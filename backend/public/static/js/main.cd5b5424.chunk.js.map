{"version":3,"sources":["utils/utils.js","data/action.js","api/api.js","Config.js","data/reducers.js","data/store.js","components/ListItemLink.js","components/ListEdit.js","components/ListInfo.js","components/Actions.js","components/Triggers.js","components/TaskDialog.js","pages/Tasks.js","components/ReserveTable.js","components/ReserveTables.js","pages/Launch.js","pages/Settings.js","api/remote_login.js","pages/RemoteLogin.js","pages/Login.js","pages/Predicts.js","pages/User.js","App.js","reportWebVitals.js","index.js"],"names":["sleep","time_ms","Promise","accept","setTimeout","isIterator","obj","Symbol","iterator","deepCopy","data","undefined","d","i","length","push","k","objectUpdate","origin","update","now","isObjectValueEqual","a","b","aProps","Object","getOwnPropertyNames","bProps","propName","propA","propB","hasOwnProperty","Date","prototype","setDay","day","day_","this","getDay","setTime","getTime","toDateString","toISOString","slice","timedeltaUnits","getTimedeltaString","timedelta","unit","keys","getTimedeltaUnit","toFixed","weekDayList","setConfig","dispatch","type","setTasks","setUser","setDaemon","setErrorInfo","setMessage","updateTypes","typeData","store","getState","types","api","host","window","location","href","includes","port","api_version","api_prefix","protocol","url","access_token","refresh_token","router","key","method","request","config","api_token","get_token","console","log","set_token","refresh","access","headers","payload","mode","body","JSON","stringify","get_headers","Boolean","resp","fetch","error","status","code","statusText","js","json","message","resp2","js2","update_config","res","user","ITEM_NAME","Config","load","bind","save","theme_avaliable","createMuiTheme","palette","primary","main","blueGrey","secondary","grey","data_default","debug","version_frontend","theme_name","settings_async","remote_login","server","theme","parse","localStorage","getItem","Error","e","warn","s","setItem","defaultState","tasks","daemon","errorInfo","combineReducers","state","action","createStore","reducers","applyMiddleware","thunk","ListItemLink","props","icon","to","onClick","renderLink","React","useMemo","forwardRef","itemProps","ref","ListItem","button","component","ListItemIcon","ListItemText","ListEdit","defaultValue","open","onClose","title","keyNames","dataType","typeName","dismiss","onSave","useState","setInnerData","setData","openChild","setOpenChild","child","setChild","childTitle","setChildTitle","timedeltaUnit","setTimedeltaUnit","Dialog","fullWidth","DialogTitle","DialogContent","List","style","width","map","v","indexOf","args","editable","showName","value","actionData","startsWith","Button","Box","DateTimePicker","onChange","moment","format","IconButton","val","updateFixed","TextField","parseFloat","target","isNaN","newValue","onBlur","Select","MenuItem","ListItemSecondaryAction","DialogActions","color","height","display","justifyContent","Typography","variant","ListInfo","isActionModified","item","updateActionData","callback","then","actions","wrapAction","actionType","action_type","newActionData","getDataString","calendar","ActionTag","selectMode","targets","dialogOpen","setDialogOpen","roomItem","tmp","item_id","itemId","target_price","price","actionTemp","toUse","setToUse","handleCloseDialog","handleClick","newAction","selected","Card","minWidth","margin","CardContent","name","desc","newData","CardActions","Actions","requesting","setRequesting","useReducer","x","forceUpdate","content","flexDirection","flexWrap","updateTriggerData","triggers","isTriggerModified","getTriggerType","trigger","interval","run_date","wrapTrigger","triggerType","triggerData","newTriggerData","TriggerTag","newTrigger","Triggers","trigger_type","taskDialogUpdate","setTaskDialogUpdate","TaskDialog","addMode","onRefresh","taskOld","baseTaskName","taskName","realDefaultTask","task_name","defaultTask","dialogAddTaskOpen","dialogAddTriggerOpen","dialogAddActionOpen","dialogUpdateTrigger","task","requestingTaskData","defaultTid","setInnerState","setState","taskData","task_data","tid","handleAddTask","resolve","reject","ListSubheader","newTask","splice","Grid","container","spacing","xs","lg","disabled","wrapTask","taskWrapped","TaskTag","onUpdate","request_key","getTargetTasks","result","getTargetTasksMarks","TaskList","marks","Tasks","requestingTasks","Container","sm","maxWidth","tids","assign","useStyles","makeStyles","table","foodDesc","overflow","whiteSpace","contentOverflow","planButton","MyTableCell","styles","padding","noBorder","borderBottom","TableCell","align","colSpan","requestedDayData","setUpdateTimer","ReserveTable","classes","requestingDaemon","setRequestingDaemon","requestingUpdate","setRequestingUpdate","date","dayData","setDayData","reserve_table","roomList","setRoomList","setDialogAddTaskOpen","dialogTasksListOpen","setDialogTasksListOpen","roomItemNow","setRoomItemNow","setRequestingTasks","LinearProgress","daemon_args","update_all","Period","maxRow","roomNameList","roomData","roomMapItemEntry","roomName","targetRowCenter","parseInt","rows","cells","key2","periodId","className","stock","planCount","Link","parent","arg","TableRow","updateData","reserveTableData","tableHeaderCells","tableHeader","TableHead","roomCapacity","periodList","TableContainer","Paper","Table","stickyHeader","TableBody","roomType","periodDesc","TabPanel","children","index","other","role","hidden","id","aria-labelledby","root","overflowX","flexGrow","background","paper","formControl","selectEmpty","marginTop","ReserveTables","tabValue","setTableValue","showTable","setShowTable","fullShow","setFullShow","Tabs","indicatorColor","textColor","scrollButtons","aria-label","Tab","label","FormControl","InputLabel","event","float","innerWidth","fullScreen","edge","StateNow","unsubscribe","subscribe","timetableNodes","timetablePeriods","roomStockPlans","Component","Launch","Settings","themeName","setThemeName","refConfigFileInput","useRef","resetSettingsOpen","setResetSettingsOpen","deleteDataOpen","setDeleteDataOpen","openDaemon","setOpenDaemon","openUser","setOpenUser","openResetShop","setOpenResetShop","resetSettings","c","username","clear","reload","shop_info","branchName","filename","eleLink","document","createElement","download","blob","Blob","URL","createObjectURL","appendChild","click","removeChild","funDownload","toLocaleString","current","files","file","reader","FileReader","readAsText","onload","evt","fileData","Switch","defaultChecked","checked","nick","phone","profile","created_at","updated_at","cookies","solution_id","WebSocketAPI","connect","ws","onopen","ondata","cmd","oncode","oncookies","onmessage","onerror","onclose","WebSocket","close","QRCode","require","CenterBox","textAlign","alignItems","RemoteLogin","loginDone","loginError","ws_api","uid","size","innerHeight","LoginFrame","password","captcha","refUsername","refPassword","actionLogin","handleAction","Divider","onKeyDown","querySelector","focus","Fade","in","timeout","exit","enter","Login","Predicts","useSpan","setUseSpan","openHelp","setOpenHelp","labels","labelShows","predictsResult","setPredictsResult","defaultValues","labelsTemp","labelValues","temp","inputValues","setInputValues","getTempValues","tempValues","items","inputProps","FormControlLabel","control","Checkbox","predict_data","small","large","User","nickHead","test","Avatar","alt","shopName","drawerWidth","locale","appBar","zIndex","drawer","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","enteringScreen","menuButton","marginRight","hide","flexShrink","drawerOpen","drawerClose","breakpoints","up","toolbar","mixins","subscribers","last_data","subFunc","getShopTitle","App","useTheme","setOpen","errorDialogInfo","setErrorDialogInfo","myMessage","setMyMessage","titleDefault","setTitle","requestingRemote","setRequesingRemote","useEffect","onWindowResize","addEventListener","removeEventListener","mainContent","utils","MomentUtils","CssBaseline","AppBar","position","clsx","Toolbar","noWrap","Drawer","direction","pathname","path","exact","isNowLogining","ThemeProvider","toString","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","Fragment","fontSize","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","cycle","load_from_config","ReactDOM","render","getElementById","startFunc","cycleFunc"],"mappings":"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","file":"static/js/main.cd5b5424.chunk.js","sourcesContent":["import moment from 'moment';\r\nimport 'moment/locale/zh-cn'\r\n\r\nexport function isMobileDevice() {\r\n  const sUserAgent = navigator.userAgent;\r\n  return (sUserAgent.indexOf('Android') > -1 || sUserAgent.indexOf('iPhone') > -1 || sUserAgent.indexOf('iPad') > -1 || sUserAgent.indexOf('iPod') > -1 || sUserAgent.indexOf('Symbian') > -1);\r\n}\r\n\r\n/** \r\n* param 将要转为URL参数字符串的对象 \r\n* key URL参数字符串的前缀 \r\n* encode true/false 是否进行URL编码,默认为true \r\n*  \r\n* return URL参数字符串 \r\n*/\r\nexport function urlEncode(param, key, encode) {\r\n  if (param == null) return '';\r\n  var paramStr = '';\r\n  var t = typeof (param);\r\n  if (t === 'string' || t === 'number' || t === 'boolean') {\r\n    paramStr += '&' + key + '=' + ((encode == null || encode) ? encodeURIComponent(param) : param);\r\n  } else {\r\n    for (var i in param) {\r\n      var k = key == null ? i : key + (param instanceof Array ? '[' + i + ']' : '.' + i);\r\n      paramStr += urlEncode(param[i], k, encode);\r\n    }\r\n  }\r\n  return paramStr;\r\n};\r\n\r\nexport function urlEncode2(obj) {\r\n  try {\r\n    return JSON.stringify(obj).replace(/:/g, \"=\").replace(/\"/g, '').replace(/,/g, '&').match(/\\{([^)]*)\\}/)[1];\r\n  } catch (e) {\r\n    console.error(e);\r\n    return \"\";\r\n  }\r\n}\r\n\r\nexport function parseTimePoint(time) {\r\n  return moment(time).format('LLLL');\r\n}\r\n\r\nexport function parseTimePeriod(time) {\r\n  return moment.duration(time).humanize();\r\n}\r\n\r\nexport function getTextFieldValue(el) {\r\n  return el.current.childNodes[el.current.childElementCount - 1].childNodes[0].value;\r\n}\r\n\r\nexport function sleep(time_ms) {\r\n  return new Promise(accept => {\r\n    setTimeout(accept, time_ms);\r\n  });\r\n}\r\n\r\n// 设置到本周的星期几\r\nDate.prototype.setDay = function (day) {\r\n  let day_ = this.getDay();\r\n  if (day_ === day) return this;\r\n  this.setTime(this.getTime() + 1000 * 60 * 60 * 24 * (day - day_));\r\n  return this;\r\n};\r\n\r\n// 获取 YYYY-MM-DD 格式\r\nDate.prototype.toDateString = function () {\r\n  return this.toISOString().slice(0, 10);\r\n};\r\n\r\n// export function cutString(str, length=10)\r\n\r\nexport function isIterator(obj) {\r\n  return obj != null && typeof obj[Symbol.iterator] === 'function';\r\n}\r\n\r\n// 下载文件方法\r\nexport function funDownload(content, filename) {\r\n  var eleLink = document.createElement('a');\r\n  eleLink.download = filename;\r\n  eleLink.style.display = 'none';\r\n  // 字符内容转变成blob地址\r\n  var blob = new Blob([content]);\r\n  eleLink.href = URL.createObjectURL(blob);\r\n  // 触发点击\r\n  document.body.appendChild(eleLink);\r\n  eleLink.click();\r\n  // 然后移除\r\n  document.body.removeChild(eleLink);\r\n};\r\n\r\n\r\nexport function deepCopy(data) {\r\n  if (data === null || data === undefined) {\r\n    return data;\r\n  } if (isIterator(data) && typeof (data) !== \"string\") {\r\n    let d = [];\r\n    for (let i = 0; i < data.length; i++) {\r\n      d.push(data[i]);\r\n    }\r\n    return d;\r\n  } else if (typeof (data) === \"object\") {\r\n    let d = {};\r\n    for (const k in data) {\r\n      d[k] = deepCopy(data[k]);\r\n    }\r\n    return d;\r\n  } else {\r\n    return data;\r\n  }\r\n}\r\n\r\nexport function objectUpdate(origin, update) {\r\n  let now = deepCopy(origin);\r\n  for (const k in update) {\r\n    now[k] = update[k];\r\n  }\r\n  return now;\r\n}\r\n\r\n// https://www.jianshu.com/p/7407bd65b15d\r\nexport function isObjectValueEqual(a, b) {\r\n  var aProps = Object.getOwnPropertyNames(a);\r\n  var bProps = Object.getOwnPropertyNames(b);\r\n  if (aProps.length !== bProps.length) {\r\n    return false;\r\n  }\r\n  for (var i = 0; i < aProps.length; i++) {\r\n    var propName = aProps[i]\r\n\r\n    var propA = a[propName]\r\n    var propB = b[propName]\r\n    // 2020-11-18更新，这里忽略了值为undefined的情况\r\n    // 故先判断两边都有相同键名\r\n    if (!b.hasOwnProperty(propName)) return false\r\n    if ((propA instanceof Object)) {\r\n      if (isObjectValueEqual(propA, propB)) {\r\n        // return true     这里不能return ,后面的对象还没判断\r\n      } else {\r\n        return false\r\n      }\r\n    } else if (propA !== propB) {\r\n      return false\r\n    } else { }\r\n  }\r\n  return true\r\n}\r\n\r\n// Array.prototype.indexOf = function (val) {\r\n//   for (var i = 0; i < this.length; i++) {\r\n//     if (this[i] == val) return i;\r\n//   }\r\n//   return -1;\r\n// };\r\n\r\n// Array.prototype.remove = function (val) {\r\n//   var index = this.indexOf(val);\r\n//   if (index > -1) {\r\n//     this.splice(index, 1);\r\n//   }\r\n// };\r\n\r\n// Array.prototype.removeIndex = function (index) {\r\n//   this.splice(index, 1);\r\n// };\r\n\r\n// export function arrayRemove(array, data) {\r\n//   if (!isIterator(array)) return;\r\n//   const index = array.indexOf(data);\r\n//   if (index > -1) {\r\n//     array.slice(index, 1);\r\n//   }\r\n// }\r\n\r\nexport const timedeltaUnits = {\r\n  \"秒\": 1, \"分\": 60, \"时\": 60 * 60,\r\n  \"天\": 24 * 60 * 60, \"周\": 7 * 24 * 60 * 60\r\n};\r\n\r\n\r\nexport function getTimedeltaUnit(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return null;\r\n  if (timedelta >= timedeltaUnits[Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]])\r\n    return Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n  for (let i = 1; i < Object.keys(timedeltaUnits).length; i++) {\r\n    if (timedelta < timedeltaUnits[Object.keys(timedeltaUnits)[i]]) {\r\n      return Object.keys(timedeltaUnits)[i - 1];\r\n    }\r\n  }\r\n  return Object.keys(timedeltaUnits)[0];\r\n}\r\n\r\nexport function getTimedeltaString(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return \"\";\r\n  const unit = getTimedeltaUnit(timedelta);\r\n  if (unit === null) return \"\";\r\n  // console.log(\"unit\", unit);\r\n  return `${(timedelta / timedeltaUnits[unit]).toFixed(2)}${unit}`;\r\n}\r\n\r\nexport const weekDayList = ['日', '一', '二', '三', '四', '五', '六'];\r\n\r\nexport function isChinese(temp) {\r\n  var re = /[^\\u4E00-\\u9FA5]/;\r\n  if (re.test(temp)) return false;\r\n  return true;\r\n}\r\n","import { objectUpdate } from \"../utils/utils\";\r\nimport store from \"./store\";\r\n\r\nexport function setConfig(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_CONFIG\", data: data });\r\n  };\r\n}\r\n\r\nexport function setTasks(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_TASKS\", data: data });\r\n  };\r\n}\r\n\r\nexport function setUser(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_USER\", data: data });\r\n  };\r\n}\r\n\r\nexport function setDaemon(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_DAEMON\", data: data });\r\n  };\r\n}\r\n\r\nexport function setErrorInfo(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_ERROR_INFO\", data: data });\r\n  };\r\n}\r\n\r\nexport function setMessage(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_MESSAGE\", data: data });\r\n  };\r\n}\r\n\r\nexport function setTypes(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_TYPES\", data: data });\r\n  };\r\n}\r\n\r\n\r\nexport function updateTypes(type, typeData) {\r\n  return setTypes(objectUpdate(store.getState().types, { [type]: typeData }));\r\n}\r\n","import { setConfig, setErrorInfo, setUser } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { isIterator, urlEncode } from \"../utils/utils\"\r\n\r\n\r\n\r\nclass API {\r\n  constructor() {\r\n    // this.host = '127.0.0.1';\r\n    this.host = window.location.href.includes(\"localhost\") ? \"localhost\" : null;\r\n    // this.port = 8080;\r\n    this.port = 8880;\r\n    this.api_version = \"v2\";\r\n    this.api_prefix = `/api/${this.api_version}`;\r\n    this.protocol = 'http'\r\n    this.url = this.host ? `${this.protocol}://${this.host}:${this.port}${this.api_prefix}` : `${this.api_prefix}`;\r\n    this.access_token = '';\r\n    this.refresh_token = '';\r\n  }\r\n  set_token(access_token, refresh_token) {\r\n    // this.access_token = access_token || this.access_token;\r\n    // this.refresh_token = refresh_token || this.refresh_token;\r\n    if (access_token !== undefined)\r\n      this.access_token = access_token;\r\n    if (refresh_token !== undefined)\r\n      this.refresh_token = refresh_token;\r\n  }\r\n  get_token() {\r\n    return {\r\n      access_token: this.access_token === '' ? undefined : this.access_token, refresh_token: this.refresh_token === '' ? undefined : this.refresh_token\r\n    }\r\n  }\r\n  request_key(router, key, method = \"GET\", data) {\r\n    return this.request(`${router}/${key}`, method, data);\r\n  }\r\n  update_config() {\r\n    let config = store.getState().config;\r\n    config.data.api_token = this.get_token();\r\n    console.log('config.data.api_token', config.data.api_token)\r\n    // config.save();\r\n    store.dispatch(setConfig(config));\r\n  }\r\n  load_from_config() {\r\n    const config = store.getState().config;\r\n    this.set_token(config.data.api_token.access_token, config.data.api_token.refresh_token);\r\n  }\r\n  get_headers(refresh = false, access = true) {\r\n    let headers = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    if (refresh) {\r\n      headers['Refresh'] = this.refresh_token;\r\n    }\r\n    if (access) {\r\n      if (this.access_token !== '') headers['Authorization'] = this.access_token;\r\n    }\r\n    return headers;\r\n  }\r\n  async request(router, method = \"GET\", data) {\r\n    const payload = {\r\n      method: method,\r\n      mode: 'cors',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n      // 注销的时候自带 refresh_token\r\n      headers: this.get_headers(Boolean(router === 'session' && method === 'DELETE')),\r\n    };\r\n    // console.log('request', router, method, data, payload);\r\n    // console.log(`${this.url}/${router}`);\r\n    let resp = null;\r\n    try {\r\n      resp = await fetch(`${this.url}/${router}`, payload);\r\n    } catch (e) {\r\n      console.error(e);\r\n      store.dispatch(setErrorInfo(e));\r\n      resp = { status: 433, error: \"Error when fetching internet\" };\r\n      return { code: resp.status, error: resp.statusText };\r\n    }\r\n    let js = null;\r\n    try { js = await resp.json(); } catch (e) {\r\n      console.error(e);\r\n      store.dispatch(setErrorInfo(e));\r\n      return { code: resp.status, error: resp.statusText };\r\n    }\r\n    console.log('raw js:', js);\r\n    if (!js) {\r\n      // console.log(await resp.json());\r\n      js = {};\r\n      js.message = resp.statusText;\r\n    }\r\n    if (js.code === undefined) js.code = resp.status;\r\n    if (js.code === 422) {\r\n      if (this.refresh_token === '') {\r\n        // 过期勒\r\n        return null;\r\n      }\r\n      // ac_token到期，准备更新\r\n      // console.log(this.get_headers(true));\r\n      const resp2 = await fetch(`${this.url}/session`, {\r\n        method: 'GET',\r\n        mode: 'cors',\r\n        headers: this.get_headers(true),\r\n        // body: JSON.stringify({ refresh_token: this.refresh_token })\r\n      });\r\n      try {\r\n        const js2 = await resp2.json();\r\n        // console.log('updating ac_token', js2);\r\n        if (js2.code === 200) {\r\n          this.set_token(js2.data.access_token, js2.data.refresh_token);\r\n          this.update_config();\r\n          // 更新user\r\n          const res = this.request('user', 'GET');\r\n          if (res.code === 200) {\r\n            store.dispatch(setUser(res.data.user));\r\n          }\r\n        }\r\n        else {\r\n          // 判定为 update_token 也过期，要求重新登录\r\n          store.dispatch(setErrorInfo(\"登录过期，请重新登录\"));\r\n          return null;\r\n        }\r\n      } catch (e) {\r\n        // console.error(e);\r\n        return { code: resp2.status, error: resp2.statusText };\r\n      }\r\n      return this.request(router, method, data);\r\n    }\r\n    if (js.code === 200) {\r\n      // 登录自动储存 JWT 数据\r\n      if (router === 'session' && method === 'POST') {\r\n        const { access_token, refresh_token } = js.data;\r\n        // console.log('jwt', access_token, refresh_token);\r\n        this.set_token(access_token, refresh_token);\r\n        this.update_config();\r\n      } else if (router === 'session' && method === 'DELETE') {\r\n        // 注销\r\n        // console.warn('注销');\r\n        this.set_token('', '');\r\n        this.update_config();\r\n      }\r\n    } else {\r\n      store.dispatch(setErrorInfo(js));\r\n    }\r\n    return js;\r\n  }\r\n}\r\n\r\nconst api = new API();\r\n\r\nexport { API, api };","import { createMuiTheme, makeStyles, ThemeProvider } from '@material-ui/core/styles';\r\nimport { orange, grey, blueGrey } from '@material-ui/core/colors';\r\nimport { api } from \"./api/api\";\r\n\r\nconst ITEM_NAME = \"group_bying_config\";\r\n\r\nclass Config {\r\n  constructor() {\r\n    this.load = this.load.bind(this);\r\n    this.save = this.save.bind(this);\r\n    this.theme_avaliable = {\r\n      \"默认主题\": createMuiTheme({}),\r\n      '黑暗模式': createMuiTheme({\r\n        palette: {\r\n          type: \"dark\",\r\n          primary: {\r\n            main: blueGrey[500],\r\n          },\r\n          secondary: {\r\n            main: grey[500],\r\n          },\r\n        },\r\n      }),\r\n    }\r\n    // 在构造函数执行的时候加载保存的数据\r\n    this.data_default = {\r\n      debug: false,\r\n      version_frontend: 0.1,\r\n      // 显示主题\r\n      // theme_name: \"黑暗模式\",\r\n      theme_name: \"默认主题\",\r\n      theme_avaliable: [\r\n        '默认主题',\r\n        '黑暗模式'\r\n      ],\r\n      // 设置同步\r\n      settings_async: true,\r\n      // 远程登录服务器\r\n      remote_login: {\r\n        server: \"ws://127.0.0.1:8081\"\r\n      },\r\n      api_token: {}\r\n    };\r\n    this.data = this.data_default;\r\n    this.theme = this.theme_avaliable[\"默认主题\"];\r\n    this.load();\r\n  }\r\n\r\n  load() {\r\n    console.log(\"Config: loading config...\");\r\n    if (this.data.debug) {\r\n      console.log(\"Config: load default config.\");\r\n      this.save();\r\n    }\r\n    try {\r\n      this.data = JSON.parse(localStorage.getItem(ITEM_NAME));\r\n      if (!this.data) throw new Error(\"Null data\");\r\n      console.log(\"Got data:\", this.data);\r\n      if (!this.data.version_frontend || this.data.version_frontend < this.data_default.version_frontend) {\r\n        // 版本升级，增量更新\r\n        console.log(`Config: update ${this.data.version_frontend} -> ${this.data_default.version_frontend}`);\r\n        this.data.version_frontend = this.data_default.version_frontend;\r\n        for (let k in this.data_default) {\r\n          if (!this.data[k]) {\r\n            console.log(`    Config: add value ${k}`);\r\n            this.data[k] = this.data_default[k];\r\n          }\r\n        }\r\n        this.save();\r\n      }\r\n    } catch (e) {\r\n      console.warn(`Can not find ${ITEM_NAME} in localStorage, use default config.`);\r\n      this.data = this.data_default;\r\n      this.save();\r\n    }\r\n    this.theme = this.theme_avaliable[this.data.theme_name];\r\n    if (!this.theme) this.theme = this.theme_avaliable[\"default\"];\r\n    api.set_token(this.data.api_token.access_token, this.data.api_token.refresh_token);\r\n  }\r\n\r\n  save() {\r\n    console.log(\"Config: saving config...\");\r\n    this.data.api_token = api.get_token();\r\n    const s = JSON.stringify(this.data);\r\n    localStorage.setItem(ITEM_NAME, s);\r\n    return s;\r\n  }\r\n\r\n  static clear() {\r\n    console.log(\"Config: clearing all data...\");\r\n    localStorage.setItem(ITEM_NAME, undefined);\r\n  }\r\n};\r\n\r\nexport default Config;","import { combineReducers } from 'redux'\r\nimport Config from \"../Config\"\r\n\r\nconst defaultState = {\r\n  config: new Config(),\r\n  tasks: [],\r\n  user: null,\r\n  daemon: null,\r\n  errorInfo: null,\r\n  message: null,\r\n  types: {},\r\n}\r\n\r\nfunction types(state = defaultState.types, action) {\r\n  switch (action.type) {\r\n    case \"SET_TYPES\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction config(state = defaultState.config, action) {\r\n  switch (action.type) {\r\n    case \"SET_CONFIG\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction user(state = defaultState.user, action) {\r\n  switch (action.type) {\r\n    case \"SET_USER\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction tasks(state = defaultState.tasks, action) {\r\n  switch (action.type) {\r\n    case \"SET_TASKS\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction daemon(state = defaultState.daemon, action) {\r\n  switch (action.type) {\r\n    case \"SET_DAEMON\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction errorInfo(state = defaultState.errorInfo, action) {\r\n  switch (action.type) {\r\n    case \"SET_ERROR_INFO\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction message(state = defaultState.message, action) {\r\n  switch (action.type) {\r\n    case \"SET_MESSAGE\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default combineReducers({ config, errorInfo, message, daemon, user, tasks, types });\r\n","// applyMiddleware: redux通过该函数来使用中间件\r\n// createStore: 用于创建store实例\r\nimport { applyMiddleware, createStore } from 'redux'\r\n\r\n// 中间件，作用：如果不使用该中间件，当我们dispatch一个action时，需要给dispatch函数传入action        \r\n// 对象；但如果我们使用了这个中间件，那么就可以传入一个函数，这个函数接收两个参数:dispatch和    \r\n// getState。这个dispatch可以在将来的异步请求完成后使用，对于异步action很有用\r\nimport thunk from 'redux-thunk'\r\n\r\n// 引入reducer\r\nimport reducers from './reducers.js'\r\n\r\n// 创建store实例\r\nlet store = createStore(\r\n    reducers,\r\n    applyMiddleware(thunk)\r\n)\r\nexport default store","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ListItem, ListItemText, ListItemIcon } from '@material-ui/core';\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\n\r\nfunction ListItemLink(props) {\r\n  const { icon, primary, to, onClick } = props;\r\n\r\n  const renderLink = React.useMemo(\r\n    () => React.forwardRef((itemProps, ref) => <RouterLink to={to} ref={ref} {...itemProps} />),\r\n    [to],\r\n  );\r\n\r\n  return (\r\n    <li>\r\n      <ListItem button component={renderLink} onClick={onClick}>\r\n        {icon ? <ListItemIcon>{icon}</ListItemIcon> : null}\r\n        <ListItemText primary={primary} />\r\n      </ListItem>\r\n    </li>\r\n  );\r\n}\r\n\r\nListItemLink.propTypes = {\r\n  icon: PropTypes.element,\r\n  primary: PropTypes.string.isRequired,\r\n  to: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default ListItemLink;\r\n\r\n","import { Select, Box, Button, Container, Dialog, DialogActions, DialogContent, DialogTitle, List, ListItem, ListItemSecondaryAction, ListItemText, TextField, Typography, MenuItem, IconButton } from \"@material-ui/core\";\r\nimport { DateTimePicker } from \"@material-ui/pickers\";\r\nimport React from \"react\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport store from \"../data/store\";\r\nimport { isIterator, objectUpdate, timedeltaUnits } from \"../utils/utils\";\r\nimport moment from \"moment\";\r\n\r\nexport default function ListEdit(props) {\r\n  const { defaultValue, open, onClose, title, keyNames, dataType, typeName } = props;\r\n  const dismiss = props.dismiss && isIterator(props.dismiss) ? props.dismiss : [];\r\n  const onSave = props.onSave ? props.onSave : null;\r\n  const [data, setInnerData] = React.useState(defaultValue);\r\n  const setData = (update) => setInnerData(objectUpdate(data, update));\r\n  const [openChild, setOpenChild] = React.useState(false);\r\n  const [child, setChild] = React.useState(null);\r\n  const [childTitle, setChildTitle] = React.useState(null);\r\n  const [timedeltaUnit, setTimedeltaUnit] = React.useState({});\r\n\r\n  const handleSave = () => {\r\n    onSave && onSave(data);\r\n  }\r\n\r\n  return <Dialog fullWidth open={open} onClose={onClose}>\r\n    <DialogTitle>{title}</DialogTitle>\r\n    <DialogContent>\r\n      <List style={{ width: \"100%\" }}>\r\n        {Object.keys(data).map((v, k) => {\r\n          if (dismiss.indexOf(v) >= 0) return null;\r\n          // console.log(\"store.getState().types\", store.getState().types);\r\n          // console.log(\"typeName\", typeName, \"dataType\", dataType);\r\n          const args = dataType && typeName && store.getState().types[typeName][dataType].args[v] ?\r\n            store.getState().types[typeName][dataType].args[v] : null;\r\n          // console.log('v', v, 'args', args);\r\n          if (dataType && typeName && args && !args.editable) return null;\r\n          const showName = keyNames ? (keyNames[v] || v) : (v);\r\n          // if (((typeof (data[v]) !== \"string\")) && !data[v]) return undefined;\r\n          let value = data[v];\r\n          if ((!value && typeof (value) !== \"number\") && dataType && typeName && args) {\r\n            value = `${args.type}|${args.value ? args.value : ''}`;\r\n          }\r\n          if (typeof (value) === 'object') {\r\n            return <ListItem key={k} button onClick={() => {\r\n              setChild(value);\r\n              setChildTitle(showName);\r\n              setOpenChild(true);\r\n            }}>{showName}</ListItem>\r\n          } else {\r\n            let actionData = null;\r\n            if (typeof (value) === \"string\" && value.startsWith(\"timezone|\")) {\r\n              // 时区暂时不可编辑\r\n              actionData = value.slice(\"timezone|\".length);\r\n            } else if (typeof (value) === \"string\" && value.startsWith(\"datetime|\")) {\r\n              // console.log('datetime:', value);\r\n              if (value === 'datetime|') {\r\n                actionData = <Button onClick={() => {\r\n                  setData({ [v]: `datetime|${new Date().toISOString()}` });\r\n                }}>点击设置</Button>;\r\n              } else {\r\n                actionData = <Box>\r\n                  <DateTimePicker\r\n                    value={value.slice(\"datetime|\".length)}\r\n                    onChange={e => {\r\n                      console.log(\"e\", e);\r\n                      // 这里会改变到没有时区的类型\r\n                      console.log(`datetime|${moment(e).format(\"YYYY-MM-DDTHH:mm:ss.SSSSSS+00:00\")}`);\r\n                      setData({ [v]: `datetime|${moment(e).format(\"YYYY-MM-DDTHH:mm:ss.SSSSSS+00:00\")}` });\r\n                    }}\r\n                  ></DateTimePicker>\r\n                  <IconButton onClick={() => {\r\n                    setData({ [v]: null });\r\n                  }}>\r\n                    <DeleteIcon></DeleteIcon>\r\n                  </IconButton>\r\n                </Box>;\r\n              }\r\n            } else if (typeof (value) === \"string\" && value.startsWith(\"timedelta|\")) {\r\n              const val = value.slice(\"timedelta|\".length);\r\n              const unit = timedeltaUnit[v] ? timedeltaUnit[v] : Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n              const updateFixed = () => {\r\n                // const unit2 = timedeltaUnit[v] ? timedeltaUnit[v] : Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n                // const newValue2 = `timedelta|${parseFloat(('' + (parseFloat(data[v].slice(\"timedelta|\".length)) / timedeltaUnits[unit2]).toFixed(2) * timedeltaUnits[unit2]))}`\r\n                // console.log(\"newValue2\", newValue2);\r\n                // setData({ [v]: newValue2 });\r\n              };\r\n              actionData = <Box>\r\n                <TextField value={`${parseFloat(val) / timedeltaUnits[unit]}`} onChange={e => {\r\n                  let val = e.target.value;\r\n                  if (isNaN(parseFloat(val)))\r\n                    if (val.length > 0) return;\r\n                    else val = 0;\r\n                  const newValue = `timedelta|${parseFloat(val) * timedeltaUnits[unit]}`;\r\n                  setData({ [v]: newValue });\r\n                }} onBlur={updateFixed}></TextField>\r\n                <Select value={unit}\r\n                  onChange={e => {\r\n                    setTimedeltaUnit(objectUpdate(timedeltaUnit, { [v]: e.target.value }));\r\n                  }} onBlur={updateFixed}>\r\n                  {Object.keys(timedeltaUnits).map((key, k) => <MenuItem key={k} value={key}>\r\n                    {key}\r\n                  </MenuItem>)}\r\n                </Select>\r\n              </Box>\r\n            } else {\r\n              actionData = <TextField value={`${value}`} onChange={e => {\r\n                const newValue = e.target.value.length === 0 ? 0 : (typeof (value) === \"number\" ? parseFloat(e.target.value) : `${e.target.value}`);\r\n                if (isNaN(newValue)) return;\r\n                setData({ [v]: newValue });\r\n              }}></TextField>;\r\n            }\r\n            return <ListItem key={k}>\r\n              <ListItemText>{showName}</ListItemText>\r\n              <ListItemSecondaryAction>\r\n                {actionData}\r\n              </ListItemSecondaryAction>\r\n            </ListItem>;\r\n          }\r\n        }\r\n        )}\r\n      </List>\r\n      {(child && childTitle) ? <ListEdit defaultValue={child} open={openChild} onClose={() => { setOpenChild(false); }} title={childTitle}></ListEdit> : undefined}\r\n    </DialogContent>\r\n    {onSave ? <DialogActions>\r\n      <Button color=\"primary\" onClick={handleSave}>保存</Button>\r\n      <Button onClick={onClose}>取消</Button>\r\n    </DialogActions> : <DialogActions><Box style={{ width: \"100%\", height: \"100%\", display: \"flex\", justifyContent: \"center\" }}><Typography style={{ height: \"100%\" }} variant=\"body1\" color=\"secondary\">无法保存</Typography></Box></DialogActions>}\r\n  </Dialog>\r\n}","import { Container, Dialog, DialogContent, DialogTitle, List, ListItem, ListItemSecondaryAction, ListItemText, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nexport default function ListInfo(props) {\r\n  const { data, open, onClose, title, keyNames } = props;\r\n  const [openChild, setOpenChild] = React.useState(false);\r\n  const [child, setChild] = React.useState(null);\r\n  const [childTitle, setChildTitle] = React.useState(null);\r\n  // console.log(data);\r\n  // Object.keys(data).map((v, k) => { console.log(`v: ${v}, k: ${k}`) })\r\n\r\n  return <Dialog fullWidth open={open} onClose={onClose}>\r\n    <DialogTitle>{title}</DialogTitle>\r\n    <DialogContent>\r\n      <List style={{ width: \"100%\" }}>\r\n        {Object.keys(data).map((v, k) => {\r\n          const showName = keyNames ? (keyNames[v] || v) : (v);\r\n          if (!data[v]) return undefined;\r\n          if (typeof (data[v]) === 'object') {\r\n            return <ListItem key={k} button onClick={() => {\r\n              setChild(data[v]);\r\n              setChildTitle(showName);\r\n              setOpenChild(true);\r\n            }}>{showName}</ListItem>\r\n          } else {\r\n            const s = `${data[v]}`;\r\n            return <ListItem key={k}>\r\n              <ListItemText>{showName}</ListItemText>\r\n              <ListItemSecondaryAction>\r\n                <Typography variant=\"body1\">{s.slice(0, 20) + (s.length > 20 ? \"...\" : \"\")}</Typography>\r\n              </ListItemSecondaryAction>\r\n            </ListItem>\r\n          }\r\n        }\r\n        )}\r\n      </List>\r\n      {(child && childTitle) ? <ListInfo data={child} open={openChild} onClose={() => { setOpenChild(false); }} title={childTitle}></ListInfo> : undefined}\r\n    </DialogContent>\r\n  </Dialog>\r\n}","import { Box, Grid, List, ListItem, Typography, Paper, Card, CardContent, CardActions, Button } from \"@material-ui/core\";\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport { setTypes, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { deepCopy, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\nimport ListEdit from \"./ListEdit\";\r\nimport ListInfo from \"./ListInfo\";\r\n\r\nconst keyNames = {\r\n  \"item_id\": \"目标项目ID\",\r\n  \"target_price\": \"目标价格\"\r\n};\r\n\r\nexport function isActionModified(item, type = \"actions\") {\r\n  try {\r\n    return !isObjectValueEqual(item.data, store.getState().types[type][item.type].data);\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function updateActionData(callback) {\r\n  return api.request(\"action\", 'GET').then(resp => {\r\n    // console.log(\"resp\", resp);\r\n    store.dispatch(updateTypes(\"actions\", resp.data.actions));\r\n    callback && callback(resp.data.actions);\r\n  });\r\n}\r\n\r\nexport async function wrapAction(action) {\r\n  const actionType = action.action_type;\r\n  let actionData = null;\r\n  if (!store.getState().types.actions || !store.getState().types.actions[actionType]) {\r\n    await updateActionData((newActionData) => { actionData = newActionData[actionType]; });\r\n  } else actionData = store.getState().types.actions[actionType];\r\n  if (!actionData) return null;\r\n  return objectUpdate(actionData, { data: action });\r\n}\r\n\r\n\r\nfunction getTimedeltaString(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return \"\";\r\n  const timedeltaUnits = {\r\n    \"秒\": 1, \"分\": 60, \"时\": 60 * 60,\r\n    \"天\": 24 * 60 * 60, \"周\": 7 * 24 * 60 * 60\r\n  };\r\n  for (let i = 1; i < Object.keys(timedeltaUnits).length; i++) {\r\n    if (timedelta < timedeltaUnits[Object.keys(timedeltaUnits)[i]]) {\r\n      return `${(timedelta / timedeltaUnits[Object.keys(timedeltaUnits)[i - 1]]).toFixed(2)}${Object.keys(timedeltaUnits)[i - 1]}`;\r\n    }\r\n  }\r\n  return `${(timedelta / timedeltaUnits[Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]]).toFixed(2)}${Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]}`;\r\n}\r\n\r\nfunction getDataString(data, typeName, dataType) {\r\n  let res = \"\";\r\n  if (typeof (data) !== 'object') return;\r\n  for (const key in data) {\r\n    const showName = keyNames ? (keyNames[key] || key) : (key);\r\n    const args = dataType && typeName && store.getState().types[typeName][dataType].args[key] ?\r\n      store.getState().types[typeName][dataType].args[key] : null;\r\n    if (args && !args.editable) continue;\r\n    let value = data[key];\r\n    if (!value && typeof (value) !== 'number') continue;\r\n    if (typeof (value) === 'string') {\r\n      if (value.startsWith(\"datetime|\")) {\r\n        value = moment(value.slice('datetime|'.length)).calendar();\r\n      } else if (value.startsWith('timedelta|')) {\r\n        value = getTimedeltaString(parseFloat(value.slice('timedelta|'.length)));\r\n      }\r\n    }\r\n    res = `${(res.length === 0 ? '' : (res + '/'))}${showName}:${value}`\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function ActionTag(props) {\r\n  let { action, selectMode, onClick, onSave, fullWidth, targets } = props;\r\n  const [dialogOpen, setDialogOpen] = React.useState(false);\r\n  // console.log('targets', targets);\r\n  const [actionTemp, setActionTemp] = React.useState((() => {\r\n    if (action.data.action_type === \"adjust_price\" && targets && targets.roomItem) {\r\n      let tmp = deepCopy(action);\r\n      tmp.data.item_id = targets.roomItem.itemId;\r\n      tmp.data.target_price = targets.roomItem.price;\r\n      return tmp;\r\n    } else return action;\r\n  })());\r\n  const [toUse, setToUse] = React.useState(false);\r\n  onClick = onClick ? onClick : () => { };\r\n  if (!action) return null;\r\n  const handleCloseDialog = () => { setDialogOpen(false); };\r\n  const handleClick = newAction => {\r\n    let selected = deepCopy(newAction ? newAction : actionTemp);\r\n    console.log(\"selected action:\", selected);\r\n    onClick(selected, selectMode);\r\n  };\r\n  return <Card style={{ minWidth: 200, margin: 10, width: (fullWidth ? \"100%\" : \"auto\") }}>\r\n    <CardContent onClick={selectMode ? () => { } : () => { handleClick(); }}>\r\n      <Typography variant=\"h5\">{action.name}</Typography>\r\n      {isActionModified(action, \"actions\") ?\r\n        getDataString(action.data, \"actions\", action.type) :\r\n        <Typography variant=\"body1\">{action.desc}</Typography>\r\n      }\r\n      <ListEdit\r\n        // dismiss={['version', 'timezone']}\r\n        keyNames={keyNames}\r\n        open={dialogOpen}\r\n        dataType={action.type}\r\n        typeName=\"actions\"\r\n        onClose={handleCloseDialog}\r\n        // defaultValue={action.data}\r\n        defaultValue={actionTemp.data}\r\n        onSave={newData => {\r\n          let newAction = deepCopy(action);\r\n          newAction.data = newData;\r\n          console.log('newData', newData);\r\n          onSave && onSave(newAction);\r\n          handleCloseDialog();\r\n          if (toUse) handleClick(newAction);\r\n        }}></ListEdit>\r\n    </CardContent>\r\n    {selectMode ? <CardActions>\r\n      <Button color=\"primary\" onClick={selectMode ? () => { handleClick(); } : () => { }}>使用</Button>\r\n      <Button color=\"primary\" onClick={() => { setDialogOpen(true); setToUse(true); }}>修改设置并使用</Button>\r\n    </CardActions> : <CardActions>\r\n      <Button color={isActionModified(action, \"actions\") ? \"primary\" : \"secondary\"} onClick={() => { setDialogOpen(true); }}>修改设置</Button>\r\n    </CardActions>}\r\n  </Card>\r\n}\r\n\r\nexport default function Actions(props) {\r\n  let { selectMode, onClick, targets } = props;\r\n  onClick = onClick ? onClick : () => { };\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const actions = store.getState().types.actions;\r\n  if (!actions && !requesting) {\r\n    setRequesting(true);\r\n    updateActionData().then(() => { forceUpdate(); });\r\n  }\r\n  // console.log('types', store.getState().types)\r\n  let content = null;\r\n  if (!actions) {\r\n    content = <Typography variant=\"body1\">正在加载Action类型...</Typography>\r\n  } else {\r\n    content = <Box style={{ display: \"flex\", flexDirection: \"row\", flexWrap: \"wrap\" }}>\r\n      {Object.keys(actions).map((action_type, k) => <ActionTag targets={targets} onClick={onClick} key={k} selectMode={selectMode} action={actions[action_type]}></ActionTag>)}\r\n    </Box>\r\n  }\r\n  return <Box>\r\n    {content}\r\n  </Box>\r\n}","import { Box, Grid, List, ListItem, Typography, Paper, Card, CardContent, CardActions, Button } from \"@material-ui/core\";\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport { setTypes, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { deepCopy, getTimedeltaString, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\nimport ListEdit from \"./ListEdit\";\r\nimport ListInfo from \"./ListInfo\";\r\n\r\nconst keyNames = {\r\n  'start_date': \"开始时间\",\r\n  'end_date': '结束时间',\r\n  \"interval\": \"间隔\",\r\n  \"run_date\": '运行时间'\r\n};\r\n\r\nexport function updateTriggerData(callback) {\r\n  return api.request(\"trigger\", 'GET').then(resp => {\r\n    // console.log(\"resp\", resp);\r\n    store.dispatch(updateTypes(\"triggers\", resp.data.triggers));\r\n    callback && callback(resp.data.triggers);\r\n  });\r\n}\r\n\r\nexport function isTriggerModified(item, type = \"triggers\") {\r\n  try {\r\n    return !isObjectValueEqual(item.data, store.getState().types[type][item.type].data);\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function getTriggerType(trigger) {\r\n  if (trigger.interval) return 'interval';\r\n  if (trigger.run_date) return 'date';\r\n  return 'cron';\r\n}\r\n\r\nexport async function wrapTrigger(trigger) {\r\n  const triggerType = getTriggerType(trigger);\r\n  let triggerData = null;\r\n  if (!store.getState().types.triggers || !store.getState().types.triggers[triggerType]) {\r\n    await updateTriggerData((newTriggerData) => { triggerData = newTriggerData[triggerType] });\r\n  } else triggerData = store.getState().types.triggers[triggerType];\r\n  return objectUpdate(triggerData, { data: trigger });\r\n}\r\n\r\nfunction getDataString(data, typeName, dataType) {\r\n  let res = \"\";\r\n  if (typeof (data) !== 'object') return;\r\n  for (const key in data) {\r\n    const showName = keyNames ? (keyNames[key] || key) : (key);\r\n    const args = dataType && typeName && store.getState().types[typeName][dataType].args[key] ?\r\n      store.getState().types[typeName][dataType].args[key] : null;\r\n    if (args && !args.editable) continue;\r\n    let value = data[key];\r\n    if (!value) continue;\r\n    if (value.startsWith(\"datetime|\")) {\r\n      value = moment(value.slice('datetime|'.length)).calendar();\r\n    } else if (value.startsWith('timedelta|')) {\r\n      value = getTimedeltaString(parseFloat(value.slice('timedelta|'.length)));\r\n    }\r\n    res = `${(res.length === 0 ? '' : (res + '/'))}${showName}:${value}`\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function TriggerTag(props) {\r\n  let { trigger, selectMode, onClick, onSave, fullWidth } = props;\r\n  const [dialogOpen, setDialogOpen] = React.useState(false);\r\n  const [toUse, setToUse] = React.useState(false);\r\n  onClick = onClick ? onClick : () => { };\r\n  if (!trigger) return null;\r\n  const handleCloseDialog = () => { setDialogOpen(false); };\r\n  const handleClick = newTrigger => {\r\n    onClick(newTrigger ? newTrigger : trigger, selectMode);\r\n  };\r\n  return <Card style={{ minWidth: 200, margin: 10, width: (fullWidth ? \"100%\" : \"auto\") }}>\r\n    <CardContent onClick={selectMode ? () => { } : () => { handleClick(); }}>\r\n      <Typography variant=\"h5\">{trigger.name}</Typography>\r\n      {isTriggerModified(trigger, \"triggers\") ?\r\n        getDataString(trigger.data, \"triggers\", trigger.type) :\r\n        <Typography variant=\"body1\">{trigger.desc}</Typography>\r\n      }\r\n      <ListEdit\r\n        dismiss={['version', 'timezone']}\r\n        keyNames={keyNames}\r\n        open={dialogOpen}\r\n        dataType={trigger.type}\r\n        typeName=\"triggers\"\r\n        onClose={handleCloseDialog}\r\n        defaultValue={trigger.data}\r\n        onSave={newData => {\r\n          let newTrigger = deepCopy(trigger);\r\n          newTrigger.data = newData;\r\n          console.log(newData);\r\n          onSave && onSave(newTrigger);\r\n          handleCloseDialog();\r\n          if (toUse) handleClick(newTrigger);\r\n        }}></ListEdit>\r\n    </CardContent>\r\n    {selectMode ? <CardActions>\r\n      <Button color=\"primary\" onClick={selectMode ? () => { handleClick(); } : () => { }}>使用</Button>\r\n      <Button color=\"primary\" onClick={() => { setDialogOpen(true); setToUse(true); }}>修改设置并使用</Button>\r\n    </CardActions> : <CardActions>\r\n      <Button color={isTriggerModified(trigger, \"triggers\") ? \"primary\" : \"secondary\"} onClick={() => { setDialogOpen(true); }}>修改设置</Button>\r\n    </CardActions>}\r\n  </Card>\r\n}\r\n\r\nexport default function Triggers(props) {\r\n  let { selectMode, onClick } = props;\r\n  onClick = onClick ? onClick : () => { };\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const triggers = store.getState().types.triggers;\r\n  if (!triggers && !requesting) {\r\n    setRequesting(true);\r\n    updateTriggerData().then(() => { forceUpdate(); });\r\n  }\r\n  // console.log('types', store.getState().types)\r\n  let content = null;\r\n  if (!triggers) {\r\n    content = <Typography variant=\"body1\">正在加载触发器类型...</Typography>\r\n  } else {\r\n    content = <Box style={{ display: \"flex\", flexDirection: \"row\", flexWrap: \"wrap\" }}>\r\n      {Object.keys(triggers).map((trigger_type, k) => <TriggerTag onClick={onClick} key={k} selectMode={selectMode} trigger={triggers[trigger_type]}></TriggerTag>)}\r\n    </Box>\r\n  }\r\n  return <Box>\r\n    {content}\r\n  </Box>\r\n}","import { Box, Button, Container, Dialog, DialogActions, DialogContent, DialogTitle, Grid, IconButton, List, ListItem, ListItemSecondaryAction, ListItemText, ListSubheader, TextField, Typography } from \"@material-ui/core\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport Actions, { wrapAction } from \"../components/Actions\";\r\nimport { ActionTag, isActionModified } from \"../components/Actions\";\r\nimport Triggers, { wrapTrigger } from \"../components/Triggers\";\r\nimport { TriggerTag, isTriggerModified } from \"../components/Triggers\";\r\nimport { setErrorInfo, setTasks, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { arrayRemove, deepCopy, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\n\r\nlet taskDialogUpdate = false;\r\n\r\nexport function setTaskDialogUpdate(val) { taskDialogUpdate = val; }\r\n\r\nexport default function TaskDialog(props) {\r\n  const { addMode, open, onClose, onRefresh, onSave, targets } = props;\r\n  const taskOld = props.taskOld === true ? null : props.taskOld;\r\n  // console.log('targets', targets);\r\n  const baseTaskName = (targets && targets.taskName) ? targets.taskName : '未命名任务';\r\n  const realDefaultTask = {\r\n    task_name: baseTaskName,\r\n    triggers: [],\r\n    actions: [],\r\n  };\r\n  const defaultTask = addMode ? (props.defaultTask ? props.defaultTask : realDefaultTask) : taskOld ? taskOld : (props.defaultTask ? props.defaultTask : realDefaultTask);\r\n  const [state, setInnerState] = React.useState({\r\n    dialogAddTaskOpen: false,\r\n    dialogAddTriggerOpen: false,\r\n    dialogAddActionOpen: false,\r\n    dialogUpdateTrigger: false,\r\n    task: defaultTask,\r\n    requestingTaskData: false,\r\n    defaultTid: null,\r\n  });\r\n  // console.log('baseTaskName', baseTaskName, 'defaultTask', defaultTask);\r\n  // console.log('taskNow', state.task);\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const taskData = store.getState().types.task_data;\r\n\r\n  // console.log('taskNow', state.task);\r\n  if (!addMode && (taskDialogUpdate || (isObjectValueEqual(state.task, realDefaultTask) && !isObjectValueEqual(defaultTask, realDefaultTask)))) {\r\n    taskDialogUpdate = false;\r\n    setState({ task: defaultTask });\r\n  } else if (taskDialogUpdate) {\r\n    taskDialogUpdate = false;\r\n    setState({ task: defaultTask });\r\n  }\r\n\r\n  if (!state.requestingTaskData && !taskData) {\r\n    setState({ requestingTaskData: true });\r\n    api.request(\"task\", 'PATCH').then(resp => {\r\n      // console.log(\"resp\", resp);\r\n      let taskData = resp.data.task_data;\r\n      taskData.tid = null;\r\n      store.dispatch(updateTypes(\"task_data\", taskData));\r\n      forceUpdate();\r\n    })\r\n  }\r\n\r\n  const handleAddTask = addMode ? () => {\r\n    // console.log('pass#2');\r\n    if (!taskData) {\r\n      setErrorInfo(\"Task数据为空。\");\r\n      console.error(\"Task数据为空。\");\r\n      return;\r\n    }\r\n    // const task = objectUpdate(taskData, { triggers: state.task.triggers, actions: state.task.actions, task_name: state.task.task_name, tid: null, });\r\n    const task = objectUpdate(taskData, state.task);\r\n    console.log('task', task);\r\n    return api.request('task', \"POST\", { task }).then(resp => {\r\n      // console.log('resp', resp);\r\n      if (resp.code !== 200) return;\r\n      const defaultTid = resp.data.tid ? (resp.data.tid + 1) : null;\r\n      setState({\r\n        defaultTid,\r\n        taskName: store.getState().types.task_data ? `${baseTaskName}${defaultTid ? defaultTid : \"\"}` : baseTaskName,\r\n      });\r\n      onRefresh && onRefresh();\r\n    });\r\n  } : () => {\r\n    if (!taskOld) return;\r\n    const task = objectUpdate(taskOld, state.task);\r\n    console.log('task', task);\r\n    if (onSave)\r\n      return onSave(task);\r\n    else return new Promise((resolve, reject) => { resolve(); });\r\n  };\r\n\r\n  return <Dialog fullWidth open={open} onClose={() => { onClose && onClose() }}>\r\n    <DialogTitle>{addMode ? \"添加新任务\" : \"设置任务\"}</DialogTitle>\r\n    <DialogContent>\r\n      <List>\r\n        <ListSubheader>计划名称</ListSubheader>\r\n        <ListItem>\r\n          <TextField value={state.task.task_name} onChange={e => {\r\n            let newTask = deepCopy(state.task);\r\n            newTask.task_name = e.target.value;\r\n            setState({ task: newTask });\r\n          }}></TextField>\r\n        </ListItem>\r\n        <ListSubheader>触发器列表</ListSubheader>\r\n        {state.task.triggers.map((trigger, k) => <ListItem key={k}>\r\n          <TriggerTag fullWidth trigger={trigger} onSave={data => {\r\n            console.log('saveing', data);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.triggers[k] = data;\r\n            setState({ task: newTask });\r\n          }}></TriggerTag>\r\n          <ListItemSecondaryAction>\r\n            <IconButton onClick={() => {\r\n              let newTask = deepCopy(state.task);\r\n              newTask.triggers.splice(k, 1);\r\n              setState({ task: newTask });\r\n            }}>\r\n              <DeleteIcon></DeleteIcon>\r\n            </IconButton>\r\n          </ListItemSecondaryAction>\r\n        </ListItem>)}\r\n        <ListSubheader>Actions列表</ListSubheader>\r\n        {state.task.actions.map((action, k) => <ListItem key={k}>\r\n          <ActionTag fullWidth action={action} onSave={data => {\r\n            console.log('saveing', data);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.actions[k] = data;\r\n            setState({ task: newTask });\r\n          }}></ActionTag>\r\n          <ListItemSecondaryAction>\r\n            <IconButton onClick={() => {\r\n              let newTask = deepCopy(state.task);\r\n              newTask.actions.splice(k, 1);\r\n              setState({ task: newTask });\r\n            }}>\r\n              <DeleteIcon></DeleteIcon>\r\n            </IconButton>\r\n          </ListItemSecondaryAction>\r\n        </ListItem>)}\r\n        <ListItem>\r\n          <Grid container spacing={5}>\r\n            <Grid item xs={12} lg={6}>\r\n              <Button fullWidth onClick={() => { setState({ dialogAddTriggerOpen: true }) }} color=\"primary\" variant=\"outlined\">添加触发器</Button>\r\n            </Grid>\r\n            <Grid item xs={12} lg={6}>\r\n              <Button fullWidth onClick={() => { setState({ dialogAddActionOpen: true }) }} color=\"primary\" variant=\"outlined\">添加Action</Button>\r\n            </Grid>\r\n          </Grid>\r\n        </ListItem>\r\n      </List>\r\n      <Dialog open={state.dialogAddTriggerOpen} onClose={() => setState({ dialogAddTriggerOpen: false })}>\r\n        <DialogTitle>选择一个触发器</DialogTitle>\r\n        <DialogContent>\r\n          <Triggers targets={targets} onClick={trigger => {\r\n            console.log(\"trigger\", trigger);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.triggers.push(trigger);\r\n            setState({ dialogAddTriggerOpen: false, task: newTask });\r\n          }} selectMode></Triggers>\r\n        </DialogContent>\r\n      </Dialog>\r\n      <Dialog open={state.dialogAddActionOpen} onClose={() => setState({ dialogAddActionOpen: false })}>\r\n        <DialogTitle>选择一个Action</DialogTitle>\r\n        <DialogContent>\r\n          <Actions targets={targets} onClick={action => {\r\n            console.log(\"action\", action);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.actions.push(action);\r\n            setState({ dialogAddActionOpen: false, task: newTask });\r\n          }} selectMode></Actions>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </DialogContent>\r\n    <DialogActions>\r\n      <Button color=\"primary\" disabled={state.task.triggers.length === 0 || state.task.actions.length === 0} onClick={async () => {\r\n        // console.log('pass#1');\r\n        handleAddTask().then(() => {\r\n          setState({ task: defaultTask });\r\n          onClose && onClose();\r\n        });\r\n      }}>确定</Button>\r\n      <Button onClick={() => { onClose && onClose(); }}>取消</Button>\r\n    </DialogActions>\r\n  </Dialog >;\r\n}","import { Box, Button, Container, Dialog, DialogActions, DialogContent, DialogTitle, Grid, IconButton, List, ListItem, ListItemSecondaryAction, ListItemText, ListSubheader, TextField, Typography } from \"@material-ui/core\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport Actions, { wrapAction } from \"../components/Actions\";\r\nimport { ActionTag, isActionModified } from \"../components/Actions\";\r\nimport TaskDialog, { setTaskDialogUpdate } from \"../components/TaskDialog\";\r\nimport Triggers, { wrapTrigger } from \"../components/Triggers\";\r\nimport { TriggerTag, isTriggerModified } from \"../components/Triggers\";\r\nimport { setErrorInfo, setTasks, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { arrayRemove, deepCopy, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\n\r\n\r\nasync function wrapTask(task) {\r\n  const taskData = store.getState().types.task_data;\r\n  if (!taskData) return;\r\n  let taskWrapped = objectUpdate(taskData, task);\r\n  // taskWrapped.triggers = taskWrapped.triggers.map(async trigger => await wrapTrigger(trigger));\r\n  for (let i = 0; i < taskWrapped.triggers.length; i++)\r\n    taskWrapped.triggers[i] = await wrapTrigger(taskWrapped.triggers[i]);\r\n  // taskWrapped.actions = taskWrapped.actions.map(async action => await wrapAction(action));\r\n  for (let i = 0; i < taskWrapped.actions.length; i++)\r\n    taskWrapped.actions[i] = await wrapAction(taskWrapped.actions[i]);\r\n  if (taskWrapped.triggers.includes(null) || taskWrapped.actions.includes(null)) return null;\r\n  return taskWrapped;\r\n}\r\n\r\n\r\nfunction TaskTag(props) {\r\n  const { task, onUpdate, onClick } = props;\r\n  // return <code>{JSON.stringify(task)}</code>;\r\n  return <ListItem button onClick={async () => {\r\n    if (!onClick) return;\r\n    console.log('task before', task);\r\n    const taskWrapped = await wrapTask(task);\r\n    console.log('task after', taskWrapped);\r\n    taskWrapped && onClick && onClick(taskWrapped);\r\n  }}>\r\n    <ListItemText>\r\n      <Box>\r\n        <Typography variant=\"h5\">{task.task_name}</Typography>\r\n      </Box>\r\n      <Box>\r\n        <Typography variant=\"body2\">{`tid:${task.tid}/触发器:${task.triggers.length}/Action:${task.actions.length}`}</Typography>\r\n      </Box>\r\n    </ListItemText>\r\n    <ListItemSecondaryAction>\r\n      <IconButton onClick={() => {\r\n        api.request_key(\"task\", task.tid, \"DELETE\").then(resp => {\r\n          if (resp.code !== 200) store.dispatch(setErrorInfo(resp));\r\n          onUpdate && onUpdate();\r\n        });\r\n      }}>\r\n        <DeleteIcon></DeleteIcon>\r\n      </IconButton>\r\n    </ListItemSecondaryAction>\r\n  </ListItem>\r\n}\r\n\r\nexport function getTargetTasks(targets) {\r\n  const tasks = store.getState().tasks;\r\n  if (!targets || !targets.roomItem || (targets.roomItem && JSON.stringify(targets.roomItem) === \"{}\")) return tasks;\r\n  let result = [];\r\n  for (const task of tasks) {\r\n    for (const action of task.actions) {\r\n      if (!action) return [];\r\n      const target = action.data ? action.data : action;\r\n      // console.log('target', target, 'require', targets);\r\n      if (target.action_type === \"adjust_price\") {\r\n        if (targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n          result.push(task);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // if (result.length > 0) {\r\n  //   console.log(\"getTargetTasks\", result, targets, tasks);\r\n  //   // debugger;\r\n  // }\r\n  return result;\r\n}\r\n\r\nexport function getTargetTasksMarks(targets) {\r\n  if (targets) console.log(targets);\r\n  const tasks = store.getState().tasks;\r\n  const marks = tasks.map((task, k) => {\r\n    for (const action of task.actions) {\r\n      const target = action.data ? action.data : action;\r\n      if (target.action_type === \"adjust_price\") {\r\n        if (targets && targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n          console.log('found', task);\r\n          return true;\r\n        } else if (!targets) return true;\r\n      }\r\n    }\r\n    return false;\r\n  });\r\n  // if (!targets || !targets.roomItem || (targets.roomItem && JSON.stringify(targets.roomItem) === \"{}\")) return tasks;\r\n  // let result = [];\r\n  // for (const task of tasks) {\r\n  //   for (const action of task.actions) {\r\n  //     const target = action.data ? action.data : action;\r\n  //     if (target.action_type === \"adjust_price\") {\r\n  //       if (targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n  //         result.push(task);\r\n  //         break;\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n  // if (result.length > 0)\r\n  //   console.log(\"getTargetTasks\", result, targets, tasks);\r\n  // return result;\r\n  return marks;\r\n}\r\n\r\nexport function TaskList(props) {\r\n  const { onClick, onUpdate, targets, fullWidth } = props;\r\n  // const tasks = getTargetTasks(targets);\r\n  const tasks = props.tasks ? props.tasks : store.getState().tasks;\r\n  const marks = props.tasks ? getTargetTasksMarks(null) : getTargetTasksMarks(targets);\r\n  if (targets && targets.roomItem && JSON.stringify(targets.roomItem) !== \"{}\") console.log('tasks', targets, tasks);\r\n  // if (tasks.length > 0) console.log(tasks, marks);\r\n  return tasks.length > 0 ? <List>\r\n    {tasks.map((task, k) => marks[k] ? <TaskTag onClick={onClick} onUpdate={onUpdate} key={k} task={task}></TaskTag> : null)}\r\n  </List> : <List style={{ width: fullWidth ? \"100%\" : null }}>\r\n    <ListItem>\r\n      <Typography variant=\"body1\" color=\"textSecondary\">空列表</Typography>\r\n    </ListItem>\r\n  </List>\r\n}\r\n\r\nexport default function Tasks(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    requestingTasks: false,\r\n    dialogAddTaskOpen: false,\r\n    addMode: true,\r\n    task: null,\r\n  });\r\n  const tasks = store.getState().tasks;\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n\r\n  if (!state.requestingTasks) {\r\n    setState({ requestingTasks: true });\r\n    api.request(\"task\", \"GET\").then(resp => {\r\n      if (resp.code !== 200) {\r\n        store.dispatch(setErrorInfo(resp));\r\n        return;\r\n      }\r\n      store.dispatch(setTasks(resp.data.tasks));\r\n      forceUpdate();\r\n    });\r\n  }\r\n\r\n  return <Container>\r\n    <Grid container spacing={3}>\r\n      <Grid item lg={8} sm={12}>\r\n        <Typography variant=\"h4\">任务列表</Typography>\r\n        {/* {tasks.length > 0 ? <List>\r\n          {tasks.map((task, k) => <TaskTag onClick={task => {\r\n            console.log('Task: onClick', task);\r\n            setTaskDialogUpdate(true);\r\n            setState({ dialogAddTaskOpen: true, addMode: false, task });\r\n          }} onUpdate={() => { setState({ requestingTasks: false }); }} key={k} task={task}></TaskTag>)}\r\n        </List> : <List>\r\n          <ListItem>\r\n            <Typography variant=\"body1\" color=\"textSecondary\">空列表</Typography>\r\n          </ListItem>\r\n        </List>} */}\r\n        <TaskList onClick={task => {\r\n          console.log('Task: onClick', task);\r\n          setTaskDialogUpdate(true);\r\n          setState({ dialogAddTaskOpen: true, addMode: false, task });\r\n        }} onUpdate={() => { setState({ requestingTasks: false }); }}></TaskList>\r\n      </Grid>\r\n      <Grid item lg={4} sm={12}>\r\n        <Container maxWidth=\"xs\">\r\n          <List>\r\n            <ListSubheader>新任务</ListSubheader>\r\n            <ListItem>\r\n              <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={() => {\r\n                setTaskDialogUpdate(true);\r\n                setState({ dialogAddTaskOpen: true, addMode: true });\r\n              }}>添加新任务</Button>\r\n            </ListItem>\r\n            <ListItem>\r\n              <Button fullWidth variant=\"contained\">设置默认任务</Button>\r\n            </ListItem>\r\n\r\n            <ListSubheader>全部任务管理</ListSubheader>\r\n            <ListItem>\r\n              <Button fullWidth disabled={tasks.length === 0} variant=\"outlined\" onClick={() => {\r\n                let tids = {};\r\n                tasks.map(task => { tids = Object.assign(tids, { [task.tid]: task.tid }); return null; });\r\n                api.request(\"task\", \"DELETE\", { tids }).then(resp => {\r\n                  // forceUpdate();\r\n                  setState({ requestingTasks: false });\r\n                });\r\n              }}>删除全部任务</Button>\r\n            </ListItem>\r\n          </List>\r\n        </Container>\r\n      </Grid>\r\n    </Grid>\r\n    <TaskDialog taskOld={state.task}\r\n      addMode={state.addMode}\r\n      open={state.dialogAddTaskOpen}\r\n      onRefresh={() => { setState({ requestingTasks: false }); }}\r\n      onClose={() => { setState({ dialogAddTaskOpen: false }); }}\r\n      onSave={task => {\r\n        return api.request_key('task', task.tid, \"POST\", { task }).then(resp => {\r\n          setState({ requestingTasks: false });\r\n        });\r\n      }}\r\n    ></TaskDialog>\r\n  </Container >\r\n}","import React from 'react';\r\nimport { Box, Container, LinearProgress, Button, Dialog, Link, List, ListItemText, DialogTitle, DialogContent, ListItem, Typography, DialogActions } from '@material-ui/core';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { api } from '../api/api';\r\nimport store from '../data/store';\r\nimport { setDaemon, setErrorInfo, setTasks } from '../data/action';\r\nimport TaskDialog, { setTaskDialogUpdate } from \"./TaskDialog\";\r\nimport { weekDayList } from '../utils/utils';\r\nimport { getTargetTasks, TaskList } from '../pages/Tasks';\r\n\r\nconst useStyles = makeStyles({\r\n  table: {\r\n    minWidth: 1200,\r\n  },\r\n  foodDesc: {\r\n    overflow: 'hidden',\r\n    whiteSpace: 'nowrap',\r\n    contentOverflow: 'ellipsis',\r\n    maxWidth: 160\r\n  },\r\n  planButton: {\r\n    overflow: 'hidden',\r\n    whiteSpace: 'nowrap',\r\n    contentOverflow: 'ellipsis',\r\n    maxWidth: 160\r\n  }\r\n});\r\n\r\nfunction MyTableCell(props) {\r\n  let styles = { padding: 3 };\r\n  // console.log('props.noBorder', props.noBorder);\r\n  if (props.noBorder) styles.borderBottom = \"0\";\r\n  return <TableCell align={props.align} colSpan={props.colSpan} style={styles}>{props.content}</TableCell>\r\n}\r\n\r\n// 容易subscribe到已经卸载的component上面...\r\n// store.subscribe(() => {\r\n//   console.log('(tables) redux update to', store.getState());\r\n// });\r\n\r\nlet requestedDayData = null;\r\n// let roomItemNow = {};\r\nlet setUpdateTimer = null;\r\n\r\nfunction ReserveTable(props) {\r\n  const classes = useStyles();\r\n  // console.log('daemon', store.getState().daemon);\r\n  const [requestingDaemon, setRequestingDaemon] = React.useState(false);\r\n  const [requestingUpdate, setRequestingUpdate] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const { day, data } = props;\r\n  const date = new Date().setDay(day).toDateString();\r\n  // const [dayData, setDayData] = React.useState(data ? data : store.getState().daemon.reserve_table[date]);\r\n  const [dayData, setDayData] = React.useState(data);\r\n  const [roomList, setRoomList] = React.useState((store.getState().daemon &&\r\n    store.getState().daemon.reserve_table &&\r\n    store.getState().daemon.reserve_table[date]) ? store.getState().daemon.reserve_table[date].roomList : []);\r\n  const [dialogAddTaskOpen, setDialogAddTaskOpen] = React.useState(null);\r\n  const [dialogTasksListOpen, setDialogTasksListOpen] = React.useState(null);\r\n  const [roomItemNow, setRoomItemNow] = React.useState({});\r\n  const [requestingTasks, setRequestingTasks] = React.useState(false);\r\n\r\n  if (!requestingTasks && (!store.getState().tasks || (store.getState().tasks || store.getState().tasks.length === 0))) {\r\n    setRequestingTasks(true);\r\n    api.request(\"task\", \"GET\").then(resp => {\r\n      if (resp.code !== 200) return;\r\n      store.dispatch(setTasks(resp.data.tasks));\r\n      forceUpdate();\r\n    });\r\n  }\r\n\r\n  if (!store.getState().daemon) {\r\n    if (!requestingDaemon) {\r\n      setRequestingDaemon(true);\r\n      api.request(\"daemon\", \"GET\").then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n      });\r\n    }\r\n    return <LinearProgress></LinearProgress>;\r\n  }\r\n  if (!store.getState().daemon.reserve_table) {\r\n    if (!requestingUpdate) {\r\n      setRequestingUpdate(true);\r\n      api.request(\"daemon\", \"POST\", { daemon_args: { update_all: true } }).then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n      });\r\n    }\r\n    return <LinearProgress></LinearProgress>;\r\n  }\r\n\r\n  requestedDayData = JSON.stringify(store.getState().daemon.reserve_table[date]) !== '{}' && JSON.stringify(store.getState().daemon.reserve_table[date]) !== undefined;\r\n  // console.log('requested', requestedDayData);\r\n  // console.log('date', date);\r\n\r\n  const Period = function (props) {\r\n    const classes = useStyles();\r\n    const { data, roomList } = props;\r\n    // console.log('period', data, 'roomList', roomList);\r\n    // 先找到有几个row，再格式化输出\r\n    let maxRow = 0;\r\n    let roomNameList = [];\r\n    roomList.map((roomData, i) => {\r\n      maxRow = maxRow > data.roomMapItemEntry[roomData.roomName].length ? maxRow : data.roomMapItemEntry[roomData.roomName].length;\r\n      roomNameList.push(roomData.roomName);\r\n    });\r\n    // console.log('maxRow', maxRow);\r\n    let targetRowCenter = parseInt(maxRow / 2);\r\n    if (targetRowCenter < 0) targetRowCenter = 0;\r\n    // console.log('targetRowCenter', targetRowCenter);\r\n    let rows = [];\r\n    for (let i = 0; i < maxRow; i++) {\r\n      let cells = [<MyTableCell key=\"time\" key2=\"time\" align=\"center\" colSpan={1} content={targetRowCenter === i ? data.periodId : null} noBorder={maxRow - 1 !== i}></MyTableCell>,];\r\n      for (let name of roomNameList) {\r\n        // if (!(data.roomMapItemEntry[name] instanceof Array)) {\r\n        if (!(data.roomMapItemEntry[name][i])) {\r\n          // 没这个项的话也要占个位置\r\n          cells.push(<MyTableCell key={data.periodId + name + i + '_'} colSpan={1}></MyTableCell>);\r\n          continue;\r\n        }\r\n        let roomItem = data.roomMapItemEntry[name][i];\r\n        // 价格\r\n        cells.push(<MyTableCell key={data.periodId + name + roomItem.itemId + i + 'price'} align=\"center\" colSpan={1} content={'￥' + roomItem.price}></MyTableCell>);\r\n        // 说明\r\n        cells.push(<MyTableCell key={data.periodId + name + roomItem.itemId + i + 'desc'} align=\"center\" colSpan={1} content={<Box component=\"div\" className={classes.foodDesc}>\r\n          {roomItem.foodDesc}</Box>}></MyTableCell>);\r\n        // 库存\r\n        cells.push(<MyTableCell key={data.periodId + name + roomItem.itemId + i + 'stock'} align=\"center\" colSpan={1} content={i === targetRowCenter ? (roomItem.stock + '间') : ''} noBorder={maxRow - 1 !== i}></MyTableCell>);\r\n        // 计划\r\n        cells.push(<MyTableCell key={data.periodId + name + roomItem.itemId + i + 'plan'} align=\"center\" colSpan={1} content={\r\n          (() => {\r\n            let planCount = getTargetTasks({ roomItem }).length;\r\n            return (<Link key={data.periodId + name + roomItem.itemId + i + 'planLink'} onClick={planCount === 0 ? () => {\r\n              // console.log('roomItem', roomItem);\r\n              // console.log('data', data);\r\n              let parent = {};\r\n              for (const arg in data)\r\n                if (arg !== 'roomMapItemEntry')\r\n                  parent[arg] = data[arg];\r\n              roomItem.parent = parent;\r\n              // roomItemNow = roomItem;\r\n              setRoomItemNow(roomItem);\r\n              setTaskDialogUpdate(true);\r\n              setDialogAddTaskOpen(true);\r\n            } : () => {\r\n              const tasks = getTargetTasks({ roomItem });\r\n              console.log('got tasks', tasks);\r\n              let parent = {};\r\n              for (const arg in data)\r\n                if (arg !== 'roomMapItemEntry')\r\n                  parent[arg] = data[arg];\r\n              roomItem.parent = parent;\r\n              setRoomItemNow(roomItem);\r\n              setDialogTasksListOpen(tasks);\r\n            }} className={classes.planButton}>计划{planCount > 0 ? (`(${planCount})`) : ''}</Link>);\r\n          })()\r\n        }></MyTableCell>);\r\n        // 临时下线\r\n        // cells.push(<MyTableCell key={data.periodId + name + roomItem.itemId + i + 'off'} align=\"center\" colSpan={1} content={\r\n        //   <Link key={data.periodId + name + roomItem.itemId + i + 'planLink'} onClick={() => {\r\n        //     console.log('roomItem', roomItem);\r\n        //   }} >下线</Link>\r\n        // }></MyTableCell>);\r\n      }\r\n      // console.log('cells', cells);\r\n      rows.push(<TableRow key={data.periodId + i}>{cells}</TableRow>);\r\n    }\r\n    return rows;\r\n  }\r\n\r\n  if (!setUpdateTimer) {\r\n    setUpdateTimer = true;\r\n    // 每分钟更新数据\r\n    setTimeout(() => {\r\n      if (!updateData) return;\r\n      updateData();\r\n    }, 60 * 1000);\r\n  }\r\n\r\n  const updateData = () => {\r\n    // console.log('updating daemon!');\r\n    if (!requestedDayData) {\r\n      requestedDayData = true;\r\n      api.request(\"daemon\", \"POST\", { daemon_args: { reserve_table: { date } } }).then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n        requestedDayData = false;\r\n        forceUpdate();\r\n      });\r\n    } else {\r\n      let reserveTableData = store.getState().daemon.reserve_table[date];\r\n      // console.log('got from redux:', reserveTableData);\r\n      if (reserveTableData) {\r\n        setDayData(reserveTableData);\r\n        setRoomList(reserveTableData.roomList);\r\n        // 也是要请求一遍的\r\n        api.request(\"daemon\", \"POST\", { daemon_args: { reserve_table: { date } } }).then(resp => {\r\n          if (resp.code !== 200) return;\r\n          store.dispatch(setDaemon(resp.data));\r\n          requestedDayData = false;\r\n          forceUpdate();\r\n        });\r\n      } else {\r\n        // console.warn('got empty reserveTableData', dayData, store.getState().daemon.reserve_table, date, JSON.stringify(store.getState().daemon.reserve_table[date]));\r\n      }\r\n    }\r\n  };\r\n\r\n  if (!dayData) {\r\n    updateData();\r\n    return (<Container>\r\n      <LinearProgress></LinearProgress>\r\n    </Container>);\r\n  }\r\n  let tableHeaderCells = [<TableCell key=\"time\" align=\"center\" colSpan={1}>时间</TableCell>,];\r\n  roomList.map((d, i) => {\r\n    tableHeaderCells.push(<TableCell key={'a' + d + i} align=\"center\" colSpan={2}>售卖内容</TableCell>);\r\n    tableHeaderCells.push(<TableCell key={'b' + d + i} align=\"center\" colSpan={1}>库存</TableCell>);\r\n    tableHeaderCells.push(<TableCell key={'c' + d + i} align=\"center\" colSpan={1}>计划</TableCell>);\r\n    // tableHeaderCells.push(<TableCell key={'d' + d + i} align=\"center\" colSpan={1}>临时下线</TableCell>);\r\n  });\r\n  const tableHeader = <TableHead>\r\n    <TableRow>\r\n      <TableCell align=\"center\" colSpan={1}>[{date.slice(date.length - 2, date.length)}日{'周' + [\"日\", '一', '二', '三', '四', '五', '六'][day]}]</TableCell>\r\n      {roomList.map((d, i) =>\r\n        <TableCell align=\"center\" key={i} colSpan={5}>{d.roomName}({d.roomCapacity})</TableCell>\r\n      )}\r\n    </TableRow>\r\n    <TableRow>\r\n      {tableHeaderCells}\r\n    </TableRow>\r\n  </TableHead>;\r\n  if (!dayData || !dayData.periodList) {\r\n    // console.log('no data!', dayData, typeof (dayData));\r\n    return (<Container>\r\n      <header></header>\r\n      <LinearProgress></LinearProgress>\r\n    </Container>);\r\n  }\r\n  // console.log(\"roomItemNow\", roomItemNow);\r\n  return (\r\n    <Container>\r\n      <TableContainer component={Paper}>\r\n        <Table stickyHeader className={classes.table}>\r\n          {tableHeader}\r\n          <TableBody>\r\n            {dayData.periodList.map((d, i) =>\r\n              <Period key={'period' + i} data={d} roomList={roomList}></Period>\r\n            )}\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n      <Dialog open={!!dialogTasksListOpen} onClose={() => { setDialogTasksListOpen(null); }}>\r\n        <DialogTitle>任务列表</DialogTitle>\r\n        <DialogContent>\r\n          {/* {roomItemNow && JSON.stringify(roomItemNow) !== \"{}\" ?  */}\r\n          {dialogTasksListOpen ? <TaskList fullWidth tasks={dialogTasksListOpen}\r\n            // onClick={task => {\r\n            //   console.log('click task', task);\r\n            //   setDialogAddTaskOpen(task);\r\n            // }}\r\n            onUpdate={() => {\r\n              api.request(\"task\", \"GET\").then(resp => {\r\n                if (resp.code !== 200) return;\r\n                store.dispatch(setTasks(resp.data.tasks));\r\n                forceUpdate();\r\n              });\r\n            }}></TaskList> : null\r\n            // <code>{`${console.log(roomItemNow, dialogTasksListOpen)}`}</code>\r\n          }\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button color=\"primary\" onClick={() => {\r\n            setTaskDialogUpdate(true);\r\n            setDialogAddTaskOpen(true);\r\n          }}>添加任务</Button>\r\n          <Button color=\"primary\" onClick={() => { setDialogTasksListOpen(null); }}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <TaskDialog\r\n        taskOld={dialogAddTaskOpen}\r\n        addMode={dialogAddTaskOpen === true}\r\n        targets={{ roomItem: roomItemNow, taskName: (roomItemNow && JSON.stringify(roomItemNow) !== \"{}\") ? `${roomItemNow.roomType}周${weekDayList[new Date().getDay()]}${roomItemNow.parent.periodDesc}` : null }}\r\n        open={!!dialogAddTaskOpen}\r\n        onRefresh={() => {\r\n          // 更新Task数据\r\n          updateData();\r\n          api.request(\"task\", \"GET\").then(resp => {\r\n            if (resp.code !== 200) {\r\n              store.dispatch(setErrorInfo(resp));\r\n              return;\r\n            }\r\n            store.dispatch(setTasks(resp.data.tasks));\r\n            setDialogTasksListOpen(null);\r\n            forceUpdate();\r\n          });\r\n        }}\r\n        onClose={() => { setDialogAddTaskOpen(null); }}\r\n        onSave={task => {\r\n          return api.request_key('task', task.tid, \"POST\", { task }).then(resp => {\r\n            // setState({ requestingTasks: false });\r\n            console.log(\"update task done\");\r\n          });\r\n        }}\r\n      ></TaskDialog>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default ReserveTable;","import React from 'react'\r\nimport { LinearProgress, Button, Container, Dialog, DialogTitle, IconButton } from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport PropTypes from 'prop-types';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Tabs from '@material-ui/core/Tabs';\r\nimport Tab from '@material-ui/core/Tab';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport VisibilityIcon from '@material-ui/icons/Visibility';\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport ReserveTable from './ReserveTable';\r\nimport { weekDayList } from '../utils/utils';\r\n\r\nfunction TabPanel(props) {\r\n  const { children, value, index, ...other } = props;\r\n\r\n  return (\r\n    <div\r\n      role=\"tabpanel\"\r\n      hidden={value !== index}\r\n      id={`scrollable-auto-tabpanel-${index}`}\r\n      aria-labelledby={`scrollable-auto-tab-${index}`}\r\n      {...other}\r\n    >\r\n      {value === index && (\r\n        <Box>\r\n          {/* <Typography>{children}</Typography> */}\r\n          {children}\r\n        </Box>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nTabPanel.propTypes = {\r\n  children: PropTypes.node,\r\n  index: PropTypes.any.isRequired,\r\n  value: PropTypes.any.isRequired,\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    overflowX: 'auto',\r\n    display: 'block',\r\n    width: '100%',\r\n    flexGrow: 1,\r\n    width: '100%',\r\n    backgroundColor: theme.palette.background.paper,\r\n  },\r\n  formControl: {\r\n    margin: theme.spacing(1),\r\n    minWidth: 120,\r\n  },\r\n  selectEmpty: {\r\n    marginTop: theme.spacing(2),\r\n  },\r\n}));\r\n\r\nfunction a11yProps(index) {\r\n  return {\r\n    id: `scrollable-auto-tab-${index}`,\r\n    'aria-controls': `scrollable-auto-tabpanel-${index}`,\r\n  };\r\n}\r\n\r\nexport default function ReserveTables(props) {\r\n  const classes = useStyles();\r\n  const [tabValue, setTableValue] = React.useState(new Date().getDay());\r\n  const [showTable, setShowTable] = React.useState(false);\r\n  const [fullShow, setFullShow] = React.useState(false);\r\n  const handleChange = (event) => {\r\n    setTableValue(event.target.value);\r\n  };\r\n  const table = <div className={classes.root}>\r\n    <Tabs\r\n      value={tabValue}\r\n      onChange={(e, val) => setTableValue(val)}\r\n      indicatorColor=\"primary\"\r\n      textColor=\"primary\"\r\n      variant=\"scrollable\"\r\n      scrollButtons=\"auto\"\r\n      aria-label=\"scrollable auto tabs example\"\r\n    >\r\n      {[\"日\", '一', '二', '三', '四', '五', '六'].map((d, i) => {\r\n        return (<Tab label={'周' + d} key={i} {...a11yProps(i)} />);\r\n      })}\r\n    </Tabs>\r\n    {[0, 1, 2, 3, 4, 5, 6].map((d, i) => <TabPanel key={i} value={tabValue} index={d}>\r\n      <ReserveTable day={tabValue}></ReserveTable>\r\n    </TabPanel>)}\r\n  </div>;\r\n  return (\r\n    // <Container className={classes.root}>\r\n    <div>\r\n      <FormControl className={classes.formControl}>\r\n        <InputLabel>选择日期</InputLabel>\r\n        <Select\r\n          value={tabValue}\r\n          onChange={handleChange}\r\n        >\r\n          {weekDayList.map((d, i) => <MenuItem key={i} value={i}>{'周' + d}</MenuItem>)}\r\n        </Select>\r\n      </FormControl>\r\n      <IconButton style={{ float: 'right' }} variant=\"contained\" onClick={() => {\r\n        setShowTable(true);\r\n        setFullShow(true);\r\n      }}><FullscreenIcon /></IconButton>\r\n      { window.innerWidth >= 600 ? table : <Button fullWidth variant=\"contained\" onClick={() => { setShowTable(!showTable); }}>点击{showTable ? \"隐藏\" : \"显示\"}表格</Button>}\r\n      <Dialog fullScreen={fullShow} onClose={() => { setShowTable(false); }} open={showTable}>\r\n        <DialogTitle>\r\n          <Box component=\"span\">周{weekDayList[tabValue]}({new Date().setDay(tabValue).toDateString()})数据</Box>\r\n          {fullShow ? <IconButton edge=\"end\" style={{ float: 'right' }} onClick={() => {\r\n            setFullShow(false);\r\n            setShowTable(false);\r\n          }}><FullscreenExitIcon /></IconButton> : <IconButton style={{ float: 'right' }} variant=\"contained\" onClick={() => {\r\n            setShowTable(true);\r\n            setFullShow(true);\r\n          }}><FullscreenIcon /></IconButton>}</DialogTitle>\r\n        {table}\r\n      </Dialog>\r\n      {/* </Container > */}\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\n","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport ReserveTables from \"../components/ReserveTables\";\r\nimport { Divider, Table, TableBody, TableCell, TableRow, Typography } from \"@material-ui/core\";\r\nimport store from \"../data/store\";\r\n\r\nclass StateNow extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = store.getState();\r\n    this.unsubscribe = store.subscribe(() => {\r\n      this.setState({\r\n        timetableNodes: store.getState().timetableNodes,\r\n        timetablePeriods: store.getState().timetablePeriods,\r\n        roomStockPlans: store.getState().roomStockPlans\r\n      });\r\n    });\r\n  }\r\n  componentWillUnmount() {\r\n    this.unsubscribe();\r\n  }\r\n  render() {\r\n    return (<Table>\r\n      <TableBody>\r\n        <TableRow>\r\n          <TableCell align=\"center\">任务数量</TableCell>\r\n          <TableCell align=\"center\">LABLE1</TableCell>\r\n          <TableCell align=\"center\">LABLE2</TableCell>\r\n        </TableRow>\r\n        <TableRow>\r\n          <TableCell align=\"center\">{store.getState().tasks.length}个</TableCell>\r\n          <TableCell align=\"center\">VALUE1</TableCell>\r\n          <TableCell align=\"center\">VALUE2</TableCell>\r\n        </TableRow>\r\n      </TableBody>\r\n    </Table>);\r\n  }\r\n}\r\n\r\nfunction Launch() {\r\n  return (<Container style={{ overflowX: 'auto', width: '100%' }}>\r\n    <Typography variant=\"h5\">执行状态</Typography>\r\n    <StateNow></StateNow>\r\n    <br />\r\n    <Typography variant=\"h5\">数据总览</Typography>\r\n    <ReserveTables />\r\n  </Container>);\r\n}\r\n\r\nexport default Launch;","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport { Button, MenuItem, FormControl, InputLabel, List, ListItem, ListItemSecondaryAction, ListItemText, Select, ListSubheader, Switch, Dialog, DialogTitle, DialogContent, Typography, DialogActions } from \"@material-ui/core\";\r\nimport store from \"../data/store\";\r\nimport { setConfig, setErrorInfo, setMessage } from \"../data/action\";\r\nimport { funDownload } from \"../utils/utils\";\r\nimport ListInfo from \"../components/ListInfo\";\r\nimport { api } from \"../api/api\";\r\nimport Config from \"../Config\";\r\n\r\nfunction Settings(props) {\r\n  const [themeName, setThemeName] = React.useState(store.getState().config.data.theme_name);\r\n  const refConfigFileInput = React.useRef();\r\n  const [resetSettingsOpen, setResetSettingsOpen] = React.useState(false);\r\n  const [deleteDataOpen, setDeleteDataOpen] = React.useState(false);\r\n  const [openDaemon, setOpenDaemon] = React.useState(false);\r\n  const [openUser, setOpenUser] = React.useState(false);\r\n  const [openResetShop, setOpenResetShop] = React.useState(false);\r\n\r\n  const resetSettings = function () {\r\n    let c = store.getState().config;\r\n    c.data = c.data_default;\r\n    c.save();\r\n    c.load();\r\n    store.dispatch(setConfig(c));\r\n  }\r\n\r\n  const user = store.getState().user;\r\n\r\n  return (<Container maxWidth=\"md\">\r\n    <List>\r\n      <ListSubheader>用户账号</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"用户名\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          {user.username}\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenUser(true); }}>\r\n        <ListItemText primary=\"详细信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button>\r\n        <ListItemText primary=\"修改信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        Config.clear();\r\n        setTimeout(() => { window.location.reload(); }, 500);\r\n      }}>\r\n        <ListItemText primary=\"退出当前账号\"></ListItemText>\r\n      </ListItem>\r\n      <ListSubheader>用户门店</ListSubheader>\r\n      <ListItem button onClick={() => { setOpenDaemon(true); }}>\r\n        <ListItemText primary=\"门店信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenResetShop(true); }}>\r\n        <ListItemText primary=\"解绑当前门店\"></ListItemText>\r\n        <ListItemSecondaryAction><Typography variant=\"body1\" color=\"textSecondary\">{store.getState().daemon &&\r\n          store.getState().daemon.shop_info && store.getState().daemon.shop_info.branchName}</Typography></ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListSubheader>外观</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"主题设置\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <FormControl>\r\n            {/* <InputLabel></InputLabel> */}\r\n            <Select value={themeName} onChange={e => {\r\n              setThemeName(e.target.value);\r\n              let c = store.getState().config;\r\n              c.data.theme_name = e.target.value;\r\n              c.theme = c.theme_avaliable[c.data.theme_name];\r\n              c.save();\r\n              store.dispatch(setConfig(c));\r\n              setTimeout(() => { window.location.reload(); }, 200);\r\n            }}>\r\n              {store.getState().config.data.theme_avaliable.map((v, k) => <MenuItem key={k} value={v}>{v}</MenuItem>)}\r\n            </Select>\r\n          </FormControl>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListSubheader>数据管理</ListSubheader>\r\n      <ListItem button onClick={() => {\r\n        funDownload(store.getState().config.save(), `团购杀手配置数据(${new Date().toLocaleString()}).json`);\r\n      }}>\r\n        <ListItemText primary=\"数据导出\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        // console.log(refConfigFileInput)\r\n        refConfigFileInput.current.click();\r\n      }}>\r\n        <ListItemText primary=\"数据导入\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <input type=\"file\" accept=\".json\" hidden name=\"file-gbk-data\" ref={refConfigFileInput} onChange={e => {\r\n            // console.log(e);\r\n            let files = e.target.files;\r\n            if (files.length === 0) {\r\n              store.dispatch(setMessage(\"未选择文件\"));\r\n              return;\r\n            }\r\n            try {\r\n              let file = files[0];\r\n              let reader = new FileReader();\r\n              reader.readAsText(file, 'UTF-8');\r\n              reader.onload = evt => {\r\n                const fileData = evt.target.result;\r\n                try {\r\n                  const js = JSON.parse(fileData);\r\n                  if (!js.version_frontend) {\r\n                    store.dispatch(setMessage(\"文件类型错误或者文件已经损坏\"));\r\n                    return;\r\n                  }\r\n                  if (js.version_frontend > store.getState().config.data.version_frontend) {\r\n                    store.dispatch(setMessage(`存档文件版本(${js.version_frontend}高于当前版本${store.getState().config.data.version_frontend})，请更新到最新版`));\r\n                    return;\r\n                  }\r\n                  let c = store.getState().config;\r\n                  c.data = js;\r\n                  store.dispatch(setConfig(c));\r\n                  store.dispatch(setMessage(\"数据导入完成\"));\r\n                } catch (e) {\r\n                  store.dispatch(setErrorInfo(e));\r\n                }\r\n              };\r\n            } catch (e) {\r\n              store.dispatch(setErrorInfo(e));\r\n            }\r\n          }}></input>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem>\r\n        <ListItemText primary=\"设置数据同步\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <Switch defaultChecked={store.getState().config.data.settings_async} onChange={e => {\r\n            let c = store.getState().config;\r\n            c.data.settings_async = e.target.checked;\r\n            c.save();\r\n            store.dispatch(setConfig(c));\r\n          }}></Switch>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setResetSettingsOpen(true)}>\r\n        <ListItemText primary=\"回到默认设置\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setDeleteDataOpen(true)}>\r\n        <ListItemText primary=\"删除所有数据\"></ListItemText>\r\n      </ListItem>\r\n    </List>\r\n    <ListInfo data={store.getState().user} open={openUser} keyNames={{\r\n      username: '用户名', nick: '昵称', phone: '用户手机号', profile: '详细信息', state: '用户状态', created_at: '创建于', updated_at: '更新于'\r\n    }} title=\"用户信息\" onClose={() => { setOpenUser(false); }}></ListInfo>\r\n    <ListInfo data={store.getState().daemon} open={openDaemon} keyNames={{\r\n      cookies: '远程登录凭据', shop_info: \"门店详细信息\", solution_id: \"解决方案编号\"\r\n    }} title=\"门店信息\" onClose={() => { setOpenDaemon(false); }}></ListInfo>\r\n    <Dialog open={resetSettingsOpen} onClose={() => setResetSettingsOpen(false)}>\r\n      <DialogTitle>\r\n        回到默认设置\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除所有设置数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setResetSettingsOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={deleteDataOpen} onClose={() => setDeleteDataOpen(false)}>\r\n      <DialogTitle>\r\n        删除所有数据\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除软件数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setDeleteDataOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={openResetShop} onClose={() => { setOpenResetShop(false); }}>\r\n      <DialogTitle>解绑当前门店</DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会解除门店和<b>本网站</b>的数据绑定，需要<b>重新绑定</b>才能使用网站功能。是否继续？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => { setOpenResetShop(false); }}>取消</Button>\r\n        <Button onClick={async () => {\r\n          const resp = await api.request(\"remote_login\", \"DELETE\");\r\n          console.log('delete cookies:', resp);\r\n          if (resp.code !== 200) store.dispatch(setErrorInfo(`删除失败: ${resp.code}, ${resp.message}, ${resp.error}`));\r\n          // setOpenResetShop(false);\r\n          window.location.reload();\r\n        }} color=\"secondary\">确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  </Container>)\r\n}\r\n\r\nexport default Settings;","import store from \"../data/store\";\r\n\r\n\r\nclass WebSocketAPI {\r\n  constructor(url) {\r\n    this.connect = this.connect.bind(this);\r\n    this.url = url || store.getState().config.data.remote_login.server || \"ws://127.0.0.1:8081\";\r\n    this.ws = null;\r\n    this.onopen = () => {\r\n      console.log('Connection started');\r\n    };\r\n    this.ondata = e => {\r\n      if (e.cmd === 'code') {\r\n        this.oncode(e.data);\r\n      } else if (e.cmd === 'cookies') {\r\n        this.oncookies(e.data);\r\n      }\r\n    };\r\n    this.onmessage = e => {\r\n      // console.log('onmessage', e);\r\n      this.ondata(JSON.parse(e.data));\r\n    };\r\n    this.onerror = e => {\r\n      console.error(e);\r\n    };\r\n    this.onclose = () => {\r\n      console.log('Connection closed');\r\n    };\r\n    this.oncode = code => { console.log('code', code); }\r\n    this.oncookies = cookies => { console.log('cookies', cookies); }\r\n  }\r\n  connect() {\r\n    this.ws = this.ws || new WebSocket(this.url);\r\n    this.ws.onopen = this.onopen;\r\n    this.ws.onclose = this.onclose;\r\n    this.ws.onerror = this.onerror;\r\n    this.ws.onmessage = this.onmessage;\r\n  }\r\n  close() {\r\n    if (this.ws) this.ws.close();\r\n  }\r\n}\r\n\r\nexport { WebSocketAPI };","import { Box, Button, Container, Paper, Typography } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport Config from \"../Config\";\r\nimport { WebSocketAPI } from '../api/remote_login';\r\nimport { setConfig, setDaemon } from '../data/action';\r\nimport store from '../data/store';\r\nconst QRCode = require('qrcode.react');\r\n\r\nfunction CenterBox(props) {\r\n  const { children, style } = props;\r\n  return <Box style={style ? style : { width: '100%', height: '100%', display: \"flex\", justifyContent: \"center\", flexDirection: \"column\" }}>\r\n    <Box style={{ width: '100%', textAlign: \"center\", display: \"flex\", justifyContent: \"center\", flexDirection: \"column\", alignItems: \"center\" }}>\r\n      {children}\r\n    </Box>\r\n  </Box>;\r\n}\r\n\r\nexport default class RemoteLogin extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      code: null,\r\n      loginDone: false,\r\n      loginError: null,\r\n    };\r\n    this.ws_api = null;\r\n    // this.unsubscribe = store.subscribe(async () => {\r\n    //   if (this.loginDone) return;\r\n    //   let state = store.getState();\r\n    //   if (state.daemon) {\r\n    //     this.setState({ loginDone: true });\r\n    //     if (this.ws_api) this.ws_api.close();\r\n    //   }\r\n    // });\r\n    setTimeout(async () => {\r\n      console.log(store.getState().daemon);\r\n      if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n      const res = await api.request('remote_login', \"PATCH\");\r\n      if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n      const server = res.data.server;\r\n      let config = store.getState().config;\r\n      config.data.remote_login.server = server;\r\n      store.dispatch(setConfig(config));\r\n      if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n      this.ws_api = new WebSocketAPI(server);\r\n      this.ws_api.oncode = code => {\r\n        // console.log('code', code);\r\n        if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n        this.setState({ code });\r\n      };\r\n      this.ws_api.oncookies = async cookies => {\r\n        const resp = await api.request('remote_login', \"POST\", { cookies });\r\n        if (resp.code !== 200) {\r\n          this.setState({ loginDone: true, loginError: resp.message });\r\n          return;\r\n        }\r\n        console.log('done', resp);\r\n        if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n        this.setState({ loginDone: true });\r\n        const daemon = await api.request('remote_login', 'GET');\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        }\r\n      }\r\n      if ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone) return;\r\n      this.ws_api.connect();\r\n    }, 1000);\r\n  }\r\n  componentWillUnmount() {\r\n    if (this.ws_api) this.ws_api.close();\r\n    // this.unsubscribe();\r\n  }\r\n  render() {\r\n    let content = null;\r\n    if (this.state.loginDone) {\r\n      if (!this.state.loginError)\r\n        content = <Paper style={{ width: 200, height: 200 }}>\r\n          <CenterBox>登录完成</CenterBox>\r\n        </Paper>;\r\n      else content = <Paper style={{ width: 200, height: 200 }}>\r\n        <CenterBox>\r\n          <Typography variant=\"body1\">{this.state.loginError}</Typography>\r\n          <Button variant=\"outlined\" color=\"secondary\">重试</Button>\r\n        </CenterBox>\r\n      </Paper>;\r\n    } else {\r\n      content = this.state.code ? <QRCode value={JSON.stringify(this.state.code)} size={200} /> :\r\n        <Paper style={{ width: 200, height: 200 }}>\r\n          <CenterBox>正在加载二维码...</CenterBox>\r\n        </Paper>;\r\n      // <span style={{ width: 200, height: 200 }}><CenterBox>正在加载二维码...</CenterBox></span>\r\n    }\r\n    return (<Container maxWidth=\"xs\" style={{ height: window.innerHeight * 0.6 }}>\r\n      <CenterBox>\r\n        <Typography variant=\"h5\">扫码登录以继续</Typography>\r\n        <br></br>\r\n        {content}\r\n        <br></br>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">请使用美团开店宝/点评管家扫码登录</Typography>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">点击软件右下角\"我的\"→右上角扫码图标</Typography>\r\n        <br></br>\r\n        <Button fullWidth onClick={() => {\r\n          Config.clear();\r\n          setTimeout(() => { window.location.reload(); }, 500);\r\n        }}>退出当前账号</Button>\r\n      </CenterBox>\r\n    </Container>);\r\n  }\r\n}","import { Box, Button, Container, Divider, TextField, Typography, Zoom, Fade } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport { setMessage, setUser } from '../data/action';\r\nimport store from '../data/store';\r\nimport { objectUpdate } from '../utils/utils';\r\n\r\n\r\nfunction LoginFrame(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    username: \"\",\r\n    password: \"\",\r\n    captcha: \"\",\r\n    actionType: 'login'\r\n  });\r\n  const refUsername = React.useRef();\r\n  const refPassword = React.useRef();\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  // style={{ display: \"flex\", justifyContent: 'center', alignItems: \"center\", flexDirection: \"column\", }}\r\n  const actionLogin = state.actionType === 'login' ? true : false;\r\n  const handleAction = async () => {\r\n    // console.log('handle', actionLogin);\r\n    if (actionLogin) {\r\n      const res = await api.request('session', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code !== 200) return;\r\n      // 获取user\r\n      const user = await api.request('user', 'GET');\r\n      if (user.code !== 200) return;\r\n      console.log('user', user.data.user);\r\n      store.dispatch(setUser(user.data.user));\r\n    } else {\r\n      // 注册，注册成功则跳转登录\r\n      const res = await api.request('user', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code === 200) {\r\n        // 弹窗\r\n        store.dispatch(setMessage(\"注册成功\"));\r\n        setState({actionType: 'login'});\r\n      }\r\n    }\r\n  }\r\n\r\n  return (<Box>\r\n    <Typography variant=\"h4\">{actionLogin ? \"登录\" : \"注册\"}</Typography>\r\n    <br />\r\n    <Divider></Divider>\r\n    <br />\r\n    <TextField fullWidth ref={refUsername} label=\"用户名\" variant=\"outlined\" value={state.username} onChange={e => {\r\n      setState({ username: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        refPassword.current.querySelector(\"input\").focus();\r\n      }\r\n    }} />\r\n    <br /><br />\r\n    <TextField fullWidth ref={refPassword} label=\"密码\" variant=\"outlined\" value={state.password} type=\"password\" onChange={e => {\r\n      setState({ password: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        handleAction();\r\n      }\r\n    }} />\r\n    <Fade in={actionLogin} style={{ display: actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>登录</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={() => setState({ actionType: \"sign_in\" })}>注册</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n    <Fade in={!actionLogin} style={{ display: !actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>注册</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" onClick={() => setState({ actionType: 'login' })}>返回登录</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n  </Box >);\r\n}\r\n\r\nexport default function Login(props) {\r\n  return <Container maxWidth=\"sm\">\r\n    <LoginFrame></LoginFrame>\r\n  </Container>\r\n}","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport { Button, MenuItem, FormControl, InputLabel, List, ListItem, ListItemSecondaryAction, ListItemText, Select, ListSubheader, Switch, Dialog, DialogTitle, DialogContent, Typography, DialogActions, FormControlLabel, Checkbox, Divider, Box, Grid, TextField, IconButton } from \"@material-ui/core\";\r\nimport { Table, TableBody, TableCell, TableRow } from \"@material-ui/core\";\r\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline';\r\nimport store from \"../data/store\";\r\nimport { setConfig, setErrorInfo, setMessage } from \"../data/action\";\r\nimport { api } from \"../api/api\";\r\n\r\nfunction Predicts(props) {\r\n  const [useSpan, setUseSpan] = React.useState(false);\r\n  const [openHelp, setOpenHelp] = React.useState(false);\r\n  const labels = ['小包最低价', '小包最高价', '中包最低价', '中包最高价', '大包最低价', '大包最高价'];\r\n  const labelShows = { '小包最低价': '小包(闲时)', '小包最高价': '小包(黄金时段)', '中包最低价': '中包(闲时)', '中包最高价': '中包(黄金时段)', '大包最低价': '大包(闲时)', '大包最高价': '大包(黄金时段)' };\r\n  const [predictsResult, setPredictsResult] = React.useState(null);\r\n  const defaultValues = [\r\n    ['66', '76'], ['76', '86'], ['86', '96'], ['96', '106'], ['116', '126'], ['126', '146']\r\n  ]\r\n  const labelsTemp = labels.map((v, k) => {\r\n    return { [v]: defaultValues[k] };\r\n  });\r\n  const labelValues = ((() => {\r\n    let temp = {};\r\n    for (const item of labelsTemp)\r\n      for (const k in item)\r\n        temp[k] = item[k];\r\n    return temp;\r\n  })());\r\n  // console.log(labelValues);\r\n  const [inputValues, setInputValues] = React.useState(labelValues);\r\n  const getTempValues = () => {\r\n    let tempValues = {};\r\n    for (const k in inputValues) tempValues[k] = inputValues[k];\r\n    return tempValues;\r\n  }\r\n\r\n  const items = labels.map((v, k) => {\r\n    return useSpan ?\r\n      <ListItem key={k}>\r\n        <ListItemText primary={labelShows[v]}></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <Box>\r\n            <TextField style={{ maxWidth: 40 }} inputProps={{ style: { textAlign: \"center\" } }} value={inputValues[v][0]} onChange={e => {\r\n              let tmp = getTempValues();\r\n              tmp[v][0] = e.target.value;\r\n              setInputValues(tmp);\r\n            }}></TextField>~\r\n            <TextField style={{ maxWidth: 40 }} inputProps={{ style: { textAlign: \"center\" } }} value={inputValues[v][1]} onChange={e => {\r\n              let tmp = getTempValues();\r\n              tmp[v][1] = e.target.value;\r\n              setInputValues(tmp);\r\n            }}></TextField>\r\n          </Box>\r\n        </ListItemSecondaryAction>\r\n      </ListItem> :\r\n      <ListItem key={k}>\r\n        <ListItemText primary={labelShows[v]}></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <TextField style={{ maxWidth: 90 }} inputProps={{ style: { textAlign: \"center\" } }} fullWidth value={inputValues[v][0]} onChange={e => {\r\n            let tmp = getTempValues();\r\n            tmp[v][0] = e.target.value;\r\n            setInputValues(tmp);\r\n          }}></TextField>\r\n        </ListItemSecondaryAction>\r\n      </ListItem >;\r\n  });\r\n  const content = <List>\r\n    {items}\r\n  </List>;\r\n  const handlePredicts = () => {\r\n    // 检查数据\r\n    let tempValues = getTempValues();\r\n    if (!useSpan)\r\n      for (const k in tempValues)\r\n        tempValues[k] = [tempValues[k][0],]\r\n    for (const k in tempValues) {\r\n      for (let i = 0; i < tempValues[k].length; i++) {\r\n        let val = null;\r\n        try {\r\n          val = parseFloat(tempValues[k][i]);\r\n        } catch (e) {\r\n          store.dispatch(setErrorInfo(`数值错误: ${tempValues[k][i]}, ${e}`));\r\n          return;\r\n        }\r\n        if (!val && val !== 0) {\r\n          store.dispatch(setErrorInfo(`数值错误: ${tempValues[k][i]}`));\r\n          return;\r\n        }\r\n        tempValues[k][i] = val;\r\n      }\r\n    }\r\n    console.log(JSON.stringify(tempValues));\r\n    // api.predicts(tempValues).then(d => {\r\n    //   console.log(d);\r\n    //   setPredictsResult(d.data);\r\n    // });\r\n    api.request(\"predicts\", 'POST', { predict_data: tempValues }).then(d => {\r\n      console.log(d);\r\n      setPredictsResult(d.data);\r\n    });\r\n  };\r\n  const result = !predictsResult ? null : <Table>\r\n    <TableBody>\r\n      {useSpan ? <TableRow>\r\n        <TableCell align=\"center\" colSpan={2}>预测曝光人数</TableCell>\r\n        <TableCell align=\"center\" colSpan={2}>预测访问人数</TableCell>\r\n        <TableCell align=\"center\" colSpan={2}>预测下单人数</TableCell>\r\n      </TableRow> : <TableRow>\r\n        <TableCell align=\"center\">预测曝光人数</TableCell>\r\n        <TableCell align=\"center\">预测访问人数</TableCell>\r\n        <TableCell align=\"center\">预测下单人数</TableCell>\r\n      </TableRow>}\r\n      {useSpan ? <TableRow>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][1])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][1])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][1])}</TableCell>\r\n      </TableRow> : <TableRow>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][0])}</TableCell>\r\n      </TableRow>}\r\n    </TableBody>\r\n  </Table>;\r\n  return (<Container maxWidth=\"sm\">\r\n    <Typography variant=\"h4\">根据标准数据集预测</Typography>\r\n    <Box>\r\n      <FormControlLabel control={<Checkbox onChange={e => {\r\n        setUseSpan(e.target.checked);\r\n        setPredictsResult(null);\r\n      }} checked={useSpan} color=\"secondary\" />} label=\"使用数据区间\" />\r\n      <IconButton onClick={() => setOpenHelp(true)}>\r\n        <HelpOutlineIcon></HelpOutlineIcon>\r\n      </IconButton>\r\n    </Box>\r\n    <Divider></Divider>\r\n    {content}\r\n    <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={handlePredicts}>预测</Button>\r\n    <Divider></Divider>\r\n    {result}\r\n    <Dialog open={openHelp} onClose={() => { setOpenHelp(false); }}>\r\n      <DialogTitle>帮助信息</DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"h6\">使用数据区间</Typography>\r\n        <Typography variant=\"body1\">使用数据区间可以输入数据上下限，并且预测出对应参数的上下限，帮助您更好地界定您的数据。</Typography>\r\n        <Typography variant=\"h6\">价格说明</Typography>\r\n        <Typography variant=\"body1\">“黄金时段”价格为节假日、夜间等适合高定价的时段，“闲时”为除此之外的时段。输入价格为不加入酒水等的基础价格。</Typography>\r\n        <Typography variant=\"h6\">预测结果说明</Typography>\r\n        <Typography variant=\"body1\">预测结果基于当前已有数据集数据，预测准确性不能百分百保证。更新数据集等功能将在后续版本上线。</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button color=\"primary\" onClick={() => { setOpenHelp(false); }}>了解</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  </Container>)\r\n}\r\n\r\nexport default Predicts;","import { Box, Button, Container, Divider, TextField, Typography, Zoom, Fade, Avatar, List } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport { setMessage, setUser } from '../data/action';\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport store from '../data/store';\r\nimport {\r\n  HashRouter as Router,\r\n  // BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from \"react-router-dom\";\r\nimport { isChinese, objectUpdate } from '../utils/utils';\r\nimport ListItemLink from '../components/ListItemLink';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  small: {\r\n    width: theme.spacing(3),\r\n    height: theme.spacing(3),\r\n  },\r\n  large: {\r\n    width: theme.spacing(7),\r\n    height: theme.spacing(7),\r\n  },\r\n}));\r\n\r\nexport default function User(props) {\r\n  const { onClose } = props;\r\n  const classes = useStyles();\r\n  const user = store.getState().user;\r\n  const nick = user.nick ? user.nick : user.username;\r\n  const nickHead = isChinese(nick[0]) ? null : `${nick}`.slice(0, 2);\r\n  return <Container maxWidth=\"sm\">\r\n    <Box style={{ display: 'flex', flexDirection: \"row\", minWidth: 90 }}>\r\n      <Box style={{ margin: 15 }}>\r\n        <Avatar alt={nick} className={classes.large}>{nickHead ? nickHead : nick[0]}</Avatar>\r\n      </Box>\r\n      <Box style={{ margin: 8 }}>\r\n        <Typography variant=\"h4\">{nick}</Typography>\r\n        {user.username ? <Typography variant=\"body1\">@{user.username}</Typography> : null}\r\n      </Box>\r\n      <Box style={{ margin: 10 }}>\r\n        <Typography variant=\"h5\">{`${store.getState().daemon.shop_info.shopName}`}</Typography>\r\n        <Typography variant=\"body1\" color=\"textSecondary\">{`${store.getState().daemon.shop_info.branchName}`}</Typography>\r\n      </Box>\r\n    </Box>\r\n    {/* <Button fullWidth color=\"primary\">跳转到设置</Button> */}\r\n    <Router>\r\n      <List>\r\n        <ListItemLink to=\"/settings\" primary=\"跳转到设置\" onClick={() => { onClose && onClose(); }} />\r\n      </List>\r\n    </Router>\r\n  </Container>;\r\n}","import React from 'react';\r\nimport \"@fontsource/roboto\";\r\nimport clsx from 'clsx';\r\nimport Container from '@material-ui/core/Container';\r\nimport { makeStyles, useTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport List from '@material-ui/core/List';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\r\nimport EqualizerIcon from '@material-ui/icons/Equalizer';\r\nimport DashboardIcon from '@material-ui/icons/Dashboard';\r\nimport AssignmentIcon from '@material-ui/icons/Assignment';\r\nimport AlarmIcon from '@material-ui/icons/Alarm';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport StorageIcon from '@material-ui/icons/Storage';\r\nimport VerifiedUserIcon from '@material-ui/icons/VerifiedUser';\r\nimport PhonelinkIcon from '@material-ui/icons/Phonelink';\r\nimport {\r\n  HashRouter as Router,\r\n  // BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from \"react-router-dom\";\r\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\r\nimport { Provider } from 'react-redux'\r\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\r\nimport MomentUtils from '@date-io/moment';\r\nimport moment from 'moment';\r\nimport 'moment/locale/zh-cn';\r\nimport store from './data/store';\r\nimport { setConfig, setDaemon, setErrorInfo, setMessage, setReserveTableData, setRoomStockData, setShopInfo } from \"./data/action\";\r\n\r\nimport { isIterator, isMobileDevice, sleep } from \"./utils/utils\";\r\nimport { api } from \"./api/api\";\r\n\r\nimport ListItemLink from \"./components/ListItemLink\";\r\nimport Launch from \"./pages/Launch\";\r\nimport Settings from \"./pages/Settings\";\r\nimport './App.css';\r\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogTitle, ListItem, Snackbar } from '@material-ui/core';\r\nimport RemoteLogin from './pages/RemoteLogin';\r\nimport Login from './pages/Login';\r\nimport Tasks from \"./pages/Tasks\";\r\nimport Predicts from './pages/Predicts';\r\nimport User from './pages/User';\r\n\r\nconst drawerWidth = 240;\r\nmoment.locale('zh-cn');\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    // overflowX: 'auto',\r\n  },\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n  title: {\r\n    flexGrow: 1\r\n  },\r\n  appBarShift: {\r\n    marginLeft: drawerWidth,\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  menuButton: {\r\n    marginRight: 36,\r\n  },\r\n  hide: {\r\n    display: 'none',\r\n  },\r\n  drawer: {\r\n    width: drawerWidth,\r\n    flexShrink: 0,\r\n    whiteSpace: 'nowrap',\r\n  },\r\n  drawerOpen: {\r\n    width: drawerWidth,\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  drawerClose: {\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    overflowX: 'hidden',\r\n    width: theme.spacing(7) + 1,\r\n    [theme.breakpoints.up('sm')]: {\r\n      width: theme.spacing(9),\r\n    },\r\n  },\r\n  toolbar: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'flex-end',\r\n    padding: theme.spacing(0, 1),\r\n    // necessary for content to be below app bar\r\n    ...theme.mixins.toolbar,\r\n  },\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    width: '100%',\r\n    overflowX: 'auto',\r\n  },\r\n}));\r\n\r\n// const api = new API();\r\n// const authApi = new AuthAPI();\r\n// api.get_shop_info().then(shopInfo => {\r\n//   console.log('shopInfo', shopInfo);\r\n//   if (shopInfo) store.dispatch(setShopInfo(shopInfo));\r\n// }).catch(e => {\r\n//   store.dispatch(setErrorInfo(e));\r\n// })\r\n\r\nlet subscribers = {};\r\n\r\nlet last_data = {\r\n  config: null,\r\n  user: null,\r\n  daemon: null\r\n};\r\n\r\nstore.subscribe(async () => {\r\n  let state = store.getState();\r\n  // console.log('redux update to', state);\r\n  // 保存 config\r\n  if (state.config.data) {\r\n    if (JSON.stringify(state.config.data) !== JSON.stringify(last_data.config)) {\r\n      // console.log('Config will change:', state.config.data);\r\n      state.config.save();\r\n      if (store.getState().user && store.getState().config.data.settings_async) {\r\n        await api.request('sync', 'POST', { config: state.config.data });\r\n      }\r\n    } else {\r\n      // console.log('Not change:', state.config.data);\r\n    }\r\n    last_data.config = state.config.data;\r\n  }\r\n  for (let subFunc in subscribers) {\r\n    subscribers[subFunc](state);\r\n  }\r\n});\r\n\r\nconst getShopTitle = function () {\r\n  if (!(store.getState().daemon && store.getState().daemon.shop_info && store.getState().daemon.shop_info.shopName)) return null;\r\n  // console.log('getShopTitle', store.getState().daemon.shop_info);\r\n  const title = `${store.getState().daemon.shop_info.shopName} - ${store.getState().daemon.shop_info.branchName}`;\r\n  // console.log(title);\r\n  return title;\r\n}\r\n\r\nexport default function App() {\r\n  const classes = useStyles();\r\n  const theme = useTheme();\r\n  const [open, setOpen] = React.useState(false);\r\n  const [errorDialogInfo, setErrorDialogInfo] = React.useState(false);\r\n  const [myMessage, setMyMessage] = React.useState(null);\r\n  const [hasLogin, setHasLogin] = React.useState(false);\r\n  const titleDefault = \"团购杀手 - KTV体验版\";\r\n  const [title, setTitle] = React.useState(getShopTitle() || titleDefault);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const [requestingRemote, setRequesingRemote] = React.useState(false);\r\n  const [openUser, setOpenUser] = React.useState(false);\r\n\r\n  // 拉大到800会打开，拉小到600关闭\r\n  const triggerWidthOpen = 800;\r\n  const triggerWidthClose = 600;\r\n\r\n  // 注册一个当遇到错误的时候调用的钩子吧，用来显示错误信息\r\n  subscribers['Error'] = function (state) {\r\n    if (state.errorInfo) {\r\n      console.log('Error Hook: ', state.errorInfo);\r\n      setErrorDialogInfo(state.errorInfo);\r\n      // 清空错误信息\r\n      store.dispatch(setErrorInfo(null));\r\n    }\r\n  };\r\n  // 注册一个消息钩子\r\n  subscribers['Message'] = function (state) {\r\n    if (state.message) {\r\n      console.log('message: ', state.message);\r\n      setMyMessage(state.message);\r\n      store.dispatch(setMessage(null));\r\n    }\r\n  };\r\n  subscribers['User'] = async function (state) {\r\n    if (state.user) {\r\n      if (JSON.stringify(state.user) != JSON.stringify(last_data.user)) {\r\n        forceUpdate();\r\n        // 登录信息完成，触发获取daemon\r\n        // if (!last_data.user) \r\n        if (!last_data.user) {\r\n          // store.dispatch(setDaemon(false));\r\n          // console.log('trigger');\r\n        }\r\n      }\r\n      last_data.user = state.user;\r\n    }\r\n  };\r\n  subscribers['Daemon'] = async function (state) {\r\n    if (state.daemon) {\r\n      if (JSON.stringify(state.daemon) != JSON.stringify(last_data.daemon)) {\r\n        forceUpdate();\r\n      }\r\n      last_data.daemon = state.daemon;\r\n      if (state.daemon.shop_info) {\r\n        if (title === titleDefault) {\r\n          setTitle(getShopTitle());\r\n        }\r\n      }\r\n    }\r\n    // if (state.daemon === false) {\r\n    //   store.dispatch(setDaemon(null));\r\n    //   const daemon = await api.request('daemon', 'GET');\r\n    //   if (daemon.code === 200 && daemon.data.uid) {\r\n    //     store.dispatch(setDaemon(daemon.data));\r\n    //   } else store.dispatch(setDaemon(null));\r\n    // }\r\n  };\r\n  // onMount & onUpdate\r\n  React.useEffect(() => {\r\n    const onWindowResize = () => {\r\n      let width = window.innerWidth;\r\n      // console.log(width);\r\n      if (!open && width >= triggerWidthOpen) setOpen(true);\r\n      if (open && width <= triggerWidthClose) setOpen(false);\r\n    };\r\n    window.addEventListener(\"load\", onWindowResize);\r\n    window.addEventListener('resize', onWindowResize);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"load\", onWindowResize);\r\n      window.removeEventListener(\"resize\", onWindowResize);\r\n    };\r\n  });\r\n\r\n\r\n  const handleClickAction = () => {\r\n    if (window.innerWidth < 600 || window.location.pathname === '/') {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const mainContent = <Router>\r\n    <MuiPickersUtilsProvider utils={MomentUtils} locale=\"zh-cn\">\r\n      <CssBaseline />\r\n      <AppBar\r\n        position=\"fixed\"\r\n        className={clsx(classes.appBar, {\r\n          [classes.appBarShift]: open,\r\n        })}\r\n      >\r\n        <Toolbar>\r\n          <IconButton\r\n            color=\"inherit\"\r\n            aria-label=\"open drawer\"\r\n            onClick={() => { setOpen(true); }}\r\n            edge=\"start\"\r\n            className={clsx(classes.menuButton, {\r\n              [classes.hide]: open,\r\n            })}\r\n          >\r\n            <MenuIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h6\" noWrap className={classes.title}>\r\n            {title}\r\n          </Typography>\r\n          <IconButton\r\n            color=\"inherit\"\r\n            onClick={() => { setOpenUser(true); }}\r\n          >\r\n            <AccountCircleIcon />\r\n          </IconButton>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer\r\n        variant=\"permanent\"\r\n        className={clsx(classes.drawer, {\r\n          [classes.drawerOpen]: open,\r\n          [classes.drawerClose]: !open,\r\n        })}\r\n        classes={{\r\n          paper: clsx({\r\n            [classes.drawerOpen]: open,\r\n            [classes.drawerClose]: !open,\r\n          }),\r\n        }}\r\n      >\r\n        <div className={classes.toolbar}>\r\n          <IconButton onClick={() => { setOpen(false); }}>\r\n            {theme.direction === 'rtl' ? <ChevronRightIcon /> : <ChevronLeftIcon />}\r\n          </IconButton>\r\n        </div>\r\n        <Divider />\r\n        <List onClick={handleClickAction}>\r\n          <ListItemLink to=\"/\" primary=\"启动页\" icon={<DashboardIcon />} />\r\n          <ListItemLink to=\"/tasks\" primary=\"任务\" icon={<AssignmentIcon />} />\r\n          <ListItemLink to=\"/predicts\" primary=\"智能预测\" icon={<EqualizerIcon />} />\r\n          <ListItemLink to=\"/settings\" primary=\"设置\" icon={<SettingsIcon />} />\r\n        </List>\r\n      </Drawer>\r\n      <main className={classes.content}>\r\n        <div className={classes.toolbar} />\r\n        <Switch>\r\n          <Route path={\"/\"} exact={true}>\r\n            <Launch />\r\n          </Route>\r\n          <Route path={\"/tasks\"} exact={true}>\r\n            <Tasks />\r\n          </Route>\r\n          <Route path={\"/predicts\"} exact={true}>\r\n            <Predicts />\r\n          </Route>\r\n          <Route path={\"/settings\"} exact={false}>\r\n            <Settings />\r\n          </Route>\r\n        </Switch>\r\n      </main>\r\n    </MuiPickersUtilsProvider>\r\n  </Router>;\r\n\r\n  const user = store.getState().user;\r\n  const isNowLogining = !user && store.getState().config.data.api_token.access_token;\r\n  let content = isNowLogining ? <Box>正在登录...</Box> : (user ? mainContent : <Login></Login>);\r\n  if ((!isNowLogining && user) && !store.getState().daemon) {\r\n    content = <Typography variant=\"body1\">获取账户信息...</Typography>;\r\n    if (!requestingRemote) {\r\n      setRequesingRemote(true);\r\n      const daemon = api.request('remote_login', 'GET').then(daemon => {\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        } else if (daemon.code === 200 && !daemon.data.uid) {\r\n          store.dispatch(setDaemon({}));\r\n        }\r\n      });\r\n    }\r\n  } else if ((!isNowLogining && user) && store.getState().daemon && !store.getState().daemon.uid) {\r\n    content = <RemoteLogin></RemoteLogin>\r\n  }\r\n  // console.log('app.js user', user, 'content', content);\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <ThemeProvider theme={store.getState().config.theme}>\r\n        {content}\r\n        <Dialog fullWidth open={openUser} onClose={() => { setOpenUser(false); }}>\r\n          <DialogContent>\r\n            <User onClose={() => { setOpenUser(false); }}></User>\r\n          </DialogContent>\r\n        </Dialog>\r\n        <Dialog open={errorDialogInfo ? true : false} onClose={() => { setErrorDialogInfo(null); }}>\r\n          <DialogTitle>遇到错误</DialogTitle>\r\n          <DialogContent>\r\n            <Typography variant=\"body1\">错误信息</Typography>\r\n            <Box component=\"div\">\r\n              <Box component=\"div\">\r\n                {() => {\r\n                  if (isIterator(errorDialogInfo) && typeof (errorDialogInfo) !== 'string') {\r\n                    return <List>\r\n                      {errorDialogInfo.map((d, i) => <ListItem key={i}>\r\n                        <code>{JSON.stringify(d) === '{}' ? d.toString() : JSON.stringify(d)}</code>\r\n                      </ListItem>)}\r\n                    </List>;\r\n                  } else {\r\n                    return <code>{JSON.stringify(errorDialogInfo) === '{}' ? errorDialogInfo.toString() : JSON.stringify(errorDialogInfo)}</code>;\r\n                  }\r\n                }}\r\n              </Box>\r\n            </Box>\r\n          </DialogContent>\r\n          <DialogActions>\r\n            <Button color=\"primary\" onClick={() => { window.location.reload() }}>刷新</Button>\r\n            <Button color=\"primary\" onClick={() => { setErrorDialogInfo(null); }}>取消</Button>\r\n          </DialogActions>\r\n        </Dialog>\r\n        <Snackbar\r\n          anchorOrigin={{\r\n            vertical: 'bottom',\r\n            horizontal: 'right',\r\n          }}\r\n          open={myMessage !== null}\r\n          autoHideDuration={6000}\r\n          // onClose={(e) => { console.log(e); }}\r\n          message={myMessage}\r\n          action={\r\n            <React.Fragment>\r\n              <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={() => setMyMessage(null)}>\r\n                <CloseIcon fontSize=\"small\" />\r\n              </IconButton>\r\n            </React.Fragment>\r\n          }\r\n        />\r\n      </ThemeProvider>\r\n    </div >\r\n  );\r\n}\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport store from './data/store';\r\nimport { Provider } from 'react-redux';\r\nimport { api } from './api/api';\r\nimport { setConfig, setDaemon, setErrorInfo, setRoomStockPlans, setTimetableNodes, setTimetablePeriods, setUser } from './data/action';\r\nimport { sleep } from './utils/utils';\r\n\r\n// 循环执行函数\r\nasync function cycleFunc(cycle = 1000) {\r\n  while (true) {\r\n    try {\r\n\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    await sleep(cycle);\r\n  }\r\n}\r\n\r\n// 开始执行的函数\r\nasync function startFunc() {\r\n  setTimeout(async () => {\r\n    const user = store.getState().user;\r\n    const isNowLogining = !user && store.getState().config.data.api_token.access_token;\r\n    if (isNowLogining) {\r\n      api.load_from_config();\r\n      const res = await api.request('user', 'GET');\r\n      // console.log('index res', res)\r\n      if (res.code === 200) {\r\n        // console.log('saving user', res.data.user)\r\n        store.dispatch(setUser(res.data.user));\r\n        const daemon = await api.request('daemon', 'GET');\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        } else store.dispatch(setDaemon(null));\r\n      }\r\n    }\r\n    // let c = api.download_config();\r\n    // if (!c.settings_async) return;\r\n    // const config_frontend = await api.download_config();\r\n    // if (!config_frontend) {\r\n    //   store.dispatch(setErrorInfo(\"同步设置失败\"));\r\n    // }\r\n    // else store.dispatch(setConfig(config_frontend));\r\n  }, 0);\r\n}\r\n\r\nReactDOM.render(\r\n  // <React.StrictMode>\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  // </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nstartFunc().then(() => {\r\n  cycleFunc();\r\n});\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}