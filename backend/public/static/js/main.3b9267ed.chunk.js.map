{"version":3,"sources":["utils/utils.js","data/action.js","api/api.js","Config.js","data/reducers.js","data/store.js","components/ListItemLink.js","components/ListEdit.js","components/ListInfo.js","components/Actions.js","components/Triggers.js","components/TaskDialog.js","pages/Tasks.js","components/ReserveTable.js","components/ReserveTables.js","pages/Launch.js","api/remote_login.js","pages/RemoteLogin.js","pages/Settings.js","pages/Login.js","pages/Predicts.js","pages/User.js","ErrorBondary.js","App.js","reportWebVitals.js","index.js"],"names":["sleep","time_ms","Promise","accept","setTimeout","isIterator","obj","Symbol","iterator","deepCopy","data","undefined","d","i","length","push","k","objectUpdate","origin","update","now","isObjectValueEqual","a","b","aProps","Object","getOwnPropertyNames","bProps","propName","propA","propB","hasOwnProperty","Date","prototype","setDay","day","day_","this","getDay","setTime","getTime","toDateString","toISOString","slice","timedeltaUnits","getTimedeltaString","timedelta","unit","keys","getTimedeltaUnit","toFixed","weekDayList","getNewNumberString","value","newValue","parseFloat","isNaN","formatDateTime","moment","format","setConfig","dispatch","type","setTasks","setUser","setDaemon","setErrorInfo","setMessage","updateTypes","typeData","store","getState","types","api","host","window","location","href","includes","port","api_version","api_prefix","protocol","url","access_token","refresh_token","router","key","method","request","config","api_token","get_token","console","log","set_token","refresh","access","headers","payload","mode","body","JSON","stringify","get_headers","Boolean","resp","fetch","error","status","code","statusText","js","json","message","resp2","js2","update_config","res","user","ITEM_NAME","Config","load","bind","save","theme_avaliable","createMuiTheme","palette","primary","main","blueGrey","secondary","grey","data_default","debug","version_frontend","theme_name","settings_async","remote_login","server","theme","parse","localStorage","getItem","Error","e","warn","s","setItem","defaultState","tasks","daemon","errorInfo","combineReducers","state","action","createStore","reducers","applyMiddleware","thunk","updated","ListItemLink","props","icon","to","onClick","renderLink","React","useMemo","forwardRef","itemProps","ref","document","title","ListItem","button","component","ListItemIcon","ListItemText","ActionData","onChange","onDelete","Box","Button","color","style","display","flexDirection","DateTimePicker","IconButton","ListEdit","defaultValue","open","onClose","keyNames","dataType","typeName","dismiss","onSave","useState","setInnerData","setData","openChild","setOpenChild","child","setChild","childTitle","setChildTitle","timedeltaUnit","setTimedeltaUnit","Dialog","fullWidth","DialogTitle","DialogContent","List","width","map","v","indexOf","args","editable","showName","actionData","startsWith","val","updateFixed","TextField","target","onBlur","Select","MenuItem","ListItemSecondaryAction","DialogActions","height","justifyContent","Typography","variant","ListInfo","isActionModified","item","updateActionData","callback","then","actions","wrapAction","actionType","action_type","newActionData","getDataString","calendar","ActionTag","selectMode","targets","dialogOpen","setDialogOpen","roomItem","tmp","item_id","itemId","target_price","price","actionTemp","toUse","setToUse","handleCloseDialog","handleClick","newAction","selected","Card","minWidth","margin","CardContent","name","desc","newData","CardActions","Actions","requesting","setRequesting","useReducer","x","forceUpdate","content","flexWrap","updateTriggerData","triggers","isTriggerModified","getTriggerType","trigger","interval","run_date","wrapTrigger","triggerType","triggerData","newTriggerData","TriggerTag","newTrigger","Triggers","trigger_type","taskDialogUpdate","useStyles","makeStyles","nested","paddingLeft","spacing","centerText","alignItems","whiteSpace","setTaskDialogUpdate","roomItemUpdated","TaskDialog","classes","addMode","onRefresh","simpleMode","taskOld","baseTaskName","taskName","realDefaultTask","task_name","defaultTask","defaultCollapseOpen","timenode","cycle","dialogAddTaskOpen","dialogAddTriggerOpen","dialogAddActionOpen","dialogUpdateTrigger","task","requestingTaskData","defaultTid","useSimpleMode","collapseOpen","simpleData","timenodeTime","timenodePrice","cycleTime","cyclePrice","setInnerState","setState","setCollapseToggle","taskData","task_data","tid","handleAddTask","resolve","reject","dialogContent","newTask","flexFlow","Checkbox","checked","className","Collapse","in","timeout","unmountOnExit","maxWidth","inputProps","textAlign","ListSubheader","splice","Grid","container","xs","lg","disabled","col","defaultData","date","adjust_price","wrapTask","taskWrapped","TaskTag","onUpdate","taskOrigin","request_key","getTargetTasks","result","getTargetTasksMarks","TaskList","marks","Tasks","requestingTasks","Container","sm","tids","assign","table","foodDesc","overflow","contentOverflow","planButton","MyTableCell","styles","padding","noBorder","borderBottom","TableCell","align","colSpan","children","requestedDayData","setUpdateTimer","ReserveTable","requestingDaemon","setRequestingDaemon","requestingUpdate","setRequestingUpdate","dayData","setDayData","reserve_table","roomList","setRoomList","setDialogAddTaskOpen","dialogTasksListOpen","setDialogTasksListOpen","roomItemNow","setRoomItemNow","setRequestingTasks","LinearProgress","daemon_args","update_all","PeriodTable","periodIds","periodMap","periodList","period","periodId","id","periodDesc","room","roomName","roomMapItemName","roomMapItemEntry","rows","maxRows","index","notEmpty","getCenterTable","maxIndex","parseInt","position","top","periodData","row","stock","planCount","Link","parent","roomItemTmp","TableRow","updateData","reserveTableData","updateTaskData","tableHeaderCells","tableHeader","TableHead","roomCapacity","TableContainer","Paper","Table","stickyHeader","TableBody","roomType","isOk","TabPanel","other","role","hidden","aria-labelledby","root","overflowX","flexGrow","background","paper","formControl","selectEmpty","marginTop","ReserveTables","tabValue","setTableValue","showTable","setShowTable","fullShow","setFullShow","Tabs","indicatorColor","textColor","scrollButtons","aria-label","Tab","label","FormControl","InputLabel","event","float","innerWidth","fullScreen","edge","StateNow","unsubscribe","subscribe","timetableNodes","timetablePeriods","roomStockPlans","Component","Launch","WebSocketAPI","connect","ws","onopen","ondata","cmd","oncode","oncookies","onmessage","onerror","onclose","cookies","WebSocket","close","QRCode","require","CenterBox","RemoteLogin","onFinish","forceLogin","stateDefault","loginDone","loginError","ws_api","ws_running","run_ws","uid","clearTimeout","size","innerHeight","clear","reload","Settings","themeName","setThemeName","refConfigFileInput","useRef","resetSettingsOpen","setResetSettingsOpen","deleteDataOpen","setDeleteDataOpen","openDaemon","setOpenDaemon","openUser","setOpenUser","openResetShop","setOpenResetShop","openSelectShop","setOpenSelectShop","openNewShop","setOpenNewShop","resetSettings","c","username","shop_info","branchName","filename","eleLink","createElement","download","blob","Blob","URL","createObjectURL","appendChild","click","removeChild","funDownload","toLocaleString","current","files","file","reader","FileReader","readAsText","onload","evt","fileData","Switch","defaultChecked","nick","phone","profile","created_at","updated_at","solution_id","shops","shopName","shopId","shop_id","LoginFrame","password","captcha","refUsername","refPassword","actionLogin","handleAction","Divider","onKeyDown","querySelector","focus","Fade","exit","enter","Login","Predicts","useSpan","setUseSpan","openHelp","setOpenHelp","labels","labelShows","predictsResult","setPredictsResult","defaultValues","labelsTemp","labelValues","temp","inputValues","setInputValues","getTempValues","tempValues","items","FormControlLabel","control","predict_data","small","large","User","nickHead","test","Avatar","alt","ErrorBoundary","requested","info","drawerWidth","locale","appBar","zIndex","drawer","transition","transitions","create","easing","sharp","duration","leavingScreen","appBarShift","marginLeft","enteringScreen","menuButton","marginRight","hide","flexShrink","drawerOpen","drawerClose","breakpoints","up","toolbar","mixins","subscribers","last_data","subFunc","getShopTitle","App","useTheme","setOpen","errorDialogInfo","setErrorDialogInfo","myMessage","setMyMessage","titleDefault","setTitle","requestingRemote","setRequesingRemote","useEffect","onWindowResize","addEventListener","removeEventListener","mainContent","utils","MomentUtils","CssBaseline","AppBar","clsx","Toolbar","noWrap","Drawer","direction","pathname","path","exact","isNowLogining","ThemeProvider","toString","Snackbar","anchorOrigin","vertical","horizontal","autoHideDuration","Fragment","fontSize","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","load_from_config","ReactDOM","render","getElementById","startFunc","cycleFunc"],"mappings":"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","file":"static/js/main.3b9267ed.chunk.js","sourcesContent":["import moment from 'moment';\r\nimport 'moment/locale/zh-cn'\r\n\r\nexport function isMobileDevice() {\r\n  const sUserAgent = navigator.userAgent;\r\n  return (sUserAgent.indexOf('Android') > -1 || sUserAgent.indexOf('iPhone') > -1 || sUserAgent.indexOf('iPad') > -1 || sUserAgent.indexOf('iPod') > -1 || sUserAgent.indexOf('Symbian') > -1);\r\n}\r\n\r\n/** \r\n* param 将要转为URL参数字符串的对象 \r\n* key URL参数字符串的前缀 \r\n* encode true/false 是否进行URL编码,默认为true \r\n*  \r\n* return URL参数字符串 \r\n*/\r\nexport function urlEncode(param, key, encode) {\r\n  if (param == null) return '';\r\n  var paramStr = '';\r\n  var t = typeof (param);\r\n  if (t === 'string' || t === 'number' || t === 'boolean') {\r\n    paramStr += '&' + key + '=' + ((encode == null || encode) ? encodeURIComponent(param) : param);\r\n  } else {\r\n    for (var i in param) {\r\n      var k = key == null ? i : key + (param instanceof Array ? '[' + i + ']' : '.' + i);\r\n      paramStr += urlEncode(param[i], k, encode);\r\n    }\r\n  }\r\n  return paramStr;\r\n};\r\n\r\nexport function urlEncode2(obj) {\r\n  try {\r\n    return JSON.stringify(obj).replace(/:/g, \"=\").replace(/\"/g, '').replace(/,/g, '&').match(/\\{([^)]*)\\}/)[1];\r\n  } catch (e) {\r\n    console.error(e);\r\n    return \"\";\r\n  }\r\n}\r\n\r\nexport function parseTimePoint(time) {\r\n  return moment(time).format('LLLL');\r\n}\r\n\r\nexport function parseTimePeriod(time) {\r\n  return moment.duration(time).humanize();\r\n}\r\n\r\nexport function getTextFieldValue(el) {\r\n  return el.current.childNodes[el.current.childElementCount - 1].childNodes[0].value;\r\n}\r\n\r\nexport function sleep(time_ms) {\r\n  return new Promise(accept => {\r\n    setTimeout(accept, time_ms);\r\n  });\r\n}\r\n\r\n// 设置到本周的星期几\r\nDate.prototype.setDay = function (day) {\r\n  let day_ = this.getDay();\r\n  if (day_ === day) return this;\r\n  this.setTime(this.getTime() + 1000 * 60 * 60 * 24 * (day - day_));\r\n  return this;\r\n};\r\n\r\n// 获取 YYYY-MM-DD 格式\r\nDate.prototype.toDateString = function () {\r\n  return this.toISOString().slice(0, 10);\r\n};\r\n\r\n// export function cutString(str, length=10)\r\n\r\nexport function isIterator(obj) {\r\n  return obj != null && typeof obj[Symbol.iterator] === 'function';\r\n}\r\n\r\n// 下载文件方法\r\nexport function funDownload(content, filename) {\r\n  var eleLink = document.createElement('a');\r\n  eleLink.download = filename;\r\n  eleLink.style.display = 'none';\r\n  // 字符内容转变成blob地址\r\n  var blob = new Blob([content]);\r\n  eleLink.href = URL.createObjectURL(blob);\r\n  // 触发点击\r\n  document.body.appendChild(eleLink);\r\n  eleLink.click();\r\n  // 然后移除\r\n  document.body.removeChild(eleLink);\r\n};\r\n\r\n\r\nexport function deepCopy(data) {\r\n  if (data === null || data === undefined) {\r\n    return data;\r\n  } if (isIterator(data) && typeof (data) !== \"string\") {\r\n    let d = [];\r\n    for (let i = 0; i < data.length; i++) {\r\n      d.push(data[i]);\r\n    }\r\n    return d;\r\n  } else if (typeof (data) === \"object\") {\r\n    let d = {};\r\n    for (const k in data) {\r\n      d[k] = deepCopy(data[k]);\r\n    }\r\n    return d;\r\n  } else {\r\n    return data;\r\n  }\r\n}\r\n\r\nexport function objectUpdate(origin, update) {\r\n  let now = deepCopy(origin);\r\n  for (const k in update) {\r\n    now[k] = update[k];\r\n  }\r\n  return now;\r\n}\r\n\r\n// https://www.jianshu.com/p/7407bd65b15d\r\nexport function isObjectValueEqual(a, b) {\r\n  var aProps = Object.getOwnPropertyNames(a);\r\n  var bProps = Object.getOwnPropertyNames(b);\r\n  if (aProps.length !== bProps.length) {\r\n    return false;\r\n  }\r\n  for (var i = 0; i < aProps.length; i++) {\r\n    var propName = aProps[i]\r\n\r\n    var propA = a[propName]\r\n    var propB = b[propName]\r\n    // 2020-11-18更新，这里忽略了值为undefined的情况\r\n    // 故先判断两边都有相同键名\r\n    if (!b.hasOwnProperty(propName)) return false\r\n    if ((propA instanceof Object)) {\r\n      if (isObjectValueEqual(propA, propB)) {\r\n        // return true     这里不能return ,后面的对象还没判断\r\n      } else {\r\n        return false\r\n      }\r\n    } else if (propA !== propB) {\r\n      return false\r\n    } else { }\r\n  }\r\n  return true\r\n}\r\n\r\n// Array.prototype.indexOf = function (val) {\r\n//   for (var i = 0; i < this.length; i++) {\r\n//     if (this[i] == val) return i;\r\n//   }\r\n//   return -1;\r\n// };\r\n\r\n// Array.prototype.remove = function (val) {\r\n//   var index = this.indexOf(val);\r\n//   if (index > -1) {\r\n//     this.splice(index, 1);\r\n//   }\r\n// };\r\n\r\n// Array.prototype.removeIndex = function (index) {\r\n//   this.splice(index, 1);\r\n// };\r\n\r\n// export function arrayRemove(array, data) {\r\n//   if (!isIterator(array)) return;\r\n//   const index = array.indexOf(data);\r\n//   if (index > -1) {\r\n//     array.slice(index, 1);\r\n//   }\r\n// }\r\n\r\nexport const timedeltaUnits = {\r\n  \"秒\": 1, \"分\": 60, \"时\": 60 * 60,\r\n  \"天\": 24 * 60 * 60, \"周\": 7 * 24 * 60 * 60\r\n};\r\n\r\n\r\nexport function getTimedeltaUnit(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return null;\r\n  if (timedelta >= timedeltaUnits[Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]])\r\n    return Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n  for (let i = 1; i < Object.keys(timedeltaUnits).length; i++) {\r\n    if (timedelta < timedeltaUnits[Object.keys(timedeltaUnits)[i]]) {\r\n      return Object.keys(timedeltaUnits)[i - 1];\r\n    }\r\n  }\r\n  return Object.keys(timedeltaUnits)[0];\r\n}\r\n\r\nexport function getTimedeltaString(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return \"\";\r\n  const unit = getTimedeltaUnit(timedelta);\r\n  if (unit === null) return \"\";\r\n  // console.log(\"unit\", unit);\r\n  return `${(timedelta / timedeltaUnits[unit]).toFixed(2)}${unit}`;\r\n}\r\n\r\nexport const weekDayList = ['日', '一', '二', '三', '四', '五', '六'];\r\n\r\nexport function isChinese(temp) {\r\n  var re = /[^\\u4E00-\\u9FA5]/;\r\n  if (re.test(temp)) return false;\r\n  return true;\r\n}\r\n\r\n\r\nexport function getNewNumberString(value) {\r\n  const newValue = value.length === 0 ? 0 : parseFloat(value);\r\n  if (isNaN(newValue)) return null;\r\n  return newValue;\r\n}\r\n\r\nexport function formatDateTime(value) {\r\n  return moment(value).format(\"YYYY-MM-DDTHH:mm:ss.SSSSSS+08:00\");\r\n}","import { objectUpdate } from \"../utils/utils\";\r\nimport store from \"./store\";\r\n\r\nexport function setConfig(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_CONFIG\", data: data });\r\n  };\r\n}\r\n\r\nexport function setTasks(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_TASKS\", data: data });\r\n  };\r\n}\r\n\r\nexport function setUser(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_USER\", data: data });\r\n  };\r\n}\r\n\r\nexport function setDaemon(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_DAEMON\", data: data });\r\n  };\r\n}\r\n\r\nexport function setErrorInfo(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_ERROR_INFO\", data: data });\r\n  };\r\n}\r\n\r\nexport function setMessage(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_MESSAGE\", data: data });\r\n  };\r\n}\r\n\r\nexport function setTypes(data) {\r\n  return dispatch => {\r\n    dispatch({ type: \"SET_TYPES\", data: data });\r\n  };\r\n}\r\n\r\n\r\nexport function updateTypes(type, typeData) {\r\n  return setTypes(objectUpdate(store.getState().types, { [type]: typeData }));\r\n}\r\n","import { setConfig, setErrorInfo, setUser } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { isIterator, urlEncode } from \"../utils/utils\"\r\n\r\n\r\nclass API {\r\n  constructor() {\r\n    // this.host = '127.0.0.1';\r\n    this.host = window.location.href.includes(\"localhost\") ? \"localhost\" : null;\r\n    // this.port = 8080;\r\n    this.port = 8880;\r\n    this.api_version = \"v2\";\r\n    this.api_prefix = `/api/${this.api_version}`;\r\n    this.protocol = 'http'\r\n    this.url = this.host ? `${this.protocol}://${this.host}:${this.port}${this.api_prefix}` : `${this.api_prefix}`;\r\n    this.access_token = '';\r\n    this.refresh_token = '';\r\n  }\r\n  set_token(access_token, refresh_token) {\r\n    // this.access_token = access_token || this.access_token;\r\n    // this.refresh_token = refresh_token || this.refresh_token;\r\n    if (access_token !== undefined)\r\n      this.access_token = access_token;\r\n    if (refresh_token !== undefined)\r\n      this.refresh_token = refresh_token;\r\n  }\r\n  get_token() {\r\n    return {\r\n      access_token: this.access_token === '' ? undefined : this.access_token, refresh_token: this.refresh_token === '' ? undefined : this.refresh_token\r\n    }\r\n  }\r\n  request_key(router, key, method = \"GET\", data) {\r\n    return this.request(`${router}/${key}`, method, data);\r\n  }\r\n  update_config() {\r\n    let config = store.getState().config;\r\n    config.data.api_token = this.get_token();\r\n    console.log('config.data.api_token', config.data.api_token)\r\n    // config.save();\r\n    store.dispatch(setConfig(config));\r\n  }\r\n  load_from_config() {\r\n    const config = store.getState().config;\r\n    this.set_token(config.data.api_token.access_token, config.data.api_token.refresh_token);\r\n  }\r\n  get_headers(refresh = false, access = true) {\r\n    let headers = {\r\n      'Content-Type': 'application/json',\r\n    };\r\n    if (refresh) {\r\n      headers['Refresh'] = this.refresh_token;\r\n    }\r\n    if (access) {\r\n      if (this.access_token !== '') headers['Authorization'] = this.access_token;\r\n    }\r\n    return headers;\r\n  }\r\n  async request(router, method = \"GET\", data) {\r\n    const payload = {\r\n      method: method,\r\n      mode: 'cors',\r\n      body: data ? JSON.stringify(data) : undefined,\r\n      // 注销的时候自带 refresh_token\r\n      headers: this.get_headers(Boolean(router === 'session' && method === 'DELETE')),\r\n    };\r\n    // console.log('request', router, method, data, payload);\r\n    // console.log(`${this.url}/${router}`);\r\n    let resp = null;\r\n    try {\r\n      resp = await fetch(`${this.url}/${router}`, payload);\r\n    } catch (e) {\r\n      console.error(e);\r\n      store.dispatch(setErrorInfo(e));\r\n      resp = { status: 433, error: \"Error when fetching internet\" };\r\n      return { code: resp.status, error: resp.statusText };\r\n    }\r\n    let js = null;\r\n    try { js = await resp.json(); } catch (e) {\r\n      console.error(e);\r\n      store.dispatch(setErrorInfo(e));\r\n      return { code: resp.status, error: resp.statusText };\r\n    }\r\n    console.log('raw js:', js);\r\n    if (!js) {\r\n      // console.log(await resp.json());\r\n      js = {};\r\n      js.message = resp.statusText;\r\n    }\r\n    if (js.code === undefined) js.code = resp.status;\r\n    if (js.code === 422) {\r\n      if (this.refresh_token === '') {\r\n        // 过期勒\r\n        return null;\r\n      }\r\n      // ac_token到期，准备更新\r\n      // console.log(this.get_headers(true));\r\n      const resp2 = await fetch(`${this.url}/session`, {\r\n        method: 'GET',\r\n        mode: 'cors',\r\n        headers: this.get_headers(true),\r\n        // body: JSON.stringify({ refresh_token: this.refresh_token })\r\n      });\r\n      try {\r\n        const js2 = await resp2.json();\r\n        // console.log('updating ac_token', js2);\r\n        if (js2.code === 200) {\r\n          this.set_token(js2.data.access_token, js2.data.refresh_token);\r\n          this.update_config();\r\n          // 更新user\r\n          const res = this.request('user', 'GET');\r\n          if (res.code === 200) {\r\n            store.dispatch(setUser(res.data.user));\r\n          }\r\n        }\r\n        else {\r\n          // 判定为 update_token 也过期，要求重新登录\r\n          store.dispatch(setErrorInfo(\"登录过期，请重新登录\"));\r\n          return null;\r\n        }\r\n      } catch (e) {\r\n        // console.error(e);\r\n        return { code: resp2.status, error: resp2.statusText };\r\n      }\r\n      return this.request(router, method, data);\r\n    }\r\n    if (js.code === 200) {\r\n      // 登录自动储存 JWT 数据\r\n      if (router === 'session' && method === 'POST') {\r\n        const { access_token, refresh_token } = js.data;\r\n        // console.log('jwt', access_token, refresh_token);\r\n        this.set_token(access_token, refresh_token);\r\n        this.update_config();\r\n      } else if (router === 'session' && method === 'DELETE') {\r\n        // 注销\r\n        // console.warn('注销');\r\n        this.set_token('', '');\r\n        this.update_config();\r\n      }\r\n    } else {\r\n      store.dispatch(setErrorInfo(js));\r\n    }\r\n    return js;\r\n  }\r\n}\r\n\r\nconst api = new API();\r\n\r\nexport { API, api };","import { createMuiTheme, makeStyles, ThemeProvider } from '@material-ui/core/styles';\r\nimport { orange, grey, blueGrey } from '@material-ui/core/colors';\r\nimport { api } from \"./api/api\";\r\n\r\nconst ITEM_NAME = \"group_bying_config\";\r\n\r\nclass Config {\r\n  constructor() {\r\n    this.load = this.load.bind(this);\r\n    this.save = this.save.bind(this);\r\n    this.theme_avaliable = {\r\n      \"默认主题\": createMuiTheme({}),\r\n      '黑暗模式': createMuiTheme({\r\n        palette: {\r\n          type: \"dark\",\r\n          primary: {\r\n            main: blueGrey[500],\r\n          },\r\n          secondary: {\r\n            main: grey[500],\r\n          },\r\n        },\r\n      }),\r\n    }\r\n    // 在构造函数执行的时候加载保存的数据\r\n    this.data_default = {\r\n      debug: false,\r\n      version_frontend: 0.1,\r\n      // 显示主题\r\n      // theme_name: \"黑暗模式\",\r\n      theme_name: \"默认主题\",\r\n      theme_avaliable: [\r\n        '默认主题',\r\n        '黑暗模式'\r\n      ],\r\n      // 设置同步\r\n      settings_async: true,\r\n      // 远程登录服务器\r\n      remote_login: {\r\n        server: \"ws://127.0.0.1:8081\"\r\n      },\r\n      api_token: {}\r\n    };\r\n    this.data = this.data_default;\r\n    this.theme = this.theme_avaliable[\"默认主题\"];\r\n    this.load();\r\n  }\r\n\r\n  load() {\r\n    console.log(\"Config: loading config...\");\r\n    if (this.data.debug) {\r\n      console.log(\"Config: load default config.\");\r\n      this.save();\r\n    }\r\n    try {\r\n      this.data = JSON.parse(localStorage.getItem(ITEM_NAME));\r\n      if (!this.data) throw new Error(\"Null data\");\r\n      console.log(\"Got data:\", this.data);\r\n      if (!this.data.version_frontend || this.data.version_frontend < this.data_default.version_frontend) {\r\n        // 版本升级，增量更新\r\n        console.log(`Config: update ${this.data.version_frontend} -> ${this.data_default.version_frontend}`);\r\n        this.data.version_frontend = this.data_default.version_frontend;\r\n        for (let k in this.data_default) {\r\n          if (!this.data[k]) {\r\n            console.log(`    Config: add value ${k}`);\r\n            this.data[k] = this.data_default[k];\r\n          }\r\n        }\r\n        this.save();\r\n      }\r\n    } catch (e) {\r\n      console.warn(`Can not find ${ITEM_NAME} in localStorage, use default config.`);\r\n      this.data = this.data_default;\r\n      this.save();\r\n    }\r\n    this.theme = this.theme_avaliable[this.data.theme_name];\r\n    if (!this.theme) this.theme = this.theme_avaliable[\"default\"];\r\n    api.set_token(this.data.api_token.access_token, this.data.api_token.refresh_token);\r\n  }\r\n\r\n  save() {\r\n    console.log(\"Config: saving config...\");\r\n    this.data.api_token = api.get_token();\r\n    const s = JSON.stringify(this.data);\r\n    localStorage.setItem(ITEM_NAME, s);\r\n    return s;\r\n  }\r\n\r\n  static clear() {\r\n    console.log(\"Config: clearing all data...\");\r\n    localStorage.setItem(ITEM_NAME, undefined);\r\n  }\r\n};\r\n\r\nexport default Config;","import { combineReducers } from 'redux'\r\nimport Config from \"../Config\"\r\n\r\nconst defaultState = {\r\n  config: new Config(),\r\n  tasks: [],\r\n  user: null,\r\n  daemon: null,\r\n  errorInfo: null,\r\n  message: null,\r\n  types: {},\r\n}\r\n\r\nfunction types(state = defaultState.types, action) {\r\n  switch (action.type) {\r\n    case \"SET_TYPES\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction config(state = defaultState.config, action) {\r\n  switch (action.type) {\r\n    case \"SET_CONFIG\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction user(state = defaultState.user, action) {\r\n  switch (action.type) {\r\n    case \"SET_USER\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction tasks(state = defaultState.tasks, action) {\r\n  switch (action.type) {\r\n    case \"SET_TASKS\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction daemon(state = defaultState.daemon, action) {\r\n  switch (action.type) {\r\n    case \"SET_DAEMON\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction errorInfo(state = defaultState.errorInfo, action) {\r\n  switch (action.type) {\r\n    case \"SET_ERROR_INFO\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction message(state = defaultState.message, action) {\r\n  switch (action.type) {\r\n    case \"SET_MESSAGE\":\r\n      return action.data;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default combineReducers({ config, errorInfo, message, daemon, user, tasks, types });\r\n","// applyMiddleware: redux通过该函数来使用中间件\r\n// createStore: 用于创建store实例\r\nimport { applyMiddleware, createStore } from 'redux'\r\n\r\n// 中间件，作用：如果不使用该中间件，当我们dispatch一个action时，需要给dispatch函数传入action        \r\n// 对象；但如果我们使用了这个中间件，那么就可以传入一个函数，这个函数接收两个参数:dispatch和    \r\n// getState。这个dispatch可以在将来的异步请求完成后使用，对于异步action很有用\r\nimport thunk from 'redux-thunk'\r\n\r\n// 引入reducer\r\nimport reducers from './reducers.js'\r\n\r\n// 创建store实例\r\nlet store = createStore(\r\n    reducers,\r\n    applyMiddleware(thunk)\r\n)\r\nexport default store","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { ListItem, ListItemText, ListItemIcon } from '@material-ui/core';\r\nimport { Link as RouterLink } from \"react-router-dom\";\r\n\r\nlet updated = false;\r\n\r\nfunction ListItemLink(props) {\r\n  const { icon, primary, to, onClick } = props;\r\n\r\n  const renderLink = React.useMemo(\r\n    () => React.forwardRef((itemProps, ref) => <RouterLink to={to} ref={ref} {...itemProps} />),\r\n    [to],\r\n  );\r\n\r\n  if (!updated) {\r\n    updated = true;\r\n    document.title = `${primary} - 团购杀手`;\r\n  }\r\n\r\n  return (\r\n    <li>\r\n      <ListItem button component={renderLink} onClick={() => {\r\n        document.title = `${primary} - 团购杀手`;\r\n        onClick && onClick();\r\n      }}>\r\n        {icon ? <ListItemIcon>{icon}</ListItemIcon> : null}\r\n        <ListItemText primary={primary} />\r\n      </ListItem>\r\n    </li>\r\n  );\r\n}\r\n\r\nListItemLink.propTypes = {\r\n  icon: PropTypes.element,\r\n  primary: PropTypes.string.isRequired,\r\n  to: PropTypes.string.isRequired,\r\n};\r\n\r\nexport default ListItemLink;\r\n\r\n","import { Select, Box, Button, Container, Dialog, DialogActions, DialogContent, DialogTitle, List, ListItem, ListItemSecondaryAction, ListItemText, TextField, Typography, MenuItem, IconButton } from \"@material-ui/core\";\r\nimport { DateTimePicker } from \"@material-ui/pickers\";\r\nimport React from \"react\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport store from \"../data/store\";\r\nimport { formatDateTime, getNewNumberString, isIterator, objectUpdate, timedeltaUnits } from \"../utils/utils\";\r\nimport moment from \"moment\";\r\n\r\nexport function ActionData(props) {\r\n  const { value, onChange, onDelete } = props;\r\n  return <Box>\r\n    {value === null || value === undefined || value === 'datetime|' ?\r\n      <Button color=\"secondary\" onClick={() => { onChange && onChange(null); }}>点击设置</Button> :\r\n      <Box style={{ display: \"flex\", flexDirection: \"row\" }}>\r\n        <DateTimePicker\r\n          value={value.slice(\"datetime|\".length)}\r\n          onChange={onChange}\r\n        ></DateTimePicker>\r\n        <IconButton onClick={onDelete}>\r\n          <DeleteIcon></DeleteIcon>\r\n        </IconButton>\r\n      </Box>}\r\n  </Box>;\r\n}\r\n\r\nexport default function ListEdit(props) {\r\n  const { defaultValue, open, onClose, title, keyNames, dataType, typeName } = props;\r\n  const dismiss = props.dismiss && isIterator(props.dismiss) ? props.dismiss : [];\r\n  const onSave = props.onSave ? props.onSave : null;\r\n  const [data, setInnerData] = React.useState(defaultValue);\r\n  const setData = (update) => setInnerData(objectUpdate(data, update));\r\n  const [openChild, setOpenChild] = React.useState(false);\r\n  const [child, setChild] = React.useState(null);\r\n  const [childTitle, setChildTitle] = React.useState(null);\r\n  const [timedeltaUnit, setTimedeltaUnit] = React.useState({});\r\n\r\n  const handleSave = () => {\r\n    onSave && onSave(data);\r\n  }\r\n\r\n  return <Dialog fullWidth open={open} onClose={onClose}>\r\n    <DialogTitle>{title}</DialogTitle>\r\n    <DialogContent>\r\n      <List style={{ width: \"100%\" }}>\r\n        {Object.keys(data).map((v, k) => {\r\n          if (dismiss.indexOf(v) >= 0) return null;\r\n          // console.log(\"store.getState().types\", store.getState().types);\r\n          // console.log(\"typeName\", typeName, \"dataType\", dataType);\r\n          const args = dataType && typeName && store.getState().types[typeName][dataType].args[v] ?\r\n            store.getState().types[typeName][dataType].args[v] : null;\r\n          // console.log('v', v, 'args', args);\r\n          if (dataType && typeName && args && !args.editable) return null;\r\n          const showName = keyNames ? (keyNames[v] || v) : (v);\r\n          // if (((typeof (data[v]) !== \"string\")) && !data[v]) return undefined;\r\n          let value = data[v];\r\n          if ((!value && typeof (value) !== \"number\") && dataType && typeName && args) {\r\n            value = `${args.type}|${args.value ? args.value : ''}`;\r\n          }\r\n          if (typeof (value) === 'object') {\r\n            return <ListItem key={v} button onClick={() => {\r\n              setChild(value);\r\n              setChildTitle(showName);\r\n              setOpenChild(true);\r\n            }}>{showName}</ListItem>\r\n          } else {\r\n            let actionData = null;\r\n            if (typeof (value) === \"string\" && value.startsWith(\"timezone|\")) {\r\n              // 时区暂时不可编辑\r\n              actionData = value.slice(\"timezone|\".length);\r\n            } else if (typeof (value) === \"string\" && value.startsWith(\"datetime|\")) {\r\n              // console.log('datetime:', value);\r\n              if (value === 'datetime|') {\r\n                actionData = <Button onClick={() => {\r\n                  setData({ [v]: `datetime|${new Date().toISOString()}` });\r\n                }}>点击设置</Button>;\r\n              } else {\r\n                actionData = <ActionData value={value} onChange={e => {\r\n                  console.log(\"e\", e);\r\n                  // 这里会改变到没有时区的类型\r\n                  console.log(`datetime|${formatDateTime(e)}`);\r\n                  setData({ [v]: `datetime|${formatDateTime(e)}` });\r\n                }} onDelete={() => {\r\n                  setData({ [v]: null });\r\n                }}></ActionData>\r\n              }\r\n            } else if (typeof (value) === \"string\" && value.startsWith(\"timedelta|\")) {\r\n              const val = value.slice(\"timedelta|\".length);\r\n              const unit = timedeltaUnit[v] ? timedeltaUnit[v] : Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n              const updateFixed = () => {\r\n                // const unit2 = timedeltaUnit[v] ? timedeltaUnit[v] : Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1];\r\n                // const newValue2 = `timedelta|${parseFloat(('' + (parseFloat(data[v].slice(\"timedelta|\".length)) / timedeltaUnits[unit2]).toFixed(2) * timedeltaUnits[unit2]))}`\r\n                // console.log(\"newValue2\", newValue2);\r\n                // setData({ [v]: newValue2 });\r\n              };\r\n              actionData = <Box>\r\n                <TextField value={`${parseFloat(val) / timedeltaUnits[unit]}`} onChange={e => {\r\n                  let val = e.target.value;\r\n                  if (isNaN(parseFloat(val)))\r\n                    if (val.length > 0) return;\r\n                    else val = 0;\r\n                  const newValue = `timedelta|${parseFloat(val) * timedeltaUnits[unit]}`;\r\n                  setData({ [v]: newValue });\r\n                }} onBlur={updateFixed}></TextField>\r\n                <Select value={unit}\r\n                  onChange={e => {\r\n                    setTimedeltaUnit(objectUpdate(timedeltaUnit, { [v]: e.target.value }));\r\n                  }} onBlur={updateFixed}>\r\n                  {Object.keys(timedeltaUnits).map((key, k) => <MenuItem key={key} value={key}>\r\n                    {key}\r\n                  </MenuItem>)}\r\n                </Select>\r\n              </Box>\r\n            } else {\r\n              actionData = <TextField value={`${value}`} onChange={e => {\r\n                const newValue = typeof (value) === \"number\" ? getNewNumberString(e.target.value) : `${value}`;\r\n                if (newValue === null) return;\r\n                setData({ [v]: newValue });\r\n              }}></TextField>;\r\n            }\r\n            return <ListItem key={v}>\r\n              <ListItemText>{showName}</ListItemText>\r\n              <ListItemSecondaryAction>\r\n                {actionData}\r\n              </ListItemSecondaryAction>\r\n            </ListItem>;\r\n          }\r\n        }\r\n        )}\r\n      </List>\r\n      {(child && childTitle) ? <ListEdit defaultValue={child} open={openChild} onClose={() => { setOpenChild(false); }} title={childTitle}></ListEdit> : undefined}\r\n    </DialogContent>\r\n    {onSave ? <DialogActions>\r\n      <Button color=\"primary\" onClick={handleSave}>保存</Button>\r\n      <Button onClick={onClose}>取消</Button>\r\n    </DialogActions> : <DialogActions><Box style={{ width: \"100%\", height: \"100%\", display: \"flex\", justifyContent: \"center\" }}><Typography style={{ height: \"100%\" }} variant=\"body1\" color=\"secondary\">无法保存</Typography></Box></DialogActions>}\r\n  </Dialog>\r\n}","import { Container, Dialog, DialogContent, DialogTitle, List, ListItem, ListItemSecondaryAction, ListItemText, Typography } from \"@material-ui/core\";\r\nimport React from \"react\";\r\n\r\nexport default function ListInfo(props) {\r\n  const { data, open, onClose, title, keyNames } = props;\r\n  const [openChild, setOpenChild] = React.useState(false);\r\n  const [child, setChild] = React.useState(null);\r\n  const [childTitle, setChildTitle] = React.useState(null);\r\n  // console.log(data);\r\n  // Object.keys(data).map((v, k) => { console.log(`v: ${v}, k: ${k}`) })\r\n\r\n  return <Dialog fullWidth open={open} onClose={onClose}>\r\n    <DialogTitle>{title}</DialogTitle>\r\n    <DialogContent>\r\n      <List style={{ width: \"100%\" }}>\r\n        {Object.keys(data).map((v, k) => {\r\n          const showName = keyNames ? (keyNames[v] || v) : (v);\r\n          if (!data[v]) return undefined;\r\n          if (typeof (data[v]) === 'object') {\r\n            return <ListItem key={v} button onClick={() => {\r\n              setChild(data[v]);\r\n              setChildTitle(showName);\r\n              setOpenChild(true);\r\n            }}>{showName}</ListItem>\r\n          } else {\r\n            const s = `${data[v]}`;\r\n            return <ListItem key={v}>\r\n              <ListItemText>{showName}</ListItemText>\r\n              <ListItemSecondaryAction>\r\n                <Typography variant=\"body1\">{s.slice(0, 20) + (s.length > 20 ? \"...\" : \"\")}</Typography>\r\n              </ListItemSecondaryAction>\r\n            </ListItem>\r\n          }\r\n        }\r\n        )}\r\n      </List>\r\n      {(child && childTitle) ? <ListInfo data={child} open={openChild} onClose={() => { setOpenChild(false); }} title={childTitle}></ListInfo> : undefined}\r\n    </DialogContent>\r\n  </Dialog>\r\n}","import { Box, Grid, List, ListItem, Typography, Paper, Card, CardContent, CardActions, Button } from \"@material-ui/core\";\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport { setTypes, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { deepCopy, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\nimport ListEdit from \"./ListEdit\";\r\nimport ListInfo from \"./ListInfo\";\r\n\r\nconst keyNames = {\r\n  \"item_id\": \"目标项目ID\",\r\n  \"target_price\": \"目标价格\"\r\n};\r\n\r\nexport function isActionModified(item, type = \"actions\") {\r\n  try {\r\n    return !isObjectValueEqual(item.data, store.getState().types[type][item.type].data);\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function updateActionData(callback) {\r\n  return api.request(\"action\", 'GET').then(resp => {\r\n    // console.log(\"resp\", resp);\r\n    store.dispatch(updateTypes(\"actions\", resp.data.actions));\r\n    callback && callback(resp.data.actions);\r\n  });\r\n}\r\n\r\nexport async function wrapAction(action) {\r\n  const actionType = action.action_type;\r\n  let actionData = null;\r\n  if (!store.getState().types.actions || !store.getState().types.actions[actionType]) {\r\n    await updateActionData((newActionData) => { actionData = newActionData[actionType]; });\r\n  } else actionData = store.getState().types.actions[actionType];\r\n  if (!actionData) return null;\r\n  return objectUpdate(actionData, { data: action });\r\n}\r\n\r\n\r\nfunction getTimedeltaString(timedelta) {\r\n  if (typeof (timedelta) !== 'number') return \"\";\r\n  const timedeltaUnits = {\r\n    \"秒\": 1, \"分\": 60, \"时\": 60 * 60,\r\n    \"天\": 24 * 60 * 60, \"周\": 7 * 24 * 60 * 60\r\n  };\r\n  for (let i = 1; i < Object.keys(timedeltaUnits).length; i++) {\r\n    if (timedelta < timedeltaUnits[Object.keys(timedeltaUnits)[i]]) {\r\n      return `${(timedelta / timedeltaUnits[Object.keys(timedeltaUnits)[i - 1]]).toFixed(2)}${Object.keys(timedeltaUnits)[i - 1]}`;\r\n    }\r\n  }\r\n  return `${(timedelta / timedeltaUnits[Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]]).toFixed(2)}${Object.keys(timedeltaUnits)[Object.keys(timedeltaUnits).length - 1]}`;\r\n}\r\n\r\nfunction getDataString(data, typeName, dataType) {\r\n  let res = \"\";\r\n  if (typeof (data) !== 'object') return;\r\n  for (const key in data) {\r\n    const showName = keyNames ? (keyNames[key] || key) : (key);\r\n    const args = dataType && typeName && store.getState().types[typeName][dataType].args[key] ?\r\n      store.getState().types[typeName][dataType].args[key] : null;\r\n    if (args && !args.editable) continue;\r\n    let value = data[key];\r\n    if (!value && typeof (value) !== 'number') continue;\r\n    if (typeof (value) === 'string') {\r\n      if (value.startsWith(\"datetime|\")) {\r\n        value = moment(value.slice('datetime|'.length)).calendar();\r\n      } else if (value.startsWith('timedelta|')) {\r\n        value = getTimedeltaString(parseFloat(value.slice('timedelta|'.length)));\r\n      }\r\n    }\r\n    res = `${(res.length === 0 ? '' : (res + '/'))}${showName}:${value}`\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function ActionTag(props) {\r\n  let { action, selectMode, onClick, onSave, fullWidth, targets } = props;\r\n  const [dialogOpen, setDialogOpen] = React.useState(false);\r\n  // console.log('targets', targets);\r\n  const [actionTemp, setActionTemp] = React.useState((() => {\r\n    if (action.data.action_type === \"adjust_price\" && targets && targets.roomItem) {\r\n      let tmp = deepCopy(action);\r\n      tmp.data.item_id = targets.roomItem.itemId;\r\n      tmp.data.target_price = targets.roomItem.price;\r\n      return tmp;\r\n    } else return action;\r\n  })());\r\n  const [toUse, setToUse] = React.useState(false);\r\n  onClick = onClick ? onClick : () => { };\r\n  if (!action) return null;\r\n  const handleCloseDialog = () => { setDialogOpen(false); };\r\n  const handleClick = newAction => {\r\n    let selected = deepCopy(newAction ? newAction : actionTemp);\r\n    console.log(\"selected action:\", selected);\r\n    onClick(selected, selectMode);\r\n  };\r\n  return <Card style={{ minWidth: 200, margin: 10, width: (fullWidth ? \"100%\" : \"auto\") }}>\r\n    <CardContent onClick={selectMode ? () => { } : () => { handleClick(); }}>\r\n      <Typography variant=\"h5\">{action.name}</Typography>\r\n      {isActionModified(action, \"actions\") ?\r\n        getDataString(action.data, \"actions\", action.type) :\r\n        <Typography variant=\"body1\">{action.desc}</Typography>\r\n      }\r\n      <ListEdit\r\n        // dismiss={['version', 'timezone']}\r\n        keyNames={keyNames}\r\n        open={dialogOpen}\r\n        dataType={action.type}\r\n        typeName=\"actions\"\r\n        onClose={handleCloseDialog}\r\n        // defaultValue={action.data}\r\n        defaultValue={actionTemp.data}\r\n        onSave={newData => {\r\n          let newAction = deepCopy(action);\r\n          newAction.data = newData;\r\n          console.log('newData', newData);\r\n          onSave && onSave(newAction);\r\n          handleCloseDialog();\r\n          if (toUse) handleClick(newAction);\r\n        }}></ListEdit>\r\n    </CardContent>\r\n    {selectMode ? <CardActions>\r\n      <Button color=\"primary\" onClick={selectMode ? () => { handleClick(); } : () => { }}>使用</Button>\r\n      <Button color=\"primary\" onClick={() => { setDialogOpen(true); setToUse(true); }}>修改设置并使用</Button>\r\n    </CardActions> : <CardActions>\r\n      <Button color={isActionModified(action, \"actions\") ? \"primary\" : \"secondary\"} onClick={() => { setDialogOpen(true); }}>修改设置</Button>\r\n    </CardActions>}\r\n  </Card>\r\n}\r\n\r\nexport default function Actions(props) {\r\n  let { selectMode, onClick, targets } = props;\r\n  onClick = onClick ? onClick : () => { };\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const actions = store.getState().types.actions;\r\n  if (!actions && !requesting) {\r\n    setRequesting(true);\r\n    updateActionData().then(() => { forceUpdate(); });\r\n  }\r\n  // console.log('types', store.getState().types)\r\n  let content = null;\r\n  if (!actions) {\r\n    content = <Typography variant=\"body1\">正在加载Action类型...</Typography>\r\n  } else {\r\n    content = <Box style={{ display: \"flex\", flexDirection: \"row\", flexWrap: \"wrap\" }}>\r\n      {Object.keys(actions).map((action_type, k) => <ActionTag targets={targets} onClick={onClick} key={action_type} selectMode={selectMode} action={actions[action_type]}></ActionTag>)}\r\n    </Box>\r\n  }\r\n  return <Box>\r\n    {content}\r\n  </Box>\r\n}","import { Box, Grid, List, ListItem, Typography, Paper, Card, CardContent, CardActions, Button } from \"@material-ui/core\";\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport { setTypes, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { deepCopy, getTimedeltaString, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\nimport ListEdit from \"./ListEdit\";\r\nimport ListInfo from \"./ListInfo\";\r\n\r\nconst keyNames = {\r\n  'start_date': \"开始时间\",\r\n  'end_date': '结束时间',\r\n  \"interval\": \"间隔\",\r\n  \"run_date\": '运行时间'\r\n};\r\n\r\nexport function updateTriggerData(callback) {\r\n  return api.request(\"trigger\", 'GET').then(resp => {\r\n    // console.log(\"resp\", resp);\r\n    store.dispatch(updateTypes(\"triggers\", resp.data.triggers));\r\n    callback && callback(resp.data.triggers);\r\n  });\r\n}\r\n\r\nexport function isTriggerModified(item, type = \"triggers\") {\r\n  try {\r\n    return !isObjectValueEqual(item.data, store.getState().types[type][item.type].data);\r\n  } catch (e) {\r\n    return true;\r\n  }\r\n}\r\n\r\nexport function getTriggerType(trigger) {\r\n  if (trigger.interval) return 'interval';\r\n  if (trigger.run_date) return 'date';\r\n  return 'cron';\r\n}\r\n\r\nexport async function wrapTrigger(trigger) {\r\n  const triggerType = getTriggerType(trigger);\r\n  let triggerData = null;\r\n  if (!store.getState().types.triggers || !store.getState().types.triggers[triggerType]) {\r\n    await updateTriggerData((newTriggerData) => { triggerData = newTriggerData[triggerType] });\r\n  } else triggerData = store.getState().types.triggers[triggerType];\r\n  return objectUpdate(triggerData, { data: trigger });\r\n}\r\n\r\nfunction getDataString(data, typeName, dataType) {\r\n  let res = \"\";\r\n  if (typeof (data) !== 'object') return;\r\n  for (const key in data) {\r\n    const showName = keyNames ? (keyNames[key] || key) : (key);\r\n    const args = dataType && typeName && store.getState().types[typeName][dataType].args[key] ?\r\n      store.getState().types[typeName][dataType].args[key] : null;\r\n    if (args && !args.editable) continue;\r\n    let value = data[key];\r\n    if (!value) continue;\r\n    if (value.startsWith(\"datetime|\")) {\r\n      value = moment(value.slice('datetime|'.length)).calendar();\r\n    } else if (value.startsWith('timedelta|')) {\r\n      value = getTimedeltaString(parseFloat(value.slice('timedelta|'.length)));\r\n    }\r\n    res = `${(res.length === 0 ? '' : (res + '/'))}${showName}:${value}`\r\n  }\r\n  return res;\r\n}\r\n\r\nexport function TriggerTag(props) {\r\n  let { trigger, selectMode, onClick, onSave, fullWidth } = props;\r\n  const [dialogOpen, setDialogOpen] = React.useState(false);\r\n  const [toUse, setToUse] = React.useState(false);\r\n  onClick = onClick ? onClick : () => { };\r\n  if (!trigger) return null;\r\n  const handleCloseDialog = () => { setDialogOpen(false); };\r\n  const handleClick = newTrigger => {\r\n    onClick(newTrigger ? newTrigger : trigger, selectMode);\r\n  };\r\n  return <Card style={{ minWidth: 200, margin: 10, width: (fullWidth ? \"100%\" : \"auto\") }}>\r\n    <CardContent onClick={selectMode ? () => { } : () => { handleClick(); }}>\r\n      <Typography variant=\"h5\">{trigger.name}</Typography>\r\n      {isTriggerModified(trigger, \"triggers\") ?\r\n        getDataString(trigger.data, \"triggers\", trigger.type) :\r\n        <Typography variant=\"body1\">{trigger.desc}</Typography>\r\n      }\r\n      <ListEdit\r\n        dismiss={['version', 'timezone']}\r\n        keyNames={keyNames}\r\n        open={dialogOpen}\r\n        dataType={trigger.type}\r\n        typeName=\"triggers\"\r\n        onClose={handleCloseDialog}\r\n        defaultValue={trigger.data}\r\n        onSave={newData => {\r\n          let newTrigger = deepCopy(trigger);\r\n          newTrigger.data = newData;\r\n          console.log(newData);\r\n          onSave && onSave(newTrigger);\r\n          handleCloseDialog();\r\n          if (toUse) handleClick(newTrigger);\r\n        }}></ListEdit>\r\n    </CardContent>\r\n    {selectMode ? <CardActions>\r\n      <Button color=\"primary\" onClick={selectMode ? () => { handleClick(); } : () => { }}>使用</Button>\r\n      <Button color=\"primary\" onClick={() => { setDialogOpen(true); setToUse(true); }}>修改设置并使用</Button>\r\n    </CardActions> : <CardActions>\r\n      <Button color={isTriggerModified(trigger, \"triggers\") ? \"primary\" : \"secondary\"} onClick={() => { setDialogOpen(true); }}>修改设置</Button>\r\n    </CardActions>}\r\n  </Card>\r\n}\r\n\r\nexport default function Triggers(props) {\r\n  let { selectMode, onClick } = props;\r\n  onClick = onClick ? onClick : () => { };\r\n  const [requesting, setRequesting] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const triggers = store.getState().types.triggers;\r\n  if (!triggers && !requesting) {\r\n    setRequesting(true);\r\n    updateTriggerData().then(() => { forceUpdate(); });\r\n  }\r\n  // console.log('types', store.getState().types)\r\n  let content = null;\r\n  if (!triggers) {\r\n    content = <Typography variant=\"body1\">正在加载触发器类型...</Typography>\r\n  } else {\r\n    content = <Box style={{ display: \"flex\", flexDirection: \"row\", flexWrap: \"wrap\" }}>\r\n      {Object.keys(triggers).map((trigger_type, k) => <TriggerTag onClick={onClick} key={trigger_type} selectMode={selectMode} trigger={triggers[trigger_type]}></TriggerTag>)}\r\n    </Box>\r\n  }\r\n  return <Box>\r\n    {content}\r\n  </Box>\r\n}","import { Box, Button, Checkbox, Collapse, Container, Dialog, DialogActions, DialogContent, DialogTitle, Grid, IconButton, List, ListItem, ListItemSecondaryAction, ListItemText, ListSubheader, makeStyles, TextField, Typography } from \"@material-ui/core\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport moment from \"moment\";\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport Actions, { wrapAction } from \"../components/Actions\";\r\nimport { ActionTag, updateActionData, isActionModified } from \"../components/Actions\";\r\nimport Triggers, { updateTriggerData, wrapTrigger } from \"../components/Triggers\";\r\nimport { TriggerTag, isTriggerModified } from \"../components/Triggers\";\r\nimport { setErrorInfo, setMessage, setTasks, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { arrayRemove, deepCopy, formatDateTime, getNewNumberString, isObjectValueEqual, objectUpdate, timedeltaUnits } from \"../utils/utils\";\r\nimport { ActionData } from \"./ListEdit\";\r\n\r\nlet taskDialogUpdate = false;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  nested: {\r\n    paddingLeft: theme.spacing(4),\r\n  },\r\n  centerText: {\r\n    display: 'flex',\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    // overflow: 'hidden',\r\n    whiteSpace: 'nowrap',\r\n  }\r\n}));\r\n\r\nexport function setTaskDialogUpdate(val) { taskDialogUpdate = val; }\r\n\r\nlet roomItemUpdated = false;\r\n\r\nexport default function TaskDialog(props) {\r\n  const classes = useStyles();\r\n  const { addMode, open, onClose, onRefresh, onSave, targets, simpleMode } = props;\r\n  const taskOld = props.taskOld === true ? null : props.taskOld;\r\n  // console.log('targets', targets);\r\n  const baseTaskName = (targets && targets.taskName) ? targets.taskName : '未命名任务';\r\n  const realDefaultTask = {\r\n    task_name: baseTaskName,\r\n    triggers: [],\r\n    actions: [],\r\n  };\r\n  const defaultTask = addMode ? (props.defaultTask ? props.defaultTask : realDefaultTask) : taskOld ? taskOld : (props.defaultTask ? props.defaultTask : realDefaultTask);\r\n  const defaultCollapseOpen = {\r\n    timenode: false,\r\n    cycle: false\r\n  };\r\n  const [state, setInnerState] = React.useState({\r\n    dialogAddTaskOpen: false,\r\n    dialogAddTriggerOpen: false,\r\n    dialogAddActionOpen: false,\r\n    dialogUpdateTrigger: false,\r\n    task: defaultTask,\r\n    requestingTaskData: false,\r\n    defaultTid: null,\r\n    useSimpleMode: simpleMode,\r\n    collapseOpen: defaultCollapseOpen,\r\n    simpleData: {\r\n      timenodeTime: `datetime|${formatDateTime(new Date())}`,\r\n      timenodePrice: 100,\r\n      cycleTime: `timedelta|${timedeltaUnits[\"周\"]}`,\r\n      cyclePrice: 100\r\n    }\r\n  });\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  const setCollapseToggle = (name) => {\r\n    // setState({ collapseOpen: objectUpdate(state.collapseOpen, { [name]: !state.collapseOpen[name] }) });\r\n    setState({ collapseOpen: objectUpdate(defaultCollapseOpen, { [name]: !state.collapseOpen[name] }) });\r\n  }\r\n  // console.log('baseTaskName', baseTaskName, 'defaultTask', defaultTask);\r\n  // console.log('state', state);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const taskData = store.getState().types.task_data;\r\n  if (!roomItemUpdated && targets && targets.roomItem) {\r\n    roomItemUpdated = true;\r\n    try {\r\n      setState({\r\n        simpleData: objectUpdate(state.simpleData, {\r\n          timenodePrice: targets && targets.roomItem ? targets.roomItem.price : state.simpleData.timenodePrice,\r\n          cyclePrice: targets && targets.roomItem ? targets.roomItem.price : state.simpleData.cyclePrice\r\n        })\r\n      });\r\n    } catch (e) {\r\n      roomItemUpdated = false;\r\n      console.error(e);\r\n    }\r\n  }\r\n\r\n  // console.log('taskNow', state.task);\r\n  if (!addMode && (taskDialogUpdate || (isObjectValueEqual(state.task, realDefaultTask) && !isObjectValueEqual(defaultTask, realDefaultTask)))) {\r\n    taskDialogUpdate = false;\r\n    setState({ task: defaultTask });\r\n  } else if (taskDialogUpdate) {\r\n    taskDialogUpdate = false;\r\n    setState({ task: defaultTask });\r\n  }\r\n\r\n  if (!state.requestingTaskData && !taskData) {\r\n    setState({ requestingTaskData: true });\r\n    api.request(\"task\", 'PATCH').then(resp => {\r\n      // console.log(\"resp\", resp);\r\n      let taskData = resp.data.task_data;\r\n      taskData.tid = null;\r\n      store.dispatch(updateTypes(\"task_data\", taskData));\r\n      forceUpdate();\r\n    })\r\n  }\r\n\r\n  const handleAddTask = addMode ? () => {\r\n    // console.log('pass#2');\r\n    if (!taskData) {\r\n      setErrorInfo(\"Task数据为空。\");\r\n      console.error(\"Task数据为空。\");\r\n      return;\r\n    }\r\n    // const task = objectUpdate(taskData, { triggers: state.task.triggers, actions: state.task.actions, task_name: state.task.task_name, tid: null, });\r\n    const task = objectUpdate(taskData, state.task);\r\n    console.log('task', task);\r\n    return api.request('task', \"POST\", { task }).then(resp => {\r\n      // console.log('resp', resp);\r\n      if (resp.code !== 200) return;\r\n      const defaultTid = resp.data.tid ? (resp.data.tid + 1) : null;\r\n      setState({\r\n        defaultTid,\r\n        taskName: store.getState().types.task_data ? `${baseTaskName}${defaultTid ? defaultTid : \"\"}` : baseTaskName,\r\n      });\r\n      onRefresh && onRefresh();\r\n    });\r\n  } : () => {\r\n    if (!taskOld) return;\r\n    const task = objectUpdate(taskOld, state.task);\r\n    console.log('task', task);\r\n    if (onSave)\r\n      return onSave(task);\r\n    else return new Promise((resolve, reject) => { resolve(); });\r\n  };\r\n\r\n  const dialogContent = state.useSimpleMode ?\r\n    <List>\r\n      {simpleMode ? <ListItem>\r\n        <Button variant=\"outlined\" onClick={() => { setState({ useSimpleMode: !state.useSimpleMode }); }} fullWidth color=\"secondary\">高级模式</Button>\r\n      </ListItem> : null}\r\n      <ListItem>\r\n        <ListItemText primary=\"计划名称\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <TextField value={state.task.task_name} onChange={e => {\r\n            let newTask = deepCopy(state.task);\r\n            newTask.task_name = e.target.value;\r\n            setState({ task: newTask });\r\n          }}></TextField>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        // setState({ collapseOpen: objectUpdate(state.collapseOpen, { timenode: !(!!state.collapseOpen.timenode) }) });\r\n        setCollapseToggle('timenode');\r\n      }}>\r\n        <Box style={{ display: \"flex\", flexFlow: \"row\" }}>\r\n          <Checkbox checked={state.collapseOpen.timenode}></Checkbox>\r\n          <Box>\r\n            <Box className={classes.centerText} style={{ height: \"100%\" }}>在某一个时间点改变价格</Box>\r\n          </Box>\r\n        </Box>\r\n      </ListItem>\r\n      <Collapse in={state.collapseOpen.timenode} timeout=\"auto\" unmountOnExit className={classes.nested}>\r\n        <Box style={{ display: \"flex\", flexFlow: \"row\", justifyContent: \"space-between\" }}>\r\n          <Box className={classes.centerText}>在</Box>\r\n          <ActionData value={state.simpleData.timenodeTime} onChange={e => {\r\n            if (!e) setState({ simpleData: objectUpdate(state.simpleData, { timenodeTime: `datetime|${formatDateTime(new Date())}` }) });\r\n            else setState({ simpleData: objectUpdate(state.simpleData, { timenodeTime: `datetime|${formatDateTime(e)}` }) });\r\n          }} onDelete={() => { setState({ simpleData: objectUpdate(state.simpleData, { timenodeTime: \"datetime|\" }) }); }}></ActionData>\r\n          <Box className={classes.centerText}>调整价格到</Box>\r\n          <TextField style={{ maxWidth: 60 }} inputProps={{ style: { textAlign: \"center\" } }} value={`${state.simpleData.timenodePrice}`} onChange={e => {\r\n            const newValue = getNewNumberString(e.target.value);\r\n            if (newValue === null) return;\r\n            setState({ simpleData: objectUpdate(state.simpleData, { timenodePrice: newValue }) });\r\n          }}></TextField>\r\n        </Box>\r\n      </Collapse>\r\n      <ListItem button onClick={() => {\r\n        // setState({ collapseOpen: objectUpdate(state.collapseOpen, { cycle: !(!!state.collapseOpen.cycle) }) });\r\n        setCollapseToggle('cycle');\r\n      }}>\r\n        <Box style={{ display: \"flex\", flexFlow: \"row\" }}>\r\n          <Checkbox checked={state.collapseOpen.cycle}></Checkbox>\r\n          <Box>\r\n            <Box className={classes.centerText} style={{ height: \"100%\" }}>周期性改变价格</Box>\r\n          </Box>\r\n        </Box>\r\n      </ListItem>\r\n      <Collapse in={state.collapseOpen.cycle} timeout=\"auto\" unmountOnExit className={classes.nested}>\r\n        <Box style={{ display: \"flex\", flexFlow: \"row\", justifyContent: \"space-between\" }}>\r\n          <Box className={classes.centerText}>每隔</Box>\r\n          <TextField style={{ maxWidth: 60 }} inputProps={{ style: { textAlign: \"center\" } }} value={`${parseFloat(state.simpleData.cycleTime.slice('timedelta|'.length)) / timedeltaUnits['天']}`} onChange={e => {\r\n            const value = parseFloat(e.target.value);\r\n            console.log(value);\r\n            const newValue = getNewNumberString(`${value}`);\r\n            if (newValue === null) return;\r\n            setState({ simpleData: objectUpdate(state.simpleData, { cycleTime: `timedelta|${newValue * timedeltaUnits['天']}` }) });\r\n          }}></TextField>\r\n          <Box className={classes.centerText}>天，调整价格到</Box>\r\n          <TextField style={{ maxWidth: 60 }} inputProps={{ style: { textAlign: \"center\" } }} value={`${state.simpleData.cyclePrice}`} onChange={e => {\r\n            const newValue = getNewNumberString(e.target.value);\r\n            if (newValue === null) return;\r\n            setState({ simpleData: objectUpdate(state.simpleData, { cyclePrice: newValue }) });\r\n          }}></TextField>\r\n        </Box>\r\n      </Collapse>\r\n    </List> :\r\n    <List>\r\n      {simpleMode ? <ListItem>\r\n        <Button variant=\"outlined\" onClick={() => { setState({ useSimpleMode: !state.useSimpleMode }); }} fullWidth color=\"secondary\">简单模式</Button>\r\n      </ListItem> : null}\r\n      <ListSubheader>计划名称</ListSubheader>\r\n      <ListItem>\r\n        <TextField fullWidth value={state.task.task_name} onChange={e => {\r\n          let newTask = deepCopy(state.task);\r\n          newTask.task_name = e.target.value;\r\n          setState({ task: newTask });\r\n        }}></TextField>\r\n      </ListItem>\r\n      <ListSubheader>触发器列表</ListSubheader>\r\n      {state.task.triggers.map((trigger, k) => <ListItem key={trigger}>\r\n        <TriggerTag fullWidth trigger={trigger} onSave={data => {\r\n          console.log('saveing', data);\r\n          let newTask = deepCopy(state.task);\r\n          newTask.triggers[k] = data;\r\n          setState({ task: newTask });\r\n        }}></TriggerTag>\r\n        <ListItemSecondaryAction>\r\n          <IconButton onClick={() => {\r\n            let newTask = deepCopy(state.task);\r\n            newTask.triggers.splice(k, 1);\r\n            setState({ task: newTask });\r\n          }}>\r\n            <DeleteIcon></DeleteIcon>\r\n          </IconButton>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>)}\r\n      <ListSubheader>Actions列表</ListSubheader>\r\n      {state.task.actions.map((action, k) => <ListItem key={action}>\r\n        <ActionTag fullWidth action={action} onSave={data => {\r\n          console.log('saveing', data);\r\n          let newTask = deepCopy(state.task);\r\n          newTask.actions[k] = data;\r\n          setState({ task: newTask });\r\n        }}></ActionTag>\r\n        <ListItemSecondaryAction>\r\n          <IconButton onClick={() => {\r\n            let newTask = deepCopy(state.task);\r\n            newTask.actions.splice(k, 1);\r\n            setState({ task: newTask });\r\n          }}>\r\n            <DeleteIcon></DeleteIcon>\r\n          </IconButton>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>)}\r\n      <ListItem>\r\n        <Grid container spacing={5}>\r\n          <Grid item xs={12} lg={6}>\r\n            <Button fullWidth onClick={() => { setState({ dialogAddTriggerOpen: true }) }} color=\"primary\" variant=\"outlined\">添加触发器</Button>\r\n          </Grid>\r\n          <Grid item xs={12} lg={6}>\r\n            <Button fullWidth onClick={() => { setState({ dialogAddActionOpen: true }) }} color=\"primary\" variant=\"outlined\">添加Action</Button>\r\n          </Grid>\r\n        </Grid>\r\n      </ListItem>\r\n    </List>;\r\n\r\n  return <Dialog fullWidth open={open} onClose={() => { onClose && onClose(false) }}>\r\n    <DialogTitle>{addMode ? \"添加新任务\" : \"设置任务\"}</DialogTitle>\r\n    <DialogContent>\r\n      {dialogContent}\r\n      <Dialog open={state.dialogAddTriggerOpen} onClose={() => setState({ dialogAddTriggerOpen: false })}>\r\n        <DialogTitle>选择一个触发器</DialogTitle>\r\n        <DialogContent>\r\n          <Triggers targets={targets} onClick={trigger => {\r\n            console.log(\"trigger\", trigger);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.triggers.push(trigger);\r\n            setState({ dialogAddTriggerOpen: false, task: newTask });\r\n          }} selectMode></Triggers>\r\n        </DialogContent>\r\n      </Dialog>\r\n      <Dialog open={state.dialogAddActionOpen} onClose={() => setState({ dialogAddActionOpen: false })}>\r\n        <DialogTitle>选择一个Action</DialogTitle>\r\n        <DialogContent>\r\n          <Actions targets={targets} onClick={action => {\r\n            console.log(\"action\", action);\r\n            let newTask = deepCopy(state.task);\r\n            newTask.actions.push(action);\r\n            setState({ dialogAddActionOpen: false, task: newTask });\r\n          }} selectMode></Actions>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </DialogContent>\r\n    <DialogActions>\r\n      <Button color=\"primary\" disabled={state.useSimpleMode ? (\r\n        (() => {\r\n          for (const col in state.collapseOpen) {\r\n            if (state.collapseOpen[col]) return false;\r\n          }\r\n          return true;\r\n        })()\r\n      ) : (state.task.triggers.length === 0 || state.task.actions.length === 0)} onClick={async () => {\r\n        if (!state.useSimpleMode) {\r\n          handleAddTask().then(() => {\r\n            setState({ task: defaultTask });\r\n            onClose && onClose(true);\r\n          });\r\n        } else {\r\n          if (!targets || (targets && !targets.roomItem)) {\r\n            console.warn('targets error');\r\n          }\r\n          // 生成对应的触发器和Actions\r\n          let triggers = [], actions = [];\r\n          // console.log(store.getState().types);\r\n          const defaultData = {\r\n            triggers: store.getState().types.triggers ?\r\n              store.getState().types.triggers :\r\n              await ((() => {\r\n                return new Promise((resolve, reject) => {\r\n                  updateTriggerData((d) => { resolve(d); });\r\n                })\r\n              })()),\r\n            actions: store.getState().types.actions ?\r\n              store.getState().types.actions :\r\n              await ((() => {\r\n                return new Promise((resolve, reject) => {\r\n                  updateActionData((d) => { resolve(d); });\r\n                })\r\n              })()),\r\n          }\r\n          for (const col in state.collapseOpen) {\r\n            if (state.collapseOpen[col]) {\r\n              if (col === 'timenode') {\r\n                // console.log(defaultData);\r\n                if (state.simpleData.timenodeTime === 'datetime|') {\r\n                  store.dispatch(setMessage(\"时间点未设置\"));\r\n                  return;\r\n                }\r\n                triggers.push(objectUpdate(defaultData.triggers.date,\r\n                  { data: objectUpdate(defaultData.triggers.date.data, { run_date: state.simpleData.timenodeTime }) }));\r\n                actions.push(objectUpdate(defaultData.actions.adjust_price,\r\n                  {\r\n                    data: objectUpdate(defaultData.actions.adjust_price.data,\r\n                      { target_price: state.simpleData.timenodePrice, item_id: targets.roomItem.itemId })\r\n                  }));\r\n              } else if (col === 'cycle') {\r\n                triggers.push(objectUpdate(defaultData.triggers.interval,\r\n                  { data: objectUpdate(defaultData.triggers.interval.data, { interval: state.simpleData.cycleTime }) }));\r\n                actions.push(objectUpdate(defaultData.actions.adjust_price,\r\n                  {\r\n                    data: objectUpdate(defaultData.actions.adjust_price.data,\r\n                      { target_price: state.simpleData.timenodePrice, item_id: targets.roomItem.itemId })\r\n                  }));\r\n              }\r\n            }\r\n          }\r\n          const newTask = objectUpdate(state.task, { triggers, actions });\r\n          // console.log(newTask);\r\n          await api.request('task', \"POST\", { task: newTask });\r\n          onClose && onClose(true);\r\n        }\r\n      }}>确定</Button>\r\n      <Button onClick={() => { onClose && onClose(false); }}>取消</Button>\r\n    </DialogActions>\r\n  </Dialog >;\r\n}","import { Box, Button, Container, Dialog, DialogActions, DialogContent, DialogTitle, Grid, IconButton, List, ListItem, ListItemSecondaryAction, ListItemText, ListSubheader, TextField, Typography } from \"@material-ui/core\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport React from \"react\";\r\nimport { api } from \"../api/api\";\r\nimport Actions, { wrapAction } from \"../components/Actions\";\r\nimport { ActionTag, isActionModified } from \"../components/Actions\";\r\nimport TaskDialog, { setTaskDialogUpdate } from \"../components/TaskDialog\";\r\nimport Triggers, { wrapTrigger } from \"../components/Triggers\";\r\nimport { TriggerTag, isTriggerModified } from \"../components/Triggers\";\r\nimport { setErrorInfo, setTasks, updateTypes } from \"../data/action\";\r\nimport store from \"../data/store\";\r\nimport { arrayRemove, deepCopy, isObjectValueEqual, objectUpdate } from \"../utils/utils\";\r\n\r\n\r\nasync function wrapTask(task) {\r\n  const taskData = store.getState().types.task_data;\r\n  if (!taskData) return;\r\n  let taskWrapped = objectUpdate(taskData, task);\r\n  // taskWrapped.triggers = taskWrapped.triggers.map(async trigger => await wrapTrigger(trigger));\r\n  for (let i = 0; i < taskWrapped.triggers.length; i++)\r\n    taskWrapped.triggers[i] = await wrapTrigger(taskWrapped.triggers[i]);\r\n  // taskWrapped.actions = taskWrapped.actions.map(async action => await wrapAction(action));\r\n  for (let i = 0; i < taskWrapped.actions.length; i++)\r\n    taskWrapped.actions[i] = await wrapAction(taskWrapped.actions[i]);\r\n  if (taskWrapped.triggers.includes(null) || taskWrapped.actions.includes(null)) return null;\r\n  return taskWrapped;\r\n}\r\n\r\n\r\nfunction TaskTag(props) {\r\n  const { task, onUpdate, onClick } = props;\r\n  // return <code>{JSON.stringify(task)}</code>;\r\n  return <ListItem button onClick={async () => {\r\n    if (!onClick) return;\r\n    let taskOrigin = deepCopy(task);\r\n    console.log('task before', taskOrigin);\r\n    const taskWrapped = await wrapTask(taskOrigin);\r\n    console.log('task after', taskWrapped);\r\n    taskWrapped && onClick && onClick(taskWrapped);\r\n  }}>\r\n    <ListItemText>\r\n      <Box>\r\n        <Typography variant=\"h5\">{task.task_name}</Typography>\r\n      </Box>\r\n      <Box>\r\n        <Typography variant=\"body2\">{`tid:${task.tid}/触发器:${task.triggers.length}/Action:${task.actions.length}`}</Typography>\r\n      </Box>\r\n    </ListItemText>\r\n    <ListItemSecondaryAction>\r\n      <IconButton onClick={() => {\r\n        api.request_key(\"task\", task.tid, \"DELETE\").then(resp => {\r\n          if (resp.code !== 200) store.dispatch(setErrorInfo(resp));\r\n          onUpdate && onUpdate();\r\n        });\r\n      }}>\r\n        <DeleteIcon></DeleteIcon>\r\n      </IconButton>\r\n    </ListItemSecondaryAction>\r\n  </ListItem>\r\n}\r\n\r\nexport function getTargetTasks(targets) {\r\n  const tasks = store.getState().tasks;\r\n  if (!targets || !targets.roomItem || (targets.roomItem && JSON.stringify(targets.roomItem) === \"{}\")) return tasks;\r\n  let result = [];\r\n  for (const task of tasks) {\r\n    for (const action of task.actions) {\r\n      if (!action) return [];\r\n      const target = action.data ? action.data : action;\r\n      // console.log('target', target, 'require', targets);\r\n      if (target.action_type === \"adjust_price\") {\r\n        if (targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n          result.push(task);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  // if (result.length > 0) {\r\n  //   console.log(\"getTargetTasks\", result, targets, tasks);\r\n  //   // debugger;\r\n  // }\r\n  return result;\r\n}\r\n\r\nexport function getTargetTasksMarks(targets) {\r\n  if (targets) console.log(targets);\r\n  const tasks = store.getState().tasks;\r\n  const marks = tasks.map((task, k) => {\r\n    for (const action of task.actions) {\r\n      const target = action.data ? action.data : action;\r\n      if (target.action_type === \"adjust_price\") {\r\n        if (targets && targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n          console.log('found', task);\r\n          return true;\r\n        } else if (!targets) return true;\r\n      }\r\n    }\r\n    return false;\r\n  });\r\n  // if (!targets || !targets.roomItem || (targets.roomItem && JSON.stringify(targets.roomItem) === \"{}\")) return tasks;\r\n  // let result = [];\r\n  // for (const task of tasks) {\r\n  //   for (const action of task.actions) {\r\n  //     const target = action.data ? action.data : action;\r\n  //     if (target.action_type === \"adjust_price\") {\r\n  //       if (targets.roomItem && target.item_id === targets.roomItem.itemId) {\r\n  //         result.push(task);\r\n  //         break;\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n  // if (result.length > 0)\r\n  //   console.log(\"getTargetTasks\", result, targets, tasks);\r\n  // return result;\r\n  return marks;\r\n}\r\n\r\nexport function TaskList(props) {\r\n  const { onClick, onUpdate, targets, fullWidth } = props;\r\n  // const tasks = getTargetTasks(targets);\r\n  const tasks = props.tasks ? props.tasks : store.getState().tasks;\r\n  const marks = props.tasks ? getTargetTasksMarks(null) : getTargetTasksMarks(targets);\r\n  if (targets && targets.roomItem && JSON.stringify(targets.roomItem) !== \"{}\") console.log('tasks', targets, tasks);\r\n  // if (tasks.length > 0) console.log(tasks, marks);\r\n  return tasks.length > 0 ? <List>\r\n    {tasks.map((task, k) => marks[k] ? <TaskTag onClick={onClick} onUpdate={onUpdate} key={task} task={task}></TaskTag> : null)}\r\n  </List> : <List style={{ width: fullWidth ? \"100%\" : null }}>\r\n    <ListItem>\r\n      <Typography variant=\"body1\" color=\"textSecondary\">空列表</Typography>\r\n    </ListItem>\r\n  </List>\r\n}\r\n\r\nexport default function Tasks(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    requestingTasks: false,\r\n    dialogAddTaskOpen: false,\r\n    addMode: true,\r\n    task: null,\r\n  });\r\n  const tasks = store.getState().tasks;\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n\r\n  if (!state.requestingTasks) {\r\n    setState({ requestingTasks: true });\r\n    api.request(\"task\", \"GET\").then(resp => {\r\n      if (resp.code !== 200) {\r\n        store.dispatch(setErrorInfo(resp));\r\n        return;\r\n      }\r\n      store.dispatch(setTasks(resp.data.tasks));\r\n      forceUpdate();\r\n    });\r\n  }\r\n\r\n  return <Container>\r\n    <Grid container spacing={3}>\r\n      <Grid item lg={8} sm={12}>\r\n        <Typography variant=\"h4\">任务列表</Typography>\r\n        {/* {tasks.length > 0 ? <List>\r\n          {tasks.map((task, k) => <TaskTag onClick={task => {\r\n            console.log('Task: onClick', task);\r\n            setTaskDialogUpdate(true);\r\n            setState({ dialogAddTaskOpen: true, addMode: false, task });\r\n          }} onUpdate={() => { setState({ requestingTasks: false }); }} key={v} task={task}></TaskTag>)}\r\n        </List> : <List>\r\n          <ListItem>\r\n            <Typography variant=\"body1\" color=\"textSecondary\">空列表</Typography>\r\n          </ListItem>\r\n        </List>} */}\r\n        <TaskList onClick={task => {\r\n          console.log('Task: onClick', task);\r\n          setTaskDialogUpdate(true);\r\n          setState({ dialogAddTaskOpen: true, addMode: false, task });\r\n        }} onUpdate={() => { setState({ requestingTasks: false }); }}></TaskList>\r\n      </Grid>\r\n      <Grid item lg={4} sm={12}>\r\n        <Container maxWidth=\"xs\">\r\n          <List>\r\n            <ListSubheader>新任务</ListSubheader>\r\n            <ListItem>\r\n              <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={() => {\r\n                setTaskDialogUpdate(true);\r\n                setState({ dialogAddTaskOpen: true, addMode: true });\r\n              }}>添加新任务</Button>\r\n            </ListItem>\r\n            <ListItem>\r\n              <Button fullWidth variant=\"contained\">设置默认任务</Button>\r\n            </ListItem>\r\n\r\n            <ListSubheader>全部任务管理</ListSubheader>\r\n            <ListItem>\r\n              <Button fullWidth disabled={tasks.length === 0} variant=\"outlined\" onClick={() => {\r\n                let tids = {};\r\n                tasks.map(task => { tids = Object.assign(tids, { [task.tid]: task.tid }); return null; });\r\n                api.request(\"task\", \"DELETE\", { tids }).then(resp => {\r\n                  // forceUpdate();\r\n                  setState({ requestingTasks: false });\r\n                });\r\n              }}>删除全部任务</Button>\r\n            </ListItem>\r\n          </List>\r\n        </Container>\r\n      </Grid>\r\n    </Grid>\r\n    <TaskDialog taskOld={state.task}\r\n      addMode={state.addMode}\r\n      open={state.dialogAddTaskOpen}\r\n      onRefresh={() => { setState({ requestingTasks: false }); }}\r\n      onClose={() => { setState({ dialogAddTaskOpen: false }); }}\r\n      onSave={task => {\r\n        return api.request_key('task', task.tid, \"POST\", { task }).then(resp => {\r\n          setState({ requestingTasks: false });\r\n        });\r\n      }}\r\n    ></TaskDialog>\r\n  </Container >\r\n}","import React from 'react';\r\nimport { Box, Container, LinearProgress, Button, Dialog, Link, List, ListItemText, DialogTitle, DialogContent, ListItem, Typography, DialogActions } from '@material-ui/core';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport Table from '@material-ui/core/Table';\r\nimport TableBody from '@material-ui/core/TableBody';\r\nimport TableCell from '@material-ui/core/TableCell';\r\nimport TableContainer from '@material-ui/core/TableContainer';\r\nimport TableHead from '@material-ui/core/TableHead';\r\nimport TableRow from '@material-ui/core/TableRow';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport { api } from '../api/api';\r\nimport store from '../data/store';\r\nimport { setDaemon, setErrorInfo, setTasks } from '../data/action';\r\nimport TaskDialog, { setTaskDialogUpdate } from \"./TaskDialog\";\r\nimport { deepCopy, weekDayList } from '../utils/utils';\r\nimport { getTargetTasks, TaskList } from '../pages/Tasks';\r\n\r\nconst useStyles = makeStyles({\r\n  table: {\r\n    minWidth: 1500,\r\n  },\r\n  foodDesc: {\r\n    overflow: 'hidden',\r\n    whiteSpace: 'nowrap',\r\n    contentOverflow: 'ellipsis',\r\n    maxWidth: 160\r\n  },\r\n  planButton: {\r\n    overflow: 'hidden',\r\n    whiteSpace: 'nowrap',\r\n    contentOverflow: 'ellipsis',\r\n    maxWidth: 160\r\n  }\r\n});\r\n\r\nfunction MyTableCell(props) {\r\n  let styles = Object.assign((props.style ? props.style : {}), { padding: 3 });\r\n  // console.log('props.noBorder', props.noBorder);\r\n  if (props.noBorder) styles.borderBottom = \"0\";\r\n  // return <TableCell align={props.align} colSpan={props.colSpan} style={styles}>{props.content}</TableCell>\r\n  return <TableCell align={props.align} colSpan={props.colSpan} style={styles}>{props.children}</TableCell>\r\n}\r\n\r\n// 容易subscribe到已经卸载的component上面...\r\n// store.subscribe(() => {\r\n//   console.log('(tables) redux update to', store.getState());\r\n// });\r\n\r\nlet requestedDayData = null;\r\n// let roomItemNow = {};\r\nlet setUpdateTimer = null;\r\n\r\nfunction ReserveTable(props) {\r\n  const classes = useStyles();\r\n  // console.log('daemon', store.getState().daemon);\r\n  const [requestingDaemon, setRequestingDaemon] = React.useState(false);\r\n  const [requestingUpdate, setRequestingUpdate] = React.useState(false);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const { day, data } = props;\r\n  const date = new Date().setDay(day).toDateString();\r\n  // const [dayData, setDayData] = React.useState(data ? data : store.getState().daemon.reserve_table[date]);\r\n  const [dayData, setDayData] = React.useState(data);\r\n  const [roomList, setRoomList] = React.useState((store.getState().daemon &&\r\n    store.getState().daemon.reserve_table &&\r\n    store.getState().daemon.reserve_table[date]) ? store.getState().daemon.reserve_table[date].roomList : []);\r\n  const [dialogAddTaskOpen, setDialogAddTaskOpen] = React.useState(null);\r\n  const [dialogTasksListOpen, setDialogTasksListOpen] = React.useState(null);\r\n  const [roomItemNow, setRoomItemNow] = React.useState({});\r\n  const [requestingTasks, setRequestingTasks] = React.useState(false);\r\n\r\n  if (!requestingTasks && (!store.getState().tasks || (store.getState().tasks || store.getState().tasks.length === 0))) {\r\n    setRequestingTasks(true);\r\n    api.request(\"task\", \"GET\").then(resp => {\r\n      if (resp.code !== 200) return;\r\n      store.dispatch(setTasks(resp.data.tasks));\r\n      forceUpdate();\r\n    });\r\n  }\r\n\r\n  if (!store.getState().daemon) {\r\n    if (!requestingDaemon) {\r\n      setRequestingDaemon(true);\r\n      api.request(\"daemon\", \"GET\").then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n      });\r\n    }\r\n    return <LinearProgress></LinearProgress>;\r\n  }\r\n  if (!store.getState().daemon.reserve_table) {\r\n    if (!requestingUpdate) {\r\n      setRequestingUpdate(true);\r\n      api.request(\"daemon\", \"POST\", { daemon_args: { update_all: true } }).then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n      });\r\n    }\r\n    return <LinearProgress></LinearProgress>;\r\n  }\r\n\r\n  requestedDayData = JSON.stringify(store.getState().daemon.reserve_table[date]) !== '{}' && JSON.stringify(store.getState().daemon.reserve_table[date]) !== undefined;\r\n  // console.log('requested', requestedDayData);\r\n  // console.log('date', date);\r\n\r\n  const PeriodTable = function (props) {\r\n    const classes = useStyles();\r\n    const { data, roomList } = props;\r\n    // console.log(\"data\", data);\r\n    let table = {};\r\n    let periodIds = [];\r\n    let periodMap = {};\r\n    for (const period of data.periodList) {\r\n      table[period.periodId] = {};\r\n      periodMap[period.periodId] = period;\r\n      periodIds.push({ id: period.periodId, desc: period.periodDesc });\r\n      for (const room of roomList) {\r\n        table[period.periodId][room.roomName] = [];\r\n      }\r\n      for (const roomMapItemName in period.roomMapItemEntry) {\r\n        if (!table[period.periodId][roomMapItemName]) table[period.periodId][roomMapItemName] = [];\r\n        for (const roomItem of period.roomMapItemEntry[roomMapItemName]) {\r\n          table[period.periodId][roomMapItemName].push(roomItem);\r\n        }\r\n      }\r\n    }\r\n    // console.log('table', table);\r\n    let rows = [];\r\n    let maxRows = {};\r\n    // let key = 1;\r\n    for (const periodData of periodIds) {\r\n      const periodId = periodData.id;\r\n      if (!table[periodId]) continue;\r\n      let index = 0;\r\n      while (true) {\r\n        let notEmpty = false;\r\n        for (const room of roomList) {\r\n          if (!table[periodId][room.roomName] || !(table[periodId][room.roomName] && table[periodId][room.roomName][index])) {\r\n            continue;\r\n          }\r\n          notEmpty = true;\r\n        }\r\n        if (!notEmpty) break;\r\n        index++;\r\n      }\r\n      maxRows[periodId] = index;\r\n    }\r\n    const getCenterTable = (index, maxIndex, content, key) => {\r\n      return index == (parseInt(maxIndex / 2)) ? (maxIndex % 2 === 1 ? (index === maxIndex - 1 ? <MyTableCell key={key} align=\"center\" colSpan={1}>{content}</MyTableCell> :\r\n        <MyTableCell key={key} align=\"center\" noBorder colSpan={1}>{content}</MyTableCell>) :\r\n        (index === maxIndex - 1 ? <MyTableCell key={key} align=\"center\" colSpan={1}><Box style={{ position: \"relative\", top: -15 }}>{content}</Box></MyTableCell> :\r\n          <MyTableCell key={key} align=\"center\" noBorder colSpan={1}><Box style={{ position: \"relative\", top: -15 }}>{content}</Box></MyTableCell>)) :\r\n        (index === maxIndex - 1 ? <MyTableCell key={key} align=\"center\" colSpan={1}></MyTableCell> :\r\n          <MyTableCell key={key} align=\"center\" colSpan={1} noBorder></MyTableCell>);\r\n    };\r\n    for (const periodData of periodIds) {\r\n      const periodId = periodData.id;\r\n      if (!table[periodId]) continue;\r\n      let index = 0;\r\n      while (true) {\r\n        let notEmpty = false;\r\n        const maxIndex = maxRows[periodId] ? maxRows[periodId] : 1;\r\n        // let row = [getCenterTable(index, maxIndex, periodData.id, key++),];\r\n        let row = [getCenterTable(index, maxIndex, <Box component=\"div\" className={classes.foodDesc}>\r\n          {periodData.desc}\r\n        </Box>, periodId),];\r\n        for (const room of roomList) {\r\n          if (!table[periodId][room.roomName] || !(table[periodId][room.roomName] && table[periodId][room.roomName][index])) {\r\n            for (const i of [0, 1, 2, 3]) {\r\n              row.push(<MyTableCell key={`${periodId}${room.roomName}${index}-blank-${i}`} colSpan={1}></MyTableCell>);\r\n            }\r\n            continue;\r\n          }\r\n          notEmpty = true;\r\n          const roomItem = table[periodId][room.roomName][index];\r\n          // console.log(\"roomItem\", roomItem);\r\n          // 价格\r\n          row.push(<MyTableCell key={`${periodId}${room.roomName}${index}-price`} align=\"center\" colSpan={1}>{'￥' + roomItem.price}</MyTableCell>);\r\n          // 说明\r\n          row.push(<MyTableCell key={`${periodId}${room.roomName}${index}-foodDesc`} align=\"center\" colSpan={1}>\r\n            <Box component=\"div\" className={classes.foodDesc}>\r\n              {roomItem.foodDesc}\r\n            </Box>\r\n          </MyTableCell>);\r\n          // 库存\r\n          row.push(getCenterTable(index, table[periodId][room.roomName] ? table[periodId][room.roomName].length : maxIndex, `${roomItem.stock}间`, `${periodId}${room.roomName}${index}-stock`));\r\n          // 计划\r\n          // row.push(<MyTableCell key={key} align=\"center\" colSpan={1}><Link className={classes.planButton}>计划</Link></MyTableCell>);\r\n          row.push(<MyTableCell key={`${periodId}${room.roomName}${index}-plan`} align=\"center\" colSpan={1}>{\r\n            (() => {\r\n              let planCount = getTargetTasks({ roomItem }).length;\r\n              return (<Link onClick={planCount === 0 ? () => {\r\n                const parent = periodMap[periodId];\r\n                let roomItemTmp = deepCopy(roomItem);\r\n                roomItemTmp.parent = parent;\r\n                setRoomItemNow(roomItemTmp);\r\n                setTaskDialogUpdate(true);\r\n                setDialogAddTaskOpen(true);\r\n              } : () => {\r\n                const tasks = getTargetTasks({ roomItem });\r\n                console.log('got tasks', tasks);\r\n                const parent = periodMap[periodId];\r\n                let roomItemTmp = deepCopy(roomItem);\r\n                roomItemTmp.parent = parent;\r\n                setRoomItemNow(roomItemTmp);\r\n                setDialogTasksListOpen(tasks);\r\n              }} className={classes.planButton}>计划{planCount > 0 ? (`(${planCount})`) : ''}</Link>);\r\n            })()\r\n          }</MyTableCell>);\r\n        }\r\n        if (!notEmpty) break;\r\n        rows.push(row);\r\n        index++;\r\n      }\r\n    }\r\n    return rows.map((v, k) => <TableRow style={{ height: 30 }} key={k}>{v}</TableRow>);\r\n  };\r\n\r\n  if (!setUpdateTimer) {\r\n    setUpdateTimer = true;\r\n    // 每分钟更新数据\r\n    setTimeout(() => {\r\n      if (!updateData) return;\r\n      updateData();\r\n    }, 60 * 1000);\r\n  }\r\n\r\n  const updateData = () => {\r\n    // console.log('updating daemon!');\r\n    if (!requestedDayData) {\r\n      requestedDayData = true;\r\n      api.request(\"daemon\", \"POST\", { daemon_args: { reserve_table: { date } } }).then(resp => {\r\n        if (resp.code !== 200) return;\r\n        store.dispatch(setDaemon(resp.data));\r\n        requestedDayData = false;\r\n        forceUpdate();\r\n      });\r\n    } else {\r\n      let reserveTableData = store.getState().daemon.reserve_table[date];\r\n      // console.log('got from redux:', reserveTableData);\r\n      if (reserveTableData) {\r\n        setDayData(reserveTableData);\r\n        setRoomList(reserveTableData.roomList);\r\n        // 也是要请求一遍的\r\n        api.request(\"daemon\", \"POST\", { daemon_args: { reserve_table: { date } } }).then(resp => {\r\n          if (resp.code !== 200) return;\r\n          store.dispatch(setDaemon(resp.data));\r\n          requestedDayData = false;\r\n          forceUpdate();\r\n        });\r\n      } else {\r\n        // console.warn('got empty reserveTableData', dayData, store.getState().daemon.reserve_table, date, JSON.stringify(store.getState().daemon.reserve_table[date]));\r\n      }\r\n    }\r\n  };\r\n\r\n  const updateTaskData = () => {\r\n    // 更新Task数据\r\n    updateData();\r\n    api.request(\"task\", \"GET\").then(resp => {\r\n      if (resp.code !== 200) return;\r\n      store.dispatch(setTasks(resp.data.tasks));\r\n      setDialogTasksListOpen(null);\r\n      forceUpdate();\r\n    });\r\n  };\r\n\r\n  if (!dayData) {\r\n    updateData();\r\n    return (<Container>\r\n      <LinearProgress></LinearProgress>\r\n    </Container>);\r\n  }\r\n  let tableHeaderCells = [<TableCell key=\"time\" align=\"center\" colSpan={1}>时间</TableCell>,];\r\n  roomList.map((d, i) => {\r\n    tableHeaderCells.push(<TableCell key={'a' + d + i} align=\"center\" colSpan={2}>售卖内容</TableCell>);\r\n    tableHeaderCells.push(<TableCell key={'b' + d + i} align=\"center\" colSpan={1}>库存</TableCell>);\r\n    tableHeaderCells.push(<TableCell key={'c' + d + i} align=\"center\" colSpan={1}>计划</TableCell>);\r\n    // tableHeaderCells.push(<TableCell key={'d' + d + i} align=\"center\" colSpan={1}>临时下线</TableCell>);\r\n  });\r\n  const tableHeader = <TableHead>\r\n    <TableRow>\r\n      <TableCell align=\"center\" colSpan={1}>[{date.slice(date.length - 2, date.length)}日{'周' + [\"日\", '一', '二', '三', '四', '五', '六'][day]}]</TableCell>\r\n      {roomList.map((d, i) =>\r\n        <TableCell align=\"center\" key={i} colSpan={4}>{d.roomName}({d.roomCapacity})</TableCell>\r\n      )}\r\n    </TableRow>\r\n    <TableRow>\r\n      {tableHeaderCells}\r\n    </TableRow>\r\n  </TableHead>;\r\n  if (!dayData || !dayData.periodList) {\r\n    // console.log('no data!', dayData, typeof (dayData));\r\n    return (<Container>\r\n      <header></header>\r\n      <LinearProgress></LinearProgress>\r\n    </Container>);\r\n  }\r\n  // console.log(\"roomItemNow\", roomItemNow);\r\n  return (\r\n    <Container>\r\n      <TableContainer component={Paper}>\r\n        <Table stickyHeader className={classes.table}>\r\n          {tableHeader}\r\n          <TableBody>\r\n            {/* {dayData.periodList.map((d, i) =>\r\n              <Period key={'period' + i} data={d} roomList={roomList}></Period>\r\n            )} */}\r\n            <PeriodTable data={dayData} roomList={roomList}></PeriodTable>\r\n          </TableBody>\r\n        </Table>\r\n      </TableContainer>\r\n      <Dialog open={!!dialogTasksListOpen} onClose={() => { setDialogTasksListOpen(null); }}>\r\n        <DialogTitle>任务列表</DialogTitle>\r\n        <DialogContent>\r\n          {/* {roomItemNow && JSON.stringify(roomItemNow) !== \"{}\" ?  */}\r\n          {dialogTasksListOpen ? <TaskList fullWidth tasks={dialogTasksListOpen}\r\n            // onClick={task => {\r\n            //   console.log('click task', task);\r\n            //   setDialogAddTaskOpen(task);\r\n            // }}\r\n            onUpdate={() => {\r\n              api.request(\"task\", \"GET\").then(resp => {\r\n                if (resp.code !== 200) return;\r\n                store.dispatch(setTasks(resp.data.tasks));\r\n                forceUpdate();\r\n              });\r\n            }}></TaskList> : null\r\n            // <code>{`${console.log(roomItemNow, dialogTasksListOpen)}`}</code>\r\n          }\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button color=\"primary\" onClick={() => {\r\n            setTaskDialogUpdate(true);\r\n            setDialogAddTaskOpen(true);\r\n          }}>添加任务</Button>\r\n          <Button color=\"primary\" onClick={() => { setDialogTasksListOpen(null); }}>取消</Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n      <TaskDialog\r\n        simpleMode\r\n        taskOld={dialogAddTaskOpen}\r\n        addMode={dialogAddTaskOpen === true}\r\n        targets={{ roomItem: roomItemNow, taskName: (roomItemNow && JSON.stringify(roomItemNow) !== \"{}\") ? `${roomItemNow.roomType}周${weekDayList[new Date().getDay()]}${roomItemNow.parent.periodDesc}` : null }}\r\n        open={!!dialogAddTaskOpen && (roomItemNow && JSON.stringify(roomItemNow) !== '{}')}\r\n        onRefresh={() => {\r\n          updateTaskData();\r\n        }}\r\n        onClose={(isOk) => {\r\n          setDialogAddTaskOpen(null);\r\n          if (isOk) updateTaskData();\r\n        }}\r\n        onSave={task => {\r\n          return api.request_key('task', task.tid, \"POST\", { task }).then(resp => {\r\n            // setState({ requestingTasks: false });\r\n            console.log(\"update task done\");\r\n          });\r\n        }}\r\n      ></TaskDialog>\r\n    </Container>\r\n  );\r\n}\r\n\r\nexport default ReserveTable;","import React from 'react'\r\nimport { LinearProgress, Button, Container, Dialog, DialogTitle, IconButton } from '@material-ui/core';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport InputLabel from '@material-ui/core/InputLabel';\r\nimport MenuItem from '@material-ui/core/MenuItem';\r\nimport FormControl from '@material-ui/core/FormControl';\r\nimport Select from '@material-ui/core/Select';\r\nimport PropTypes from 'prop-types';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Tabs from '@material-ui/core/Tabs';\r\nimport Tab from '@material-ui/core/Tab';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Box from '@material-ui/core/Box';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport VisibilityIcon from '@material-ui/icons/Visibility';\r\nimport FullscreenIcon from '@material-ui/icons/Fullscreen';\r\nimport FullscreenExitIcon from '@material-ui/icons/FullscreenExit';\r\nimport ReserveTable from './ReserveTable';\r\nimport { weekDayList } from '../utils/utils';\r\n\r\nfunction TabPanel(props) {\r\n  const { children, value, index, ...other } = props;\r\n\r\n  return (\r\n    <div\r\n      role=\"tabpanel\"\r\n      hidden={value !== index}\r\n      id={`scrollable-auto-tabpanel-${index}`}\r\n      aria-labelledby={`scrollable-auto-tab-${index}`}\r\n      {...other}\r\n    >\r\n      {value === index && (\r\n        <Box>\r\n          {/* <Typography>{children}</Typography> */}\r\n          {children}\r\n        </Box>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nTabPanel.propTypes = {\r\n  children: PropTypes.node,\r\n  index: PropTypes.any.isRequired,\r\n  value: PropTypes.any.isRequired,\r\n};\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    overflowX: 'auto',\r\n    display: 'block',\r\n    width: '100%',\r\n    flexGrow: 1,\r\n    width: '100%',\r\n    backgroundColor: theme.palette.background.paper,\r\n  },\r\n  formControl: {\r\n    margin: theme.spacing(1),\r\n    minWidth: 120,\r\n  },\r\n  selectEmpty: {\r\n    marginTop: theme.spacing(2),\r\n  },\r\n}));\r\n\r\nfunction a11yProps(index) {\r\n  return {\r\n    id: `scrollable-auto-tab-${index}`,\r\n    'aria-controls': `scrollable-auto-tabpanel-${index}`,\r\n  };\r\n}\r\n\r\nexport default function ReserveTables(props) {\r\n  const classes = useStyles();\r\n  const [tabValue, setTableValue] = React.useState(new Date().getDay());\r\n  const [showTable, setShowTable] = React.useState(false);\r\n  const [fullShow, setFullShow] = React.useState(false);\r\n  const handleChange = (event) => {\r\n    setTableValue(event.target.value);\r\n  };\r\n  const table = <div className={classes.root}>\r\n    <Tabs\r\n      value={tabValue}\r\n      onChange={(e, val) => setTableValue(val)}\r\n      indicatorColor=\"primary\"\r\n      textColor=\"primary\"\r\n      variant=\"scrollable\"\r\n      scrollButtons=\"auto\"\r\n      aria-label=\"scrollable auto tabs example\"\r\n    >\r\n      {[\"日\", '一', '二', '三', '四', '五', '六'].map((d, i) => {\r\n        return (<Tab label={'周' + d} key={d} {...a11yProps(i)} />);\r\n      })}\r\n    </Tabs>\r\n    {[0, 1, 2, 3, 4, 5, 6].map((d, i) => <TabPanel key={d} value={tabValue} index={d}>\r\n      <ReserveTable day={tabValue}></ReserveTable>\r\n    </TabPanel>)}\r\n  </div>;\r\n  return (\r\n    // <Container className={classes.root}>\r\n    <div>\r\n      <FormControl className={classes.formControl}>\r\n        <InputLabel>选择日期</InputLabel>\r\n        <Select\r\n          value={tabValue}\r\n          onChange={handleChange}\r\n        >\r\n          {weekDayList.map((d, i) => <MenuItem key={d} value={i}>{'周' + d}</MenuItem>)}\r\n        </Select>\r\n      </FormControl>\r\n      <IconButton style={{ float: 'right' }} variant=\"contained\" onClick={() => {\r\n        setShowTable(true);\r\n        setFullShow(true);\r\n      }}><FullscreenIcon /></IconButton>\r\n      { window.innerWidth >= 600 ? table : <Button fullWidth variant=\"contained\" onClick={() => { setShowTable(!showTable); }}>点击{showTable ? \"隐藏\" : \"显示\"}表格</Button>}\r\n      <Dialog fullScreen={fullShow} onClose={() => { setShowTable(false); }} open={showTable}>\r\n        <DialogTitle>\r\n          <Box component=\"span\">周{weekDayList[tabValue]}({new Date().setDay(tabValue).toDateString()})数据</Box>\r\n          {fullShow ? <IconButton edge=\"end\" style={{ float: 'right' }} onClick={() => {\r\n            setFullShow(false);\r\n            setShowTable(false);\r\n          }}><FullscreenExitIcon /></IconButton> : <IconButton style={{ float: 'right' }} variant=\"contained\" onClick={() => {\r\n            setShowTable(true);\r\n            setFullShow(true);\r\n          }}><FullscreenIcon /></IconButton>}</DialogTitle>\r\n        {table}\r\n      </Dialog>\r\n      {/* </Container > */}\r\n    </div>\r\n  );\r\n\r\n}\r\n\r\n","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport ReserveTables from \"../components/ReserveTables\";\r\nimport { Divider, Table, TableBody, TableCell, TableRow, Typography } from \"@material-ui/core\";\r\nimport store from \"../data/store\";\r\n\r\nclass StateNow extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = store.getState();\r\n    this.unsubscribe = store.subscribe(() => {\r\n      this.setState({\r\n        timetableNodes: store.getState().timetableNodes,\r\n        timetablePeriods: store.getState().timetablePeriods,\r\n        roomStockPlans: store.getState().roomStockPlans\r\n      });\r\n    });\r\n  }\r\n  componentWillUnmount() {\r\n    this.unsubscribe();\r\n  }\r\n  render() {\r\n    return (<Table>\r\n      <TableBody>\r\n        <TableRow>\r\n          <TableCell align=\"center\">任务数量</TableCell>\r\n          <TableCell align=\"center\">LABLE1</TableCell>\r\n          <TableCell align=\"center\">LABLE2</TableCell>\r\n        </TableRow>\r\n        <TableRow>\r\n          <TableCell align=\"center\">{store.getState().tasks.length}个</TableCell>\r\n          <TableCell align=\"center\">VALUE1</TableCell>\r\n          <TableCell align=\"center\">VALUE2</TableCell>\r\n        </TableRow>\r\n      </TableBody>\r\n    </Table>);\r\n  }\r\n}\r\n\r\nfunction Launch() {\r\n  return (<Container style={{ overflowX: 'auto', width: '100%' }}>\r\n    <Typography variant=\"h5\">执行状态</Typography>\r\n    <StateNow></StateNow>\r\n    <br />\r\n    <Typography variant=\"h5\">数据总览</Typography>\r\n    <ReserveTables />\r\n  </Container>);\r\n}\r\n\r\nexport default Launch;","import store from \"../data/store\";\r\n\r\n\r\nclass WebSocketAPI {\r\n  constructor(url) {\r\n    this.connect = this.connect.bind(this);\r\n    this.url = url || store.getState().config.data.remote_login.server || \"ws://127.0.0.1:8081\";\r\n    this.ws = null;\r\n    this.onopen = () => {\r\n      console.log('Connection started');\r\n    };\r\n    this.ondata = e => {\r\n      if (e.cmd === 'code') {\r\n        this.oncode(e.data);\r\n      } else if (e.cmd === 'cookies') {\r\n        this.oncookies(e.data);\r\n      }\r\n    };\r\n    this.onmessage = e => {\r\n      // console.log('onmessage', e);\r\n      this.ondata(JSON.parse(e.data));\r\n    };\r\n    this.onerror = e => {\r\n      console.error(e);\r\n    };\r\n    this.onclose = () => {\r\n      console.log('Connection closed');\r\n    };\r\n    this.oncode = code => { console.log('code', code); }\r\n    this.oncookies = cookies => { console.log('cookies', cookies); }\r\n  }\r\n  connect() {\r\n    this.ws = this.ws || new WebSocket(this.url);\r\n    this.ws.onopen = this.onopen;\r\n    this.ws.onclose = this.onclose;\r\n    this.ws.onerror = this.onerror;\r\n    this.ws.onmessage = this.onmessage;\r\n  }\r\n  close() {\r\n    if (this.ws) this.ws.close();\r\n  }\r\n}\r\n\r\nexport { WebSocketAPI };","import { Box, Button, Container, Paper, Typography } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport Config from \"../Config\";\r\nimport { WebSocketAPI } from '../api/remote_login';\r\nimport { setConfig, setDaemon } from '../data/action';\r\nimport store from '../data/store';\r\nconst QRCode = require('qrcode.react');\r\n\r\nfunction CenterBox(props) {\r\n  const { children, style } = props;\r\n  return <Box style={style ? style : { width: '100%', height: '100%', display: \"flex\", justifyContent: \"center\", flexDirection: \"column\" }}>\r\n    <Box style={{ width: '100%', textAlign: \"center\", display: \"flex\", justifyContent: \"center\", flexDirection: \"column\", alignItems: \"center\" }}>\r\n      {children}\r\n    </Box>\r\n  </Box>;\r\n}\r\n\r\nexport default class RemoteLogin extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.onFinish = props.onFinish;\r\n    this.forceLogin = props.forceLogin;\r\n    this.stateDefault = {\r\n      code: null,\r\n      loginDone: false,\r\n      loginError: null,\r\n    };\r\n    this.state = this.stateDefault;\r\n    this.ws_api = null;\r\n    this.ws_running = false;\r\n    // this.unsubscribe = store.subscribe(async () => {\r\n    //   if (this.loginDone) return;\r\n    //   let state = store.getState();\r\n    //   if (state.daemon) {\r\n    //     this.setState({ loginDone: true });\r\n    //     if (this.ws_api) this.ws_api.close();\r\n    //   }\r\n    // });\r\n    this.run_ws = async () => {\r\n      // debugger;\r\n      this.ws_running = true;\r\n      console.log(store.getState().daemon);\r\n      if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n      const res = await api.request('remote_login', \"PATCH\");\r\n      if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n      const server = res.data.server;\r\n      let config = store.getState().config;\r\n      config.data.remote_login.server = server;\r\n      store.dispatch(setConfig(config));\r\n      if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n      this.ws_api = new WebSocketAPI(server);\r\n      this.ws_api.oncode = code => {\r\n        // console.log('code', code);\r\n        if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n        this.setState({ code });\r\n      };\r\n      this.ws_api.oncookies = async cookies => {\r\n        const resp = await api.request('remote_login', \"POST\", { cookies });\r\n        if (resp.code !== 200) {\r\n          this.setState({ loginDone: true, loginError: resp.message });\r\n          return;\r\n        }\r\n        console.log('done', resp);\r\n        if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n        this.setState({ loginDone: true });\r\n        const daemon = await api.request('remote_login', 'GET');\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        }\r\n        this.onFinish && this.onFinish();\r\n      }\r\n      if (!this.forceLogin && ((store.getState().daemon && store.getState().daemon.cookies) || this.state.loginDone)) { this.ws_running = false; return; }\r\n      this.ws_api.connect();\r\n    };\r\n    setTimeout(this.run_ws, 1000);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.ws_api) this.ws_api.close();\r\n    // this.unsubscribe();\r\n  }\r\n  render() {\r\n    let content = null;\r\n    if (this.state.loginDone) {\r\n      if (!this.state.loginError)\r\n        content = <Paper style={{ width: 200, height: 200 }}>\r\n          <CenterBox>登录完成</CenterBox>\r\n        </Paper>;\r\n      else content = <Paper style={{ width: 200, height: 200 }}>\r\n        <CenterBox>\r\n          <Typography variant=\"body1\">{this.state.loginError}</Typography>\r\n          <Button variant=\"outlined\" color=\"secondary\" onClick={() => {\r\n            try { clearTimeout(this.run_ws); } catch (e) { console.error(e); }\r\n            this.setState(this.stateDefault);\r\n            try { if (this.ws_api) this.ws_api.connect(); } catch (e) { console.error(e); }\r\n            this.ws_api = null;\r\n            this.ws_running = false;\r\n            setTimeout(this.run_ws, 1000);\r\n          }}>重试</Button>\r\n        </CenterBox>\r\n      </Paper>;\r\n    } else {\r\n      content = this.state.code ? <QRCode value={JSON.stringify(this.state.code)} size={200} /> :\r\n        <Paper style={{ width: 200, height: 200 }}>\r\n          <CenterBox>正在加载二维码...</CenterBox>\r\n        </Paper>;\r\n    }\r\n    return (<Container maxWidth=\"xs\" style={{ height: window.innerHeight * 0.6 }}>\r\n      <CenterBox>\r\n        <Typography variant=\"h5\">扫码登录以继续</Typography>\r\n        <br></br>\r\n        {content}\r\n        <br></br>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">请使用美团开店宝/点评管家扫码登录</Typography>\r\n        <Typography variant=\"body2\" color=\"textSecondary\">点击软件右下角\"我的\"→右上角扫码图标</Typography>\r\n        <br></br>\r\n        <Button fullWidth onClick={() => {\r\n          Config.clear();\r\n          setTimeout(() => { window.location.reload(); }, 500);\r\n        }}>退出当前账号</Button>\r\n      </CenterBox>\r\n    </Container>);\r\n  }\r\n}","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport { Button, MenuItem, FormControl, InputLabel, List, ListItem, ListItemSecondaryAction, ListItemText, Select, ListSubheader, Switch, Dialog, DialogTitle, DialogContent, Typography, DialogActions, Box, IconButton, DialogContentText } from \"@material-ui/core\";\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport store from \"../data/store\";\r\nimport { setConfig, setErrorInfo, setMessage } from \"../data/action\";\r\nimport { funDownload } from \"../utils/utils\";\r\nimport ListInfo from \"../components/ListInfo\";\r\nimport { api } from \"../api/api\";\r\nimport Config from \"../Config\";\r\nimport RemoteLogin from \"./RemoteLogin\";\r\n\r\nfunction Settings(props) {\r\n  const [themeName, setThemeName] = React.useState(store.getState().config.data.theme_name);\r\n  const refConfigFileInput = React.useRef();\r\n  const [resetSettingsOpen, setResetSettingsOpen] = React.useState(false);\r\n  const [deleteDataOpen, setDeleteDataOpen] = React.useState(false);\r\n  const [openDaemon, setOpenDaemon] = React.useState(false);\r\n  const [openUser, setOpenUser] = React.useState(false);\r\n  const [openResetShop, setOpenResetShop] = React.useState(false);\r\n  const [openSelectShop, setOpenSelectShop] = React.useState(false);\r\n  const [openNewShop, setOpenNewShop] = React.useState(false);\r\n\r\n  const resetSettings = function () {\r\n    let c = store.getState().config;\r\n    c.data = c.data_default;\r\n    c.save();\r\n    c.load();\r\n    store.dispatch(setConfig(c));\r\n  }\r\n\r\n  const user = store.getState().user;\r\n\r\n  return (<Container maxWidth=\"md\">\r\n    <List>\r\n      <ListSubheader>用户账号</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"用户名\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          {user.username}\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenUser(true); }}>\r\n        <ListItemText primary=\"详细信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button>\r\n        <ListItemText primary=\"修改信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        Config.clear();\r\n        setTimeout(() => { window.location.reload(); }, 500);\r\n      }}>\r\n        <ListItemText primary=\"退出当前账号\"></ListItemText>\r\n      </ListItem>\r\n      <ListSubheader>用户门店</ListSubheader>\r\n      <ListItem button onClick={() => { setOpenDaemon(true); }}>\r\n        <ListItemText primary=\"当前门店信息\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenResetShop(true); }}>\r\n        <ListItemText primary=\"解绑当前门店\"></ListItemText>\r\n        <ListItemSecondaryAction><Typography variant=\"body1\" color=\"textSecondary\">{store.getState().daemon &&\r\n          store.getState().daemon.shop_info && store.getState().daemon.shop_info.branchName}</Typography></ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenSelectShop(true); }}>\r\n        <ListItemText primary=\"管理/切换当前已绑定门店\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => { setOpenNewShop(true); }}>\r\n        <ListItemText primary=\"绑定并且切换到新的门店\"></ListItemText>\r\n      </ListItem>\r\n      <ListSubheader>外观</ListSubheader>\r\n      <ListItem>\r\n        <ListItemText primary=\"主题设置\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <FormControl>\r\n            {/* <InputLabel></InputLabel> */}\r\n            <Select value={themeName} onChange={e => {\r\n              setThemeName(e.target.value);\r\n              let c = store.getState().config;\r\n              c.data.theme_name = e.target.value;\r\n              c.theme = c.theme_avaliable[c.data.theme_name];\r\n              c.save();\r\n              store.dispatch(setConfig(c));\r\n              setTimeout(() => { window.location.reload(); }, 200);\r\n            }}>\r\n              {store.getState().config.data.theme_avaliable.map((v, k) => <MenuItem key={v} value={v}>{v}</MenuItem>)}\r\n            </Select>\r\n          </FormControl>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListSubheader>数据管理</ListSubheader>\r\n      <ListItem button onClick={() => {\r\n        funDownload(store.getState().config.save(), `团购杀手配置数据(${new Date().toLocaleString()}).json`);\r\n      }}>\r\n        <ListItemText primary=\"数据导出\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => {\r\n        // console.log(refConfigFileInput)\r\n        refConfigFileInput.current.click();\r\n      }}>\r\n        <ListItemText primary=\"数据导入\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <input type=\"file\" accept=\".json\" hidden name=\"file-gbk-data\" ref={refConfigFileInput} onChange={e => {\r\n            // console.log(e);\r\n            let files = e.target.files;\r\n            if (files.length === 0) {\r\n              store.dispatch(setMessage(\"未选择文件\"));\r\n              return;\r\n            }\r\n            try {\r\n              let file = files[0];\r\n              let reader = new FileReader();\r\n              reader.readAsText(file, 'UTF-8');\r\n              reader.onload = evt => {\r\n                const fileData = evt.target.result;\r\n                try {\r\n                  const js = JSON.parse(fileData);\r\n                  if (!js.version_frontend) {\r\n                    store.dispatch(setMessage(\"文件类型错误或者文件已经损坏\"));\r\n                    return;\r\n                  }\r\n                  if (js.version_frontend > store.getState().config.data.version_frontend) {\r\n                    store.dispatch(setMessage(`存档文件版本(${js.version_frontend}高于当前版本${store.getState().config.data.version_frontend})，请更新到最新版`));\r\n                    return;\r\n                  }\r\n                  let c = store.getState().config;\r\n                  c.data = js;\r\n                  store.dispatch(setConfig(c));\r\n                  store.dispatch(setMessage(\"数据导入完成\"));\r\n                } catch (e) {\r\n                  store.dispatch(setErrorInfo(e));\r\n                }\r\n              };\r\n            } catch (e) {\r\n              store.dispatch(setErrorInfo(e));\r\n            }\r\n          }}></input>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem>\r\n        <ListItemText primary=\"设置数据同步\"></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <Switch defaultChecked={store.getState().config.data.settings_async} onChange={e => {\r\n            let c = store.getState().config;\r\n            c.data.settings_async = e.target.checked;\r\n            c.save();\r\n            store.dispatch(setConfig(c));\r\n          }}></Switch>\r\n        </ListItemSecondaryAction>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setResetSettingsOpen(true)}>\r\n        <ListItemText primary=\"回到默认设置\"></ListItemText>\r\n      </ListItem>\r\n      <ListItem button onClick={() => setDeleteDataOpen(true)}>\r\n        <ListItemText primary=\"删除所有数据\"></ListItemText>\r\n      </ListItem>\r\n    </List>\r\n    <ListInfo data={store.getState().user} open={openUser} keyNames={{\r\n      username: '用户名', nick: '昵称', phone: '用户手机号', profile: '详细信息', state: '用户状态', created_at: '创建于', updated_at: '更新于'\r\n    }} title=\"用户信息\" onClose={() => { setOpenUser(false); }}></ListInfo>\r\n    <ListInfo data={store.getState().daemon} open={openDaemon} keyNames={{\r\n      cookies: '远程登录凭据', shop_info: \"门店详细信息\", solution_id: \"解决方案编号\"\r\n    }} title=\"门店信息\" onClose={() => { setOpenDaemon(false); }}></ListInfo>\r\n    <Dialog open={resetSettingsOpen} onClose={() => setResetSettingsOpen(false)}>\r\n      <DialogTitle>\r\n        回到默认设置\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除所有设置数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setResetSettingsOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={deleteDataOpen} onClose={() => setDeleteDataOpen(false)}>\r\n      <DialogTitle>\r\n        删除所有数据\r\n      </DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会清除软件数据，确认操作？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => setDeleteDataOpen(false)}>取消</Button>\r\n        <Button onClick={() => {\r\n          resetSettings();\r\n          window.location.reload();\r\n        }}>确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={openResetShop} onClose={() => { setOpenResetShop(false); }}>\r\n      <DialogTitle>解绑当前门店</DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"body1\">此操作将会解除门店和<b>本网站</b>的数据绑定，需要<b>重新绑定</b>才能使用网站功能。是否继续？</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button onClick={() => { setOpenResetShop(false); }}>取消</Button>\r\n        <Button onClick={async () => {\r\n          const resp = await api.request(\"remote_login\", \"DELETE\");\r\n          console.log('delete cookies:', resp);\r\n          if (resp.code !== 200) store.dispatch(setErrorInfo(`删除失败: ${resp.code}, ${resp.message}, ${resp.error}`));\r\n          // setOpenResetShop(false);\r\n          window.location.reload();\r\n        }} color=\"secondary\">确定</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n    <Dialog open={openSelectShop} onClose={() => { setOpenSelectShop(false); }}>\r\n      <DialogTitle>选择一家门店</DialogTitle>\r\n      <DialogContent>\r\n        <List>\r\n          <ListItem>\r\n            <Typography variant=\"body2\" color=\"textSecondary\">注意，切换门店之后原有门店计划将停止执行。</Typography>\r\n          </ListItem>\r\n          {store.getState().daemon.shops ?\r\n            Object.keys(store.getState().daemon.shops).map((v, k) => {\r\n              const d = store.getState().daemon.shops[v];\r\n              return <ListItem button key={v} onClick={async () => {\r\n                console.log('switching to', d);\r\n                if (!d.cookies) return;\r\n                await api.request('remote_login', \"POST\", { cookies: d.cookies });\r\n                setOpenSelectShop(false);\r\n              }}>\r\n                <Box style={{ display: 'flex', flexDirection: \"row\" }}>\r\n                  <Box style={{ display: 'flex', flexDirection: \"column\" }}>\r\n                    <Typography variant=\"body1\">{`${d.shopName} - ${d.branchName}`}</Typography>\r\n                    <Typography variant=\"body2\" color=\"textSecondary\">{`${d.shopId}`}</Typography>\r\n                  </Box>\r\n                </Box>\r\n                <ListItemSecondaryAction>\r\n                  <IconButton onClick={async () => {\r\n                    console.log('to delete:', d);\r\n                    await api.request(\"remote_login\", \"DELETE\", { shop_id: d.shopId });\r\n                    if (store.getState().daemon.shop_info && d.shopId === store.getState().daemon.shop_info.shopId) window.location.reload();\r\n                  }}>\r\n                    <DeleteIcon></DeleteIcon>\r\n                  </IconButton>\r\n                </ListItemSecondaryAction>\r\n              </ListItem>;\r\n            })\r\n            : <ListItem><ListItemText>无门店数据</ListItemText></ListItem>}\r\n        </List>\r\n      </DialogContent>\r\n    </Dialog>\r\n    <Dialog open={openNewShop} onClose={() => { setOpenNewShop(false); }}>\r\n      <DialogContent>\r\n        <RemoteLogin forceLogin onFinish={() => {\r\n          console.log('onFinish');\r\n          setTimeout(() => { window.location.reload(); }, 3000);\r\n        }}></RemoteLogin>\r\n      </DialogContent>\r\n    </Dialog>\r\n  </Container>)\r\n}\r\n\r\nexport default Settings;","import { Box, Button, Container, Divider, TextField, Typography, Zoom, Fade } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport { setMessage, setUser } from '../data/action';\r\nimport store from '../data/store';\r\nimport { objectUpdate } from '../utils/utils';\r\n\r\n\r\nfunction LoginFrame(props) {\r\n  const [state, setInnerState] = React.useState({\r\n    username: \"\",\r\n    password: \"\",\r\n    captcha: \"\",\r\n    actionType: 'login'\r\n  });\r\n  const refUsername = React.useRef();\r\n  const refPassword = React.useRef();\r\n  const setState = (update) => setInnerState(objectUpdate(state, update));\r\n  // style={{ display: \"flex\", justifyContent: 'center', alignItems: \"center\", flexDirection: \"column\", }}\r\n  const actionLogin = state.actionType === 'login' ? true : false;\r\n  const handleAction = async () => {\r\n    // console.log('handle', actionLogin);\r\n    if (actionLogin) {\r\n      const res = await api.request('session', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code !== 200) return;\r\n      // 获取user\r\n      const user = await api.request('user', 'GET');\r\n      if (user.code !== 200) return;\r\n      console.log('user', user.data.user);\r\n      store.dispatch(setUser(user.data.user));\r\n    } else {\r\n      // 注册，注册成功则跳转登录\r\n      const res = await api.request('user', 'POST', {\r\n        username: state.username, password: state.password\r\n      });\r\n      console.log(res);\r\n      if (res.code === 200) {\r\n        // 弹窗\r\n        store.dispatch(setMessage(\"注册成功\"));\r\n        setState({actionType: 'login'});\r\n      }\r\n    }\r\n  }\r\n\r\n  return (<Box>\r\n    <Typography variant=\"h4\">{actionLogin ? \"登录\" : \"注册\"}</Typography>\r\n    <br />\r\n    <Divider></Divider>\r\n    <br />\r\n    <TextField fullWidth ref={refUsername} label=\"用户名\" variant=\"outlined\" value={state.username} onChange={e => {\r\n      setState({ username: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        refPassword.current.querySelector(\"input\").focus();\r\n      }\r\n    }} />\r\n    <br /><br />\r\n    <TextField fullWidth ref={refPassword} label=\"密码\" variant=\"outlined\" value={state.password} type=\"password\" onChange={e => {\r\n      setState({ password: e.target.value });\r\n    }} onKeyDown={e => {\r\n      if (e.code === \"Enter\") {\r\n        handleAction();\r\n      }\r\n    }} />\r\n    <Fade in={actionLogin} style={{ display: actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>登录</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={() => setState({ actionType: \"sign_in\" })}>注册</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n    <Fade in={!actionLogin} style={{ display: !actionLogin ? \"block\" : \"none\" }} timeout={{ exit: 0, enter: 200 }}>\r\n      <Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" color=\"primary\" onClick={handleAction}>注册</Button>\r\n        </Box>\r\n        <Box>\r\n          <br></br>\r\n          <Button fullWidth variant=\"contained\" onClick={() => setState({ actionType: 'login' })}>返回登录</Button>\r\n        </Box>\r\n      </Box>\r\n    </Fade>\r\n  </Box >);\r\n}\r\n\r\nexport default function Login(props) {\r\n  return <Container maxWidth=\"sm\">\r\n    <LoginFrame></LoginFrame>\r\n  </Container>\r\n}","import React from \"react\"\r\nimport Container from '@material-ui/core/Container';\r\nimport { Button, MenuItem, FormControl, InputLabel, List, ListItem, ListItemSecondaryAction, ListItemText, Select, ListSubheader, Switch, Dialog, DialogTitle, DialogContent, Typography, DialogActions, FormControlLabel, Checkbox, Divider, Box, Grid, TextField, IconButton } from \"@material-ui/core\";\r\nimport { Table, TableBody, TableCell, TableRow } from \"@material-ui/core\";\r\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline';\r\nimport store from \"../data/store\";\r\nimport { setConfig, setErrorInfo, setMessage } from \"../data/action\";\r\nimport { api } from \"../api/api\";\r\n\r\nfunction Predicts(props) {\r\n  const [useSpan, setUseSpan] = React.useState(false);\r\n  const [openHelp, setOpenHelp] = React.useState(false);\r\n  const labels = ['小包最低价', '小包最高价', '中包最低价', '中包最高价', '大包最低价', '大包最高价'];\r\n  const labelShows = { '小包最低价': '小包(闲时)', '小包最高价': '小包(黄金时段)', '中包最低价': '中包(闲时)', '中包最高价': '中包(黄金时段)', '大包最低价': '大包(闲时)', '大包最高价': '大包(黄金时段)' };\r\n  const [predictsResult, setPredictsResult] = React.useState(null);\r\n  const defaultValues = [\r\n    ['66', '76'], ['76', '86'], ['86', '96'], ['96', '106'], ['116', '126'], ['126', '146']\r\n  ]\r\n  const labelsTemp = labels.map((v, k) => {\r\n    return { [v]: defaultValues[k] };\r\n  });\r\n  const labelValues = ((() => {\r\n    let temp = {};\r\n    for (const item of labelsTemp)\r\n      for (const k in item)\r\n        temp[k] = item[k];\r\n    return temp;\r\n  })());\r\n  // console.log(labelValues);\r\n  const [inputValues, setInputValues] = React.useState(labelValues);\r\n  const getTempValues = () => {\r\n    let tempValues = {};\r\n    for (const k in inputValues) tempValues[k] = inputValues[k];\r\n    return tempValues;\r\n  }\r\n\r\n  const items = labels.map((v, k) => {\r\n    return useSpan ?\r\n      <ListItem key={v}>\r\n        <ListItemText primary={labelShows[v]}></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <Box>\r\n            <TextField style={{ maxWidth: 40 }} inputProps={{ style: { textAlign: \"center\" } }} value={inputValues[v][0]} onChange={e => {\r\n              let tmp = getTempValues();\r\n              tmp[v][0] = e.target.value;\r\n              setInputValues(tmp);\r\n            }}></TextField>~\r\n            <TextField style={{ maxWidth: 40 }} inputProps={{ style: { textAlign: \"center\" } }} value={inputValues[v][1]} onChange={e => {\r\n              let tmp = getTempValues();\r\n              tmp[v][1] = e.target.value;\r\n              setInputValues(tmp);\r\n            }}></TextField>\r\n          </Box>\r\n        </ListItemSecondaryAction>\r\n      </ListItem> :\r\n      <ListItem key={v}>\r\n        <ListItemText primary={labelShows[v]}></ListItemText>\r\n        <ListItemSecondaryAction>\r\n          <TextField style={{ maxWidth: 90 }} inputProps={{ style: { textAlign: \"center\" } }} fullWidth value={inputValues[v][0]} onChange={e => {\r\n            let tmp = getTempValues();\r\n            tmp[v][0] = e.target.value;\r\n            setInputValues(tmp);\r\n          }}></TextField>\r\n        </ListItemSecondaryAction>\r\n      </ListItem >;\r\n  });\r\n  const content = <List>\r\n    {items}\r\n  </List>;\r\n  const handlePredicts = () => {\r\n    // 检查数据\r\n    let tempValues = getTempValues();\r\n    if (!useSpan)\r\n      for (const k in tempValues)\r\n        tempValues[k] = [tempValues[k][0],]\r\n    for (const k in tempValues) {\r\n      for (let i = 0; i < tempValues[k].length; i++) {\r\n        let val = null;\r\n        try {\r\n          val = parseFloat(tempValues[k][i]);\r\n        } catch (e) {\r\n          store.dispatch(setErrorInfo(`数值错误: ${tempValues[k][i]}, ${e}`));\r\n          return;\r\n        }\r\n        if (!val && val !== 0) {\r\n          store.dispatch(setErrorInfo(`数值错误: ${tempValues[k][i]}`));\r\n          return;\r\n        }\r\n        tempValues[k][i] = val;\r\n      }\r\n    }\r\n    console.log(JSON.stringify(tempValues));\r\n    // api.predicts(tempValues).then(d => {\r\n    //   console.log(d);\r\n    //   setPredictsResult(d.data);\r\n    // });\r\n    api.request(\"predicts\", 'POST', { predict_data: tempValues }).then(d => {\r\n      console.log(d);\r\n      setPredictsResult(d.data);\r\n    });\r\n  };\r\n  const result = !predictsResult ? null : <Table>\r\n    <TableBody>\r\n      {useSpan ? <TableRow>\r\n        <TableCell align=\"center\" colSpan={2}>预测曝光人数</TableCell>\r\n        <TableCell align=\"center\" colSpan={2}>预测访问人数</TableCell>\r\n        <TableCell align=\"center\" colSpan={2}>预测下单人数</TableCell>\r\n      </TableRow> : <TableRow>\r\n        <TableCell align=\"center\">预测曝光人数</TableCell>\r\n        <TableCell align=\"center\">预测访问人数</TableCell>\r\n        <TableCell align=\"center\">预测下单人数</TableCell>\r\n      </TableRow>}\r\n      {useSpan ? <TableRow>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][1])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][1])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][1])}</TableCell>\r\n      </TableRow> : <TableRow>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visible'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['visit'][0])}</TableCell>\r\n        <TableCell align=\"center\">{parseInt(predictsResult['order'][0])}</TableCell>\r\n      </TableRow>}\r\n    </TableBody>\r\n  </Table>;\r\n  return (<Container maxWidth=\"sm\">\r\n    <Typography variant=\"h4\">根据标准数据集预测</Typography>\r\n    <Box>\r\n      <FormControlLabel control={<Checkbox onChange={e => {\r\n        setUseSpan(e.target.checked);\r\n        setPredictsResult(null);\r\n      }} checked={useSpan} color=\"secondary\" />} label=\"使用数据区间\" />\r\n      <IconButton onClick={() => setOpenHelp(true)}>\r\n        <HelpOutlineIcon></HelpOutlineIcon>\r\n      </IconButton>\r\n    </Box>\r\n    <Divider></Divider>\r\n    {content}\r\n    <Button fullWidth variant=\"contained\" color=\"secondary\" onClick={handlePredicts}>预测</Button>\r\n    <Divider></Divider>\r\n    {result}\r\n    <Dialog open={openHelp} onClose={() => { setOpenHelp(false); }}>\r\n      <DialogTitle>帮助信息</DialogTitle>\r\n      <DialogContent>\r\n        <Typography variant=\"h6\">使用数据区间</Typography>\r\n        <Typography variant=\"body1\">使用数据区间可以输入数据上下限，并且预测出对应参数的上下限，帮助您更好地界定您的数据。</Typography>\r\n        <Typography variant=\"h6\">价格说明</Typography>\r\n        <Typography variant=\"body1\">“黄金时段”价格为节假日、夜间等适合高定价的时段，“闲时”为除此之外的时段。输入价格为不加入酒水等的基础价格。</Typography>\r\n        <Typography variant=\"h6\">预测结果说明</Typography>\r\n        <Typography variant=\"body1\">预测结果基于当前已有数据集数据，预测准确性不能百分百保证。更新数据集等功能将在后续版本上线。</Typography>\r\n      </DialogContent>\r\n      <DialogActions>\r\n        <Button color=\"primary\" onClick={() => { setOpenHelp(false); }}>了解</Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  </Container>)\r\n}\r\n\r\nexport default Predicts;","import { Box, Button, Container, Divider, TextField, Typography, Zoom, Fade, Avatar, List } from '@material-ui/core';\r\nimport React from 'react';\r\nimport { api } from '../api/api';\r\nimport { setMessage, setUser } from '../data/action';\r\nimport { makeStyles } from \"@material-ui/core/styles\";\r\nimport store from '../data/store';\r\nimport {\r\n  HashRouter as Router,\r\n  // BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from \"react-router-dom\";\r\nimport { isChinese, objectUpdate } from '../utils/utils';\r\nimport ListItemLink from '../components/ListItemLink';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  small: {\r\n    width: theme.spacing(3),\r\n    height: theme.spacing(3),\r\n  },\r\n  large: {\r\n    width: theme.spacing(7),\r\n    height: theme.spacing(7),\r\n  },\r\n}));\r\n\r\nexport default function User(props) {\r\n  const { onClose } = props;\r\n  const classes = useStyles();\r\n  const user = store.getState().user;\r\n  const nick = user.nick ? user.nick : user.username;\r\n  const nickHead = isChinese(nick[0]) ? null : `${nick}`.slice(0, 2);\r\n  return <Container maxWidth=\"sm\">\r\n    <Box style={{ display: 'flex', flexDirection: \"row\", minWidth: 90 }}>\r\n      <Box style={{ margin: 15 }}>\r\n        <Avatar alt={nick} className={classes.large}>{nickHead ? nickHead : nick[0]}</Avatar>\r\n      </Box>\r\n      <Box style={{ margin: 8 }}>\r\n        <Typography variant=\"h4\">{nick}</Typography>\r\n        {user.username ? <Typography variant=\"body1\">@{user.username}</Typography> : null}\r\n      </Box>\r\n      <Box style={{ margin: 10 }}>\r\n        <Typography variant=\"h5\">{`${store.getState().daemon.shop_info.shopName}`}</Typography>\r\n        <Typography variant=\"body1\" color=\"textSecondary\">{`${store.getState().daemon.shop_info.branchName}`}</Typography>\r\n      </Box>\r\n    </Box>\r\n    {/* <Button fullWidth color=\"primary\">跳转到设置</Button> */}\r\n    <Router>\r\n      <List>\r\n        <ListItemLink to=\"/settings\" primary=\"跳转到设置\" onClick={() => { onClose && onClose(); }} />\r\n      </List>\r\n    </Router>\r\n  </Container>;\r\n}","import React from 'react';\r\nimport { api } from './api/api';\r\n\r\nexport default class ErrorBoundary extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      error: null,\r\n      requesting: false,\r\n      requested: false,\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error, info) {\r\n    this.setState({ error: { error, info }, requesting: true });\r\n    // logErrorToMyService(error, info);\r\n    console.error('catched error', error);\r\n    console.error('catched info', info);\r\n    api.request('error_report', 'POST', { error: { error, info } }).then(resp => {\r\n      this.setState({ requested: true });\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if (this.state.error) {\r\n      const content = (this.state.requesting && !this.state.requested) ?\r\n        <div style={{ color: 'orange' }}>正在收集数据并且上报开发者...</div> :\r\n        <div style={{ color: 'green' }}>错误数据上报完成！</div>;\r\n      return <div>\r\n        <b><h3>很抱歉</h3></b>\r\n        <p>页面崩溃了！</p>\r\n        <hr />\r\n        {content}\r\n        <p>对您造成的困扰我们表示抱歉，如果有其他需要解决的问题，请联系：</p>\r\n        <p>管理微信：<code>zhicheng1840</code> / 开发者邮箱：<a href=\"mailto:chiro2001@163.com\">chiro2001@163.com</a> / 开发者微信：chiro2001</p>\r\n        <hr></hr>\r\n        <p>详细错误：</p>\r\n        <code>{JSON.stringify(this.state.error)}</code>\r\n      </div>;\r\n    }\r\n    return this.props.children;\r\n  }\r\n}","import React from 'react';\r\nimport \"@fontsource/roboto\";\r\nimport clsx from 'clsx';\r\nimport Container from '@material-ui/core/Container';\r\nimport { makeStyles, useTheme, ThemeProvider } from '@material-ui/core/styles';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport List from '@material-ui/core/List';\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport AccountCircleIcon from '@material-ui/icons/AccountCircle';\r\nimport EqualizerIcon from '@material-ui/icons/Equalizer';\r\nimport DashboardIcon from '@material-ui/icons/Dashboard';\r\nimport AssignmentIcon from '@material-ui/icons/Assignment';\r\nimport AlarmIcon from '@material-ui/icons/Alarm';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport StorageIcon from '@material-ui/icons/Storage';\r\nimport VerifiedUserIcon from '@material-ui/icons/VerifiedUser';\r\nimport PhonelinkIcon from '@material-ui/icons/Phonelink';\r\nimport {\r\n  HashRouter as Router,\r\n  // BrowserRouter as Router,\r\n  Switch,\r\n  Route\r\n} from \"react-router-dom\";\r\nimport { TransitionGroup, CSSTransition } from \"react-transition-group\";\r\nimport { Provider } from 'react-redux'\r\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers';\r\nimport MomentUtils from '@date-io/moment';\r\nimport moment from 'moment';\r\nimport 'moment/locale/zh-cn';\r\nimport store from './data/store';\r\nimport { setConfig, setDaemon, setErrorInfo, setMessage, setReserveTableData, setRoomStockData, setShopInfo } from \"./data/action\";\r\n\r\nimport { isIterator, isMobileDevice, sleep } from \"./utils/utils\";\r\nimport { api } from \"./api/api\";\r\n\r\nimport ListItemLink from \"./components/ListItemLink\";\r\nimport Launch from \"./pages/Launch\";\r\nimport Settings from \"./pages/Settings\";\r\nimport './App.css';\r\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogTitle, ListItem, Snackbar } from '@material-ui/core';\r\nimport RemoteLogin from './pages/RemoteLogin';\r\nimport Login from './pages/Login';\r\nimport Tasks from \"./pages/Tasks\";\r\nimport Predicts from './pages/Predicts';\r\nimport User from './pages/User';\r\nimport ErrorBoundary from './ErrorBondary';\r\n\r\nconst drawerWidth = 240;\r\nmoment.locale('zh-cn');\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: 'flex',\r\n    width: '100%',\r\n    // overflowX: 'auto',\r\n  },\r\n  appBar: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n  title: {\r\n    flexGrow: 1\r\n  },\r\n  appBarShift: {\r\n    marginLeft: drawerWidth,\r\n    width: `calc(100% - ${drawerWidth}px)`,\r\n    transition: theme.transitions.create(['width', 'margin'], {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  menuButton: {\r\n    marginRight: 36,\r\n  },\r\n  hide: {\r\n    display: 'none',\r\n  },\r\n  drawer: {\r\n    width: drawerWidth,\r\n    flexShrink: 0,\r\n    whiteSpace: 'nowrap',\r\n  },\r\n  drawerOpen: {\r\n    width: drawerWidth,\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n  },\r\n  drawerClose: {\r\n    transition: theme.transitions.create('width', {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n    overflowX: 'hidden',\r\n    width: theme.spacing(7) + 1,\r\n    [theme.breakpoints.up('sm')]: {\r\n      width: theme.spacing(9),\r\n    },\r\n  },\r\n  toolbar: {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    justifyContent: 'flex-end',\r\n    padding: theme.spacing(0, 1),\r\n    // necessary for content to be below app bar\r\n    ...theme.mixins.toolbar,\r\n  },\r\n  content: {\r\n    flexGrow: 1,\r\n    padding: theme.spacing(3),\r\n    width: '100%',\r\n    overflowX: 'auto',\r\n  },\r\n}));\r\n\r\n// const api = new API();\r\n// const authApi = new AuthAPI();\r\n// api.get_shop_info().then(shopInfo => {\r\n//   console.log('shopInfo', shopInfo);\r\n//   if (shopInfo) store.dispatch(setShopInfo(shopInfo));\r\n// }).catch(e => {\r\n//   store.dispatch(setErrorInfo(e));\r\n// })\r\n\r\nlet subscribers = {};\r\n\r\nlet last_data = {\r\n  config: null,\r\n  user: null,\r\n  daemon: null\r\n};\r\n\r\nstore.subscribe(async () => {\r\n  let state = store.getState();\r\n  // console.log('redux update to', state);\r\n  // 保存 config\r\n  if (state.config.data) {\r\n    if (JSON.stringify(state.config.data) !== JSON.stringify(last_data.config)) {\r\n      // console.log('Config will change:', state.config.data);\r\n      state.config.save();\r\n      if (store.getState().user && store.getState().config.data.settings_async) {\r\n        await api.request('sync', 'POST', { config: state.config.data });\r\n      }\r\n    } else {\r\n      // console.log('Not change:', state.config.data);\r\n    }\r\n    last_data.config = state.config.data;\r\n  }\r\n  for (let subFunc in subscribers) {\r\n    subscribers[subFunc](state);\r\n  }\r\n});\r\n\r\nconst getShopTitle = function () {\r\n  if (!(store.getState().daemon && store.getState().daemon.shop_info && store.getState().daemon.shop_info.shopName)) return null;\r\n  // console.log('getShopTitle', store.getState().daemon.shop_info);\r\n  const title = `${store.getState().daemon.shop_info.shopName} - ${store.getState().daemon.shop_info.branchName}`;\r\n  // console.log(title);\r\n  return title;\r\n}\r\n\r\nexport default function App() {\r\n  const classes = useStyles();\r\n  const theme = useTheme();\r\n  const [open, setOpen] = React.useState(false);\r\n  const [errorDialogInfo, setErrorDialogInfo] = React.useState(false);\r\n  const [myMessage, setMyMessage] = React.useState(null);\r\n  const [hasLogin, setHasLogin] = React.useState(false);\r\n  const titleDefault = \"团购杀手 - KTV体验版\";\r\n  const [title, setTitle] = React.useState(getShopTitle() || titleDefault);\r\n  const [ignored, forceUpdate] = React.useReducer(x => x + 1, 0);\r\n  const [requestingRemote, setRequesingRemote] = React.useState(false);\r\n  const [openUser, setOpenUser] = React.useState(false);\r\n\r\n  // 拉大到800会打开，拉小到600关闭\r\n  const triggerWidthOpen = 800;\r\n  const triggerWidthClose = 600;\r\n\r\n  // 注册一个当遇到错误的时候调用的钩子吧，用来显示错误信息\r\n  subscribers['Error'] = function (state) {\r\n    if (state.errorInfo) {\r\n      console.log('Error Hook: ', state.errorInfo);\r\n      setErrorDialogInfo(state.errorInfo);\r\n      // 清空错误信息\r\n      store.dispatch(setErrorInfo(null));\r\n    }\r\n  };\r\n  // 注册一个消息钩子\r\n  subscribers['Message'] = function (state) {\r\n    if (state.message) {\r\n      console.log('message: ', state.message);\r\n      setMyMessage(state.message);\r\n      store.dispatch(setMessage(null));\r\n    }\r\n  };\r\n  subscribers['User'] = async function (state) {\r\n    if (state.user) {\r\n      if (JSON.stringify(state.user) != JSON.stringify(last_data.user)) {\r\n        forceUpdate();\r\n        // 登录信息完成，触发获取daemon\r\n        // if (!last_data.user) \r\n        if (!last_data.user) {\r\n          // store.dispatch(setDaemon(false));\r\n          // console.log('trigger');\r\n        }\r\n      }\r\n      last_data.user = state.user;\r\n    }\r\n  };\r\n  subscribers['Daemon'] = async function (state) {\r\n    if (state.daemon) {\r\n      if (JSON.stringify(state.daemon) != JSON.stringify(last_data.daemon)) {\r\n        forceUpdate();\r\n      }\r\n      last_data.daemon = state.daemon;\r\n      if (state.daemon.shop_info) {\r\n        if (title === titleDefault) {\r\n          setTitle(getShopTitle());\r\n        }\r\n      }\r\n    }\r\n    // if (state.daemon === false) {\r\n    //   store.dispatch(setDaemon(null));\r\n    //   const daemon = await api.request('daemon', 'GET');\r\n    //   if (daemon.code === 200 && daemon.data.uid) {\r\n    //     store.dispatch(setDaemon(daemon.data));\r\n    //   } else store.dispatch(setDaemon(null));\r\n    // }\r\n  };\r\n  // onMount & onUpdate\r\n  React.useEffect(() => {\r\n    const onWindowResize = () => {\r\n      let width = window.innerWidth;\r\n      // console.log(width);\r\n      if (!open && width >= triggerWidthOpen) setOpen(true);\r\n      if (open && width <= triggerWidthClose) setOpen(false);\r\n    };\r\n    window.addEventListener(\"load\", onWindowResize);\r\n    window.addEventListener('resize', onWindowResize);\r\n\r\n    return () => {\r\n      window.removeEventListener(\"load\", onWindowResize);\r\n      window.removeEventListener(\"resize\", onWindowResize);\r\n    };\r\n  });\r\n\r\n\r\n  const handleClickAction = () => {\r\n    if (window.innerWidth < 600 || window.location.pathname === '/') {\r\n      setOpen(false);\r\n    }\r\n  };\r\n\r\n  const mainContent = <Router>\r\n    <MuiPickersUtilsProvider utils={MomentUtils} locale=\"zh-cn\">\r\n      <CssBaseline />\r\n      <AppBar\r\n        position=\"fixed\"\r\n        className={clsx(classes.appBar, {\r\n          [classes.appBarShift]: open,\r\n        })}\r\n      >\r\n        <Toolbar>\r\n          <IconButton\r\n            color=\"inherit\"\r\n            aria-label=\"open drawer\"\r\n            onClick={() => { setOpen(true); }}\r\n            edge=\"start\"\r\n            className={clsx(classes.menuButton, {\r\n              [classes.hide]: open,\r\n            })}\r\n          >\r\n            <MenuIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h6\" noWrap className={classes.title}>\r\n            {title}\r\n          </Typography>\r\n          <IconButton\r\n            color=\"inherit\"\r\n            onClick={() => { setOpenUser(true); }}\r\n          >\r\n            <AccountCircleIcon />\r\n          </IconButton>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer\r\n        variant=\"permanent\"\r\n        className={clsx(classes.drawer, {\r\n          [classes.drawerOpen]: open,\r\n          [classes.drawerClose]: !open,\r\n        })}\r\n        classes={{\r\n          paper: clsx({\r\n            [classes.drawerOpen]: open,\r\n            [classes.drawerClose]: !open,\r\n          }),\r\n        }}\r\n      >\r\n        <div className={classes.toolbar}>\r\n          <IconButton onClick={() => { setOpen(false); }}>\r\n            {theme.direction === 'rtl' ? <ChevronRightIcon /> : <ChevronLeftIcon />}\r\n          </IconButton>\r\n        </div>\r\n        <Divider />\r\n        <List onClick={handleClickAction}>\r\n          <ListItemLink to=\"/\" primary=\"启动页\" icon={<DashboardIcon />} />\r\n          <ListItemLink to=\"/tasks\" primary=\"任务\" icon={<AssignmentIcon />} />\r\n          <ListItemLink to=\"/predicts\" primary=\"智能预测\" icon={<EqualizerIcon />} />\r\n          <ListItemLink to=\"/settings\" primary=\"设置\" icon={<SettingsIcon />} />\r\n        </List>\r\n      </Drawer>\r\n      <main className={classes.content}>\r\n        <div className={classes.toolbar} />\r\n        <Switch>\r\n          <Route path={\"/\"} exact={true}>\r\n            <Launch />\r\n          </Route>\r\n          <Route path={\"/tasks\"} exact={true}>\r\n            <Tasks />\r\n          </Route>\r\n          <Route path={\"/predicts\"} exact={true}>\r\n            <Predicts />\r\n          </Route>\r\n          <Route path={\"/settings\"} exact={false}>\r\n            <Settings />\r\n          </Route>\r\n        </Switch>\r\n      </main>\r\n    </MuiPickersUtilsProvider>\r\n  </Router>;\r\n\r\n  const user = store.getState().user;\r\n  const isNowLogining = !user && store.getState().config.data.api_token.access_token;\r\n  let content = isNowLogining ? <Box>正在登录...</Box> : (user ? mainContent : <Login></Login>);\r\n  if ((!isNowLogining && user) && !store.getState().daemon) {\r\n    content = <Typography variant=\"body1\">获取账户信息...</Typography>;\r\n    if (!requestingRemote) {\r\n      setRequesingRemote(true);\r\n      const daemon = api.request('remote_login', 'GET').then(daemon => {\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        } else if (daemon.code === 200 && !daemon.data.uid) {\r\n          store.dispatch(setDaemon({}));\r\n        }\r\n      });\r\n    }\r\n  } else if ((!isNowLogining && user) && store.getState().daemon && !store.getState().daemon.uid) {\r\n    content = <RemoteLogin></RemoteLogin>\r\n  }\r\n  // console.log('app.js user', user, 'content', content);\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <ErrorBoundary>\r\n        <ThemeProvider theme={store.getState().config.theme}>\r\n          {content}\r\n          <Dialog fullWidth open={openUser} onClose={() => { setOpenUser(false); }}>\r\n            <DialogContent>\r\n              <User onClose={() => { setOpenUser(false); }}></User>\r\n            </DialogContent>\r\n          </Dialog>\r\n          <Dialog open={errorDialogInfo ? true : false} onClose={() => { setErrorDialogInfo(null); }}>\r\n            <DialogTitle>遇到错误</DialogTitle>\r\n            <DialogContent>\r\n              <Typography variant=\"body1\">错误信息</Typography>\r\n              <Box component=\"div\">\r\n                <Box component=\"div\">\r\n                  {() => {\r\n                    if (isIterator(errorDialogInfo) && typeof (errorDialogInfo) !== 'string') {\r\n                      return <List>\r\n                        {errorDialogInfo.map((d, i) => <ListItem key={d}>\r\n                          <code>{JSON.stringify(d) === '{}' ? d.toString() : JSON.stringify(d)}</code>\r\n                        </ListItem>)}\r\n                      </List>;\r\n                    } else {\r\n                      return <code>{JSON.stringify(errorDialogInfo) === '{}' ? errorDialogInfo.toString() : JSON.stringify(errorDialogInfo)}</code>;\r\n                    }\r\n                  }}\r\n                </Box>\r\n              </Box>\r\n            </DialogContent>\r\n            <DialogActions>\r\n              <Button color=\"primary\" onClick={() => { window.location.reload() }}>刷新</Button>\r\n              <Button color=\"primary\" onClick={() => { setErrorDialogInfo(null); }}>取消</Button>\r\n            </DialogActions>\r\n          </Dialog>\r\n          <Snackbar\r\n            anchorOrigin={{\r\n              vertical: 'bottom',\r\n              horizontal: 'right',\r\n            }}\r\n            open={myMessage !== null}\r\n            autoHideDuration={3000}\r\n            // onClose={(e) => { console.log(e); }}\r\n            message={myMessage}\r\n            action={\r\n              <React.Fragment>\r\n                <IconButton size=\"small\" aria-label=\"close\" color=\"inherit\" onClick={() => setMyMessage(null)}>\r\n                  <CloseIcon fontSize=\"small\" />\r\n                </IconButton>\r\n              </React.Fragment>\r\n            }\r\n          />\r\n        </ThemeProvider>\r\n      </ErrorBoundary>\r\n    </div >\r\n  );\r\n}\r\n","const reportWebVitals = onPerfEntry => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport reportWebVitals from './reportWebVitals';\r\nimport store from './data/store';\r\nimport { Provider } from 'react-redux';\r\nimport { api } from './api/api';\r\nimport { setConfig, setDaemon, setErrorInfo, setRoomStockPlans, setTimetableNodes, setTimetablePeriods, setUser } from './data/action';\r\nimport { sleep } from './utils/utils';\r\n\r\n// 循环执行函数\r\nasync function cycleFunc(cycle = 1000) {\r\n  while (true) {\r\n    try {\r\n\r\n    } catch (e) {\r\n      console.error(e);\r\n    }\r\n    await sleep(cycle);\r\n  }\r\n}\r\n\r\n// 开始执行的函数\r\nasync function startFunc() {\r\n  setTimeout(async () => {\r\n    const user = store.getState().user;\r\n    const isNowLogining = !user && store.getState().config.data.api_token.access_token;\r\n    if (isNowLogining) {\r\n      api.load_from_config();\r\n      const res = await api.request('user', 'GET');\r\n      // console.log('index res', res)\r\n      if (res.code === 200) {\r\n        // console.log('saving user', res.data.user)\r\n        store.dispatch(setUser(res.data.user));\r\n        const daemon = await api.request('daemon', 'GET');\r\n        if (daemon.code === 200 && daemon.data.uid) {\r\n          store.dispatch(setDaemon(daemon.data));\r\n        } else store.dispatch(setDaemon(null));\r\n      }\r\n    }\r\n    // let c = api.download_config();\r\n    // if (!c.settings_async) return;\r\n    // const config_frontend = await api.download_config();\r\n    // if (!config_frontend) {\r\n    //   store.dispatch(setErrorInfo(\"同步设置失败\"));\r\n    // }\r\n    // else store.dispatch(setConfig(config_frontend));\r\n  }, 0);\r\n}\r\n\r\nReactDOM.render(\r\n  // <React.StrictMode>\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  // </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\nstartFunc().then(() => {\r\n  cycleFunc();\r\n});\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals();\r\n"],"sourceRoot":""}