(this["webpackJsonpgbk-frontend"]=this["webpackJsonpgbk-frontend"]||[]).push([[0],{153:function(e,t,n){},163:function(e,t,n){},170:function(e,t,n){"use strict";n.r(t);var a=n(13),r=n.n(a),c=n(22),i=n(0),s=n.n(i),o=n(12),l=n.n(o),d=(n(153),n(9)),u=n(74),j=n(19),h=(n(154),n(4)),f=n(219),b=n(26),g=n(238),O=n(245),p=n(237),x=n(220),v=n(217),m=n(236),y=n(69),k=n(235),S=n(225),_=n(113),w=n.n(_),C=n(116),T=n.n(C),E=n(115),N=n.n(E),A=n(114),D=n.n(A),W=n(117),M=n.n(W),I=n(118),q=n.n(I),R=n(119),F=n.n(R),J=n(120),G=n.n(J),P=n(78),z=n(16),L=n(92),B=n(18),Y=n(108),H=n(25),U=n.n(H),V=(n(103),n(68)),K=n(109),X=n(50),Q=n(51),Z=n(121),$=n(209),ee=n(84);function te(e){return new Promise((function(t){setTimeout(t,e)}))}function ne(e){return null!=e&&"function"===typeof e[Symbol.iterator]}function ae(e){if(null===e||void 0===e)return e;if(ne(e)&&"string"!==typeof e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}if("object"===typeof e){var a={};for(var r in e)a[r]=ae(e[r]);return a}return e}function re(e,t){var n=ae(e);for(var a in t)n[a]=t[a];return n}function ce(e,t){var n=Object.getOwnPropertyNames(e),a=Object.getOwnPropertyNames(t);if(n.length!==a.length)return!1;for(var r=0;r<n.length;r++){var c=n[r],i=e[c],s=t[c];if(!t.hasOwnProperty(c))return!1;if(i instanceof Object){if(!ce(i,s))return!1}else if(i!==s)return!1}return!0}Date.prototype.setDay=function(e){var t=this.getDay();return t===e||this.setTime(this.getTime()+864e5*(e-t)),this},Date.prototype.toDateString=function(){return this.toISOString().slice(0,10)};var ie={"\u79d2":1,"\u5206":60,"\u65f6":3600,"\u5929":86400,"\u5468":604800};function se(e){if("number"!==typeof e)return"";var t=function(e){if("number"!==typeof e)return null;if(e>=ie[Object.keys(ie)[Object.keys(ie).length-1]])return Object.keys(ie)[Object.keys(ie).length-1];for(var t=1;t<Object.keys(ie).length;t++)if(e<ie[Object.keys(ie)[t]])return Object.keys(ie)[t-1];return Object.keys(ie)[0]}(e);return null===t?"":"".concat((e/ie[t]).toFixed(2)).concat(t)}function oe(e){return function(t){t({type:"SET_CONFIG",data:e})}}function le(e){return function(t){t({type:"SET_USER",data:e})}}function de(e){return function(t){t({type:"SET_DAEMON",data:e})}}function ue(e){return function(t){t({type:"SET_ERROR_INFO",data:e})}}function je(e){return function(t){t({type:"SET_MESSAGE",data:e})}}function he(e,t){return n=re(Oe.getState().types,Object(j.a)({},e,t)),function(e){e({type:"SET_TYPES",data:n})};var n}var fe=new(function(){function e(){Object(X.a)(this,e),this.host=window.location.href.includes("localhost")?"localhost":null,this.port=8880,this.api_version="v2",this.api_prefix="/api/".concat(this.api_version),this.protocol="http",this.url=this.host?"".concat(this.protocol,"://").concat(this.host,":").concat(this.port).concat(this.api_prefix):"".concat(this.api_prefix),this.access_token="",this.refresh_token=""}return Object(Q.a)(e,[{key:"set_token",value:function(e,t){void 0!==e&&(this.access_token=e),void 0!==t&&(this.refresh_token=t)}},{key:"get_token",value:function(){return{access_token:""===this.access_token?void 0:this.access_token,refresh_token:""===this.refresh_token?void 0:this.refresh_token}}},{key:"request_key",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",a=arguments.length>3?arguments[3]:void 0;return this.request("".concat(e,"/").concat(t),n,a)}},{key:"update_config",value:function(){var e=Oe.getState().config;e.data.api_token=this.get_token(),console.log("config.data.api_token",e.data.api_token),Oe.dispatch(oe(e))}},{key:"load_from_config",value:function(){var e=Oe.getState().config;this.set_token(e.data.api_token.access_token,e.data.api_token.refresh_token)}},{key:"get_headers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={"Content-Type":"application/json"};return e&&(n.Refresh=this.refresh_token),t&&""!==this.access_token&&(n.Authorization=this.access_token),n}},{key:"request",value:function(){var e=Object(c.a)(r.a.mark((function e(t){var n,a,c,i,s,o,l,d,u,j,h,f=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:"GET",a=f.length>2?f[2]:void 0,c={method:n,mode:"cors",body:a?JSON.stringify(a):void 0,headers:this.get_headers(Boolean("session"===t&&"DELETE"===n))},e.next=5,fetch("".concat(this.url,"/").concat(t),c);case 5:return i=e.sent,s=null,e.prev=7,e.next=10,i.json();case 10:s=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(7),console.error(e.t0),Oe.dispatch(ue(e.t0)),e.abrupt("return",{code:i.status,error:i.statusText});case 18:if(console.log("raw js:",s),s||((s={}).message=i.statusText),void 0===s.code&&(s.code=i.status),422!==s.code){e.next=46;break}if(""!==this.refresh_token){e.next=24;break}return e.abrupt("return",null);case 24:return e.next=26,fetch("".concat(this.url,"/session"),{method:"GET",mode:"cors",headers:this.get_headers(!0)});case 26:return o=e.sent,e.prev=27,e.next=30,o.json();case 30:if(200!==(l=e.sent).code){e.next=38;break}this.set_token(l.data.access_token,l.data.refresh_token),this.update_config(),200===(d=this.request("user","GET")).code&&Oe.dispatch(le(d.data.user)),e.next=40;break;case 38:return Oe.dispatch(ue("\u767b\u5f55\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55")),e.abrupt("return",null);case 40:e.next=45;break;case 42:return e.prev=42,e.t1=e.catch(27),e.abrupt("return",{code:o.status,error:o.statusText});case 45:return e.abrupt("return",this.request(t,n,a));case 46:return 200===s.code?"session"===t&&"POST"===n?(u=s.data,j=u.access_token,h=u.refresh_token,this.set_token(j,h),this.update_config()):"session"===t&&"DELETE"===n&&(this.set_token("",""),this.update_config()):Oe.dispatch(ue(s)),e.abrupt("return",s);case 48:case"end":return e.stop()}}),e,this,[[7,13],[27,42]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()),be={config:new(function(){function e(){Object(X.a)(this,e),this.ITEM_NAME="group_bying_config",this.load=this.load.bind(this),this.save=this.save.bind(this),this.theme_avaliable={"\u9ed8\u8ba4\u4e3b\u9898":Object(Z.a)({}),"\u9ed1\u6697\u6a21\u5f0f":Object(Z.a)({palette:{type:"dark",primary:{main:$.a[500]},secondary:{main:ee.a[500]}}})},this.data_default={debug:!1,version_frontend:.1,theme_name:"\u9ed8\u8ba4\u4e3b\u9898",theme_avaliable:["\u9ed8\u8ba4\u4e3b\u9898","\u9ed1\u6697\u6a21\u5f0f"],settings_async:!0,remote_login:{server:"ws://127.0.0.1:8081"},api_token:{}},this.data=this.data_default,this.theme=this.theme_avaliable["\u9ed8\u8ba4\u4e3b\u9898"],this.load()}return Object(Q.a)(e,[{key:"load",value:function(){console.log("Config: loading config..."),this.data.debug&&(console.log("Config: load default config."),this.save());try{if(this.data=JSON.parse(localStorage.getItem(this.ITEM_NAME)),!this.data)throw new Error("Null data");if(console.log("Got data:",this.data),!this.data.version_frontend||this.data.version_frontend<this.data_default.version_frontend){for(var e in console.log("Config: update ".concat(this.data.version_frontend," -> ").concat(this.data_default.version_frontend)),this.data.version_frontend=this.data_default.version_frontend,this.data_default)this.data[e]||(console.log("    Config: add value ".concat(e)),this.data[e]=this.data_default[e]);this.save()}}catch(t){console.warn("Can not find ".concat(this.ITEM_NAME," in localStorage, use default config.")),this.data=this.data_default,this.save()}this.theme=this.theme_avaliable[this.data.theme_name],this.theme||(this.theme=this.theme_avaliable.default),fe.set_token(this.data.api_token.access_token,this.data.api_token.refresh_token)}},{key:"save",value:function(){console.log("Config: saving config..."),this.data.api_token=fe.get_token();var e=JSON.stringify(this.data);return localStorage.setItem(this.ITEM_NAME,e),e}}]),e}()),tasks:[],user:null,daemon:null,errorInfo:null,message:null,types:{}};var ge=Object(V.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.config,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CONFIG":return t.data;default:return e}},errorInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.errorInfo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ERROR_INFO":return t.data;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.message,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.data;default:return e}},daemon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.daemon,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DAEMON":return t.data;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.user,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.tasks,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TASKS":return t.data;default:return e}},types:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.types,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TYPES":return t.data;default:return e}}}),Oe=Object(V.c)(ge,Object(V.a)(K.a)),pe=n(173),xe=n(212),ve=n(213),me=n(2);var ye=function(e){var t=e.icon,n=e.primary,a=e.to,r=s.a.useMemo((function(){return s.a.forwardRef((function(e,t){return Object(me.jsx)(P.b,Object(u.a)({to:a,ref:t},e))}))}),[a]);return Object(me.jsx)("li",{children:Object(me.jsxs)(pe.a,{button:!0,component:r,children:[t?Object(me.jsx)(xe.a,{children:t}):null,Object(me.jsx)(ve.a,{primary:n})]})})},ke=n(233),Se=n(230),_e=n(231),we=n(232),Ce=n(218),Te=n(240),Ee=n(214),Ne=n(215),Ae=n(216),De=n(242),We=n(241),Me=n(228),Ie=n(229),qe=n(226),Re=n(239),Fe=n(67),Je=n.n(Fe);function Ge(e){var t=e.defaultValue,n=e.open,a=e.onClose,r=e.title,c=e.keyNames,i=e.dataType,o=e.typeName,l=e.dismiss&&ne(e.dismiss)?e.dismiss:[],u=e.onSave?e.onSave:null,h=s.a.useState(t),f=Object(d.a)(h,2),b=f[0],g=f[1],O=function(e){return g(re(b,e))},p=s.a.useState(!1),x=Object(d.a)(p,2),m=x[0],k=x[1],_=s.a.useState(null),w=Object(d.a)(_,2),C=w[0],T=w[1],E=s.a.useState(null),N=Object(d.a)(E,2),A=N[0],D=N[1],W=s.a.useState({}),M=Object(d.a)(W,2),I=M[0],q=M[1];return Object(me.jsxs)(Ee.a,{fullWidth:!0,open:n,onClose:a,children:[Object(me.jsx)(Ne.a,{children:r}),Object(me.jsxs)(Ae.a,{children:[Object(me.jsx)(v.a,{style:{width:"100%"},children:Object.keys(b).map((function(e,t){if(l.indexOf(e)>=0)return null;var n=i&&o&&Oe.getState().types[o][i].args[e]?Oe.getState().types[o][i].args[e]:null;if(i&&o&&n&&!n.editable)return null;var a=c&&c[e]||e,r=b[e];if(!r&&"number"!==typeof r&&i&&o&&n&&(r="".concat(n.type,"|").concat(n.value?n.value:"")),"object"===typeof r)return Object(me.jsx)(pe.a,{button:!0,onClick:function(){T(r),D(a),k(!0)},children:a},t);var s=null;if("string"===typeof r&&r.startsWith("timezone|"))s=r.slice("timezone|".length);else if("string"===typeof r&&r.startsWith("datetime|"))s="datetime|"===r?Object(me.jsx)(Ce.a,{onClick:function(){O(Object(j.a)({},e,"datetime|".concat((new Date).toISOString())))},children:"\u70b9\u51fb\u8bbe\u7f6e"}):Object(me.jsxs)(Te.a,{children:[Object(me.jsx)(Re.a,{value:r.slice("datetime|".length),onChange:function(t){console.log("e",t),console.log("datetime|".concat(U()(t).format("YYYY-MM-DDTHH:mm:ss.SSSSSS+00:00"))),O(Object(j.a)({},e,"datetime|".concat(U()(t).format("YYYY-MM-DDTHH:mm:ss.SSSSSS+00:00"))))}}),Object(me.jsx)(S.a,{onClick:function(){O(Object(j.a)({},e,null))},children:Object(me.jsx)(Je.a,{})})]});else if("string"===typeof r&&r.startsWith("timedelta|")){var d=r.slice("timedelta|".length),u=I[e]?I[e]:Object.keys(ie)[Object.keys(ie).length-1];s=Object(me.jsxs)(Te.a,{children:[Object(me.jsx)(De.a,{value:"".concat(parseFloat(d)/ie[u]),onChange:function(t){var n=t.target.value;if(isNaN(parseFloat(n))){if(n.length>0)return;n=0}var a="timedelta|".concat(parseFloat(n)*ie[u]);O(Object(j.a)({},e,a))}}),Object(me.jsx)(We.a,{value:u,onChange:function(t){q(re(I,Object(j.a)({},e,t.target.value)))},children:Object.keys(ie).map((function(e,t){return Object(me.jsx)(Me.a,{value:e,children:e},t)}))})]})}else s=Object(me.jsx)(De.a,{value:"".concat(r),onChange:function(t){var n=0===t.target.value.length?0:"number"===typeof r?parseFloat(t.target.value):"".concat(t.target.value);isNaN(n)||O(Object(j.a)({},e,n))}});return Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(ve.a,{children:a}),Object(me.jsx)(Ie.a,{children:s})]},t)}))}),C&&A?Object(me.jsx)(Ge,{defaultValue:C,open:m,onClose:function(){k(!1)},title:A}):void 0]}),u?Object(me.jsxs)(qe.a,{children:[Object(me.jsx)(Ce.a,{color:"primary",onClick:function(){u(b)},children:"\u4fdd\u5b58"}),Object(me.jsx)(Ce.a,{onClick:a,children:"\u53d6\u6d88"})]}):Object(me.jsx)(qe.a,{children:Object(me.jsx)(Te.a,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center"},children:Object(me.jsx)(y.a,{style:{height:"100%"},variant:"body1",color:"secondary",children:"\u65e0\u6cd5\u4fdd\u5b58"})})})]})}function Pe(e){var t=e.data,n=e.open,a=e.onClose,r=e.title,c=e.keyNames,i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],j=s.a.useState(null),h=Object(d.a)(j,2),f=h[0],b=h[1],g=s.a.useState(null),O=Object(d.a)(g,2),p=O[0],x=O[1];return Object(me.jsxs)(Ee.a,{fullWidth:!0,open:n,onClose:a,children:[Object(me.jsx)(Ne.a,{children:r}),Object(me.jsxs)(Ae.a,{children:[Object(me.jsx)(v.a,{style:{width:"100%"},children:Object.keys(t).map((function(e,n){var a=c&&c[e]||e;if(t[e]){if("object"===typeof t[e])return Object(me.jsx)(pe.a,{button:!0,onClick:function(){b(t[e]),x(a),u(!0)},children:a},n);var r="".concat(t[e]);return Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(ve.a,{children:a}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)(y.a,{variant:"body1",children:r.slice(0,20)+(r.length>20?"...":"")})})]},n)}}))}),f&&p?Object(me.jsx)(Pe,{data:f,open:l,onClose:function(){u(!1)},title:p}):void 0]})]})}var ze={item_id:"\u76ee\u6807\u9879\u76eeID",target_price:"\u76ee\u6807\u4ef7\u683c"};function Le(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"actions";return!ce(e.data,Oe.getState().types[t][e.type].data)}function Be(e){if("number"!==typeof e)return"";for(var t={"\u79d2":1,"\u5206":60,"\u65f6":3600,"\u5929":86400,"\u5468":604800},n=1;n<Object.keys(t).length;n++)if(e<t[Object.keys(t)[n]])return"".concat((e/t[Object.keys(t)[n-1]]).toFixed(2)).concat(Object.keys(t)[n-1]);return"".concat((e/t[Object.keys(t)[Object.keys(t).length-1]]).toFixed(2)).concat(Object.keys(t)[Object.keys(t).length-1])}function Ye(e,t,n){var a="";if("object"===typeof e){for(var r in e){var c=ze&&ze[r]||r,i=n&&t&&Oe.getState().types[t][n].args[r]?Oe.getState().types[t][n].args[r]:null;if(!i||i.editable){var s=e[r];(s||"number"===typeof s)&&("string"===typeof s&&(s.startsWith("datetime|")?s=U()(s.slice("datetime|".length)).calendar():s.startsWith("timedelta|")&&(s=Be(parseFloat(s.slice("timedelta|".length))))),a="".concat(0===a.length?"":a+"/").concat(c,":").concat(s))}}return a}}function He(e){var t=e.action,n=e.selectMode,a=e.onClick,r=e.onSave,c=s.a.useState(!1),i=Object(d.a)(c,2),o=i[0],l=i[1],u=s.a.useState(!1),j=Object(d.a)(u,2),h=j[0],f=j[1];if(a=a||function(){},!t)return null;var b=function(){l(!1)},g=function(e){a(e||t,n)};return Object(me.jsxs)(Se.a,{style:{minWidth:200,margin:10},children:[Object(me.jsxs)(_e.a,{onClick:n?function(){}:function(){g()},children:[Object(me.jsx)(y.a,{variant:"h5",children:t.name}),Le(t,"actions")?Ye(t.data,"actions",t.type):Object(me.jsx)(y.a,{variant:"body1",children:t.desc}),Object(me.jsx)(Ge,{keyNames:ze,open:o,dataType:t.type,typeName:"actions",onClose:b,defaultValue:t.data,onSave:function(e){var n=ae(t);n.data=e,console.log(e),r&&r(n),b(),h&&g(n)}})]}),n?Object(me.jsxs)(we.a,{children:[Object(me.jsx)(Ce.a,{color:"primary",onClick:n?function(){g()}:function(){},children:"\u4f7f\u7528"}),Object(me.jsx)(Ce.a,{color:"primary",onClick:function(){l(!0),f(!0)},children:"\u4fee\u6539\u8bbe\u7f6e\u5e76\u4f7f\u7528"})]}):Object(me.jsx)(we.a,{children:Object(me.jsx)(Ce.a,{color:Le(t,"actions")?"primary":"secondary",onClick:function(){l(!0)},children:"\u4fee\u6539\u8bbe\u7f6e"})})]})}function Ue(e){var t=e.selectMode,n=e.onClick;n=n||function(){};var a=s.a.useState(!1),r=Object(d.a)(a,2),c=r[0],i=r[1],o=s.a.useReducer((function(e){return e+1}),0),l=Object(d.a)(o,2),u=(l[0],l[1]),j=Oe.getState().types.actions;j||c||(i(!0),fe.request("action","GET").then((function(e){Oe.dispatch(he("actions",e.data.actions)),u()})));var h=null;return h=j?Object(me.jsx)(Te.a,{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:Object.keys(j).map((function(e,a){return Object(me.jsx)(He,{onClick:n,selectMode:t,action:j[e]},a)}))}):Object(me.jsx)(y.a,{variant:"body1",children:"\u6b63\u5728\u52a0\u8f7dAction\u7c7b\u578b..."}),Object(me.jsx)(Te.a,{children:h})}var Ve={start_date:"\u5f00\u59cb\u65f6\u95f4",end_date:"\u7ed3\u675f\u65f6\u95f4",interval:"\u95f4\u9694",run_date:"\u8fd0\u884c\u65f6\u95f4"};function Ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"triggers";return!ce(e.data,Oe.getState().types[t][e.type].data)}function Xe(e,t,n){var a="";if("object"===typeof e){for(var r in e){var c=Ve&&Ve[r]||r,i=n&&t&&Oe.getState().types[t][n].args[r]?Oe.getState().types[t][n].args[r]:null;if(!i||i.editable){var s=e[r];s&&(s.startsWith("datetime|")?s=U()(s.slice("datetime|".length)).calendar():s.startsWith("timedelta|")&&(s=se(parseFloat(s.slice("timedelta|".length)))),a="".concat(0===a.length?"":a+"/").concat(c,":").concat(s))}}return a}}function Qe(e){var t=e.trigger,n=e.selectMode,a=e.onClick,r=e.onSave,c=s.a.useState(!1),i=Object(d.a)(c,2),o=i[0],l=i[1],u=s.a.useState(!1),j=Object(d.a)(u,2),h=j[0],f=j[1];if(a=a||function(){},!t)return null;var b=function(){l(!1)},g=function(e){a(e||t,n)};return Object(me.jsxs)(Se.a,{style:{minWidth:200,margin:10},children:[Object(me.jsxs)(_e.a,{onClick:n?function(){}:function(){g()},children:[Object(me.jsx)(y.a,{variant:"h5",children:t.name}),Ke(t,"triggers")?Xe(t.data,"triggers",t.type):Object(me.jsx)(y.a,{variant:"body1",children:t.desc}),Object(me.jsx)(Ge,{dismiss:["version","timezone"],keyNames:Ve,open:o,dataType:t.type,typeName:"triggers",onClose:b,defaultValue:t.data,onSave:function(e){var n=ae(t);n.data=e,console.log(e),r&&r(n),b(),h&&g(n)}})]}),n?Object(me.jsxs)(we.a,{children:[Object(me.jsx)(Ce.a,{color:"primary",onClick:n?function(){g()}:function(){},children:"\u4f7f\u7528"}),Object(me.jsx)(Ce.a,{color:"primary",onClick:function(){l(!0),f(!0)},children:"\u4fee\u6539\u8bbe\u7f6e\u5e76\u4f7f\u7528"})]}):Object(me.jsx)(we.a,{children:Object(me.jsx)(Ce.a,{color:Ke(t,"triggers")?"primary":"secondary",onClick:function(){l(!0)},children:"\u4fee\u6539\u8bbe\u7f6e"})})]})}function Ze(e){var t=e.selectMode,n=e.onClick;n=n||function(){};var a=s.a.useState(!1),r=Object(d.a)(a,2),c=r[0],i=r[1],o=s.a.useReducer((function(e){return e+1}),0),l=Object(d.a)(o,2),u=(l[0],l[1]),j=Oe.getState().types.triggers;j||c||(i(!0),fe.request("trigger","GET").then((function(e){Oe.dispatch(he("triggers",e.data.triggers)),u()})));var h=null;return h=j?Object(me.jsx)(Te.a,{style:{display:"flex",flexDirection:"row",flexWrap:"wrap"},children:Object.keys(j).map((function(e,a){return Object(me.jsx)(Qe,{onClick:n,selectMode:t,trigger:j[e]},a)}))}):Object(me.jsx)(y.a,{variant:"body1",children:"\u6b63\u5728\u52a0\u8f7d\u89e6\u53d1\u5668\u7c7b\u578b..."}),Object(me.jsx)(Te.a,{children:h})}function $e(e){return Object(me.jsxs)(ke.a,{children:[Object(me.jsx)(Ze,{useActions:!1,onClick:function(e){console.log(e)}}),Object(me.jsx)(Ue,{useActions:!0})]})}var et=n(234),tt=n(223),nt=n(247);var at=function(e){var t=s.a.useState(Oe.getState().config.data.theme_name),n=Object(d.a)(t,2),a=n[0],r=n[1],c=s.a.useRef(),i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],j=s.a.useState(!1),h=Object(d.a)(j,2),f=h[0],b=h[1],g=s.a.useState(!1),O=Object(d.a)(g,2),p=O[0],x=O[1],m=s.a.useState(!1),k=Object(d.a)(m,2),S=k[0],_=k[1],w=function(){var e=Oe.getState().config;e.data=e.data_default,e.save(),e.load(),Oe.dispatch(oe(e))},C=Oe.getState().user;return Object(me.jsxs)(ke.a,{maxWidth:"md",children:[Object(me.jsxs)(v.a,{children:[Object(me.jsx)(et.a,{children:"\u7528\u6237\u8d26\u53f7"}),Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(ve.a,{primary:"\u7528\u6237\u540d"}),Object(me.jsx)(Ie.a,{children:C.username})]}),Object(me.jsx)(pe.a,{button:!0,onClick:function(){_(!0)},children:Object(me.jsx)(ve.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(me.jsx)(pe.a,{button:!0,children:Object(me.jsx)(ve.a,{primary:"\u4fee\u6539\u4fe1\u606f"})}),Object(me.jsx)(et.a,{children:"\u7528\u6237\u95e8\u5e97"}),Object(me.jsx)(pe.a,{button:!0,onClick:function(){x(!0)},children:Object(me.jsx)(ve.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(me.jsx)(et.a,{children:"\u5916\u89c2"}),Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(ve.a,{primary:"\u4e3b\u9898\u8bbe\u7f6e"}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)(tt.a,{children:Object(me.jsx)(We.a,{value:a,onChange:function(e){r(e.target.value);var t=Oe.getState().config;t.data.theme_name=e.target.value,t.theme=t.theme_avaliable[t.data.theme_name],t.save(),Oe.dispatch(oe(t)),setTimeout((function(){window.location.reload()}),200)},children:Oe.getState().config.data.theme_avaliable.map((function(e,t){return Object(me.jsx)(Me.a,{value:e,children:e},t)}))})})})]}),Object(me.jsx)(et.a,{children:"\u6570\u636e\u7ba1\u7406"}),Object(me.jsx)(pe.a,{button:!0,onClick:function(){!function(e,t){var n=document.createElement("a");n.download=t,n.style.display="none";var a=new Blob([e]);n.href=URL.createObjectURL(a),document.body.appendChild(n),n.click(),document.body.removeChild(n)}(Oe.getState().config.save(),"\u56e2\u8d2d\u6740\u624b\u914d\u7f6e\u6570\u636e(".concat((new Date).toLocaleString(),").json"))},children:Object(me.jsx)(ve.a,{primary:"\u6570\u636e\u5bfc\u51fa"})}),Object(me.jsxs)(pe.a,{button:!0,onClick:function(){c.current.click()},children:[Object(me.jsx)(ve.a,{primary:"\u6570\u636e\u5bfc\u5165"}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)("input",{type:"file",accept:".json",hidden:!0,name:"file-gbk-data",ref:c,onChange:function(e){var t=e.target.files;if(0!==t.length)try{var n=t[0],a=new FileReader;a.readAsText(n,"UTF-8"),a.onload=function(t){var n=t.target.result;try{var a=JSON.parse(n);if(!a.version_frontend)return void Oe.dispatch(je("\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u8005\u6587\u4ef6\u5df2\u7ecf\u635f\u574f"));if(a.version_frontend>Oe.getState().config.data.version_frontend)return void Oe.dispatch(je("\u5b58\u6863\u6587\u4ef6\u7248\u672c(".concat(a.version_frontend,"\u9ad8\u4e8e\u5f53\u524d\u7248\u672c").concat(Oe.getState().config.data.version_frontend,")\uff0c\u8bf7\u66f4\u65b0\u5230\u6700\u65b0\u7248")));var r=Oe.getState().config;r.data=a,Oe.dispatch(oe(r)),Oe.dispatch(je("\u6570\u636e\u5bfc\u5165\u5b8c\u6210"))}catch(e){Oe.dispatch(ue(e))}}}catch(e){Oe.dispatch(ue(e))}else Oe.dispatch(je("\u672a\u9009\u62e9\u6587\u4ef6"))}})})]}),Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(ve.a,{primary:"\u8bbe\u7f6e\u6570\u636e\u540c\u6b65"}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)(nt.a,{defaultChecked:Oe.getState().config.data.settings_async,onChange:function(e){var t=Oe.getState().config;t.data.settings_async=e.target.checked,t.save(),Oe.dispatch(oe(t))}})})]}),Object(me.jsx)(pe.a,{button:!0,onClick:function(){return u(!0)},children:Object(me.jsx)(ve.a,{primary:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"})}),Object(me.jsx)(pe.a,{button:!0,onClick:function(){return b(!0)},children:Object(me.jsx)(ve.a,{primary:"\u5220\u9664\u6240\u6709\u6570\u636e"})})]}),Object(me.jsx)(Pe,{data:Oe.getState().user,open:S,keyNames:{username:"\u7528\u6237\u540d",nick:"\u6635\u79f0",phone:"\u7528\u6237\u624b\u673a\u53f7",profile:"\u8be6\u7ec6\u4fe1\u606f",state:"\u7528\u6237\u72b6\u6001",created_at:"\u521b\u5efa\u4e8e",updated_at:"\u66f4\u65b0\u4e8e"},title:"\u7528\u6237\u4fe1\u606f",onClose:function(){_(!1)}}),Object(me.jsx)(Pe,{data:Oe.getState().daemon,open:p,keyNames:{cookies:"\u8fdc\u7a0b\u767b\u5f55\u51ed\u636e",shop_info:"\u95e8\u5e97\u8be6\u7ec6\u4fe1\u606f",solution_id:"\u89e3\u51b3\u65b9\u6848\u7f16\u53f7"},title:"\u95e8\u5e97\u4fe1\u606f",onClose:function(){x(!1)}}),Object(me.jsxs)(Ee.a,{open:l,onClose:function(){return u(!1)},children:[Object(me.jsx)(Ne.a,{children:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"}),Object(me.jsx)(Ae.a,{children:Object(me.jsx)(y.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u6240\u6709\u8bbe\u7f6e\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(me.jsxs)(qe.a,{children:[Object(me.jsx)(Ce.a,{onClick:function(){return u(!1)},children:"\u53d6\u6d88"}),Object(me.jsx)(Ce.a,{onClick:function(){w(),window.location.reload()},children:"\u786e\u5b9a"})]})]}),Object(me.jsxs)(Ee.a,{open:f,onClose:function(){return b(!1)},children:[Object(me.jsx)(Ne.a,{children:"\u5220\u9664\u6240\u6709\u6570\u636e"}),Object(me.jsx)(Ae.a,{children:Object(me.jsx)(y.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u8f6f\u4ef6\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(me.jsxs)(qe.a,{children:[Object(me.jsx)(Ce.a,{onClick:function(){return b(!1)},children:"\u53d6\u6d88"}),Object(me.jsx)(Ce.a,{onClick:function(){w(),window.location.reload()},children:"\u786e\u5b9a"})]})]})]})},rt=(n(163),n(244)),ct=n(123),it=n(122),st=n(86),ot=function(){function e(t){var n=this;Object(X.a)(this,e),this.connect=this.connect.bind(this),this.url=t||Oe.getState().config.data.remote_login.server||"ws://127.0.0.1:8081",this.ws=null,this.onopen=function(){console.log("Connection started")},this.ondata=function(e){"code"===e.cmd?n.oncode(e.data):"cookies"===e.cmd&&n.oncookies(e.data)},this.onmessage=function(e){n.ondata(JSON.parse(e.data))},this.onerror=function(e){console.error(e)},this.onclose=function(){console.log("Connection closed")},this.oncode=function(e){console.log("code",e)},this.oncookies=function(e){console.log("cookies",e)}}return Object(Q.a)(e,[{key:"connect",value:function(){this.ws=this.ws||new WebSocket(this.url),this.ws.onopen=this.onopen,this.ws.onclose=this.onclose,this.ws.onerror=this.onerror,this.ws.onmessage=this.onmessage}},{key:"close",value:function(){this.ws&&this.ws.close()}}]),e}(),lt=n(164);function dt(e){var t=e.children;return Object(me.jsx)(Te.a,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"column"},children:Object(me.jsx)(Te.a,{style:{width:"100%",textAlign:"center"},children:t})})}var ut=function(e){Object(ct.a)(n,e);var t=Object(it.a)(n);function n(e){var a;return Object(X.a)(this,n),(a=t.call(this,e)).state={code:null,loginDone:!1},a.ws_api=null,setTimeout(Object(c.a)(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Oe.getState().daemon&&!a.state.loginDone){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,fe.request("remote_login","PATCH");case 4:if(t=e.sent,!Oe.getState().daemon&&!a.state.loginDone){e.next=7;break}return e.abrupt("return");case 7:if(n=t.data.server,(i=Oe.getState().config).data.remote_login.server=n,Oe.dispatch(oe(i)),!Oe.getState().daemon&&!a.state.loginDone){e.next=13;break}return e.abrupt("return");case 13:if(a.ws_api=new ot(n),a.ws_api.oncode=function(e){Oe.getState().daemon||a.state.loginDone||a.setState({code:e})},a.ws_api.oncookies=function(){var e=Object(c.a)(r.a.mark((function e(t){var n,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fe.request("remote_login","POST",{cookies:t});case 2:if(n=e.sent,console.log("done",n),!Oe.getState().daemon&&!a.state.loginDone){e.next=6;break}return e.abrupt("return");case 6:return a.setState({loginDone:!0}),e.next=9,fe.request("remote_login","GET");case 9:200===(c=e.sent).code&&c.data.uid&&Oe.dispatch(de(c.data));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!Oe.getState().daemon&&!a.state.loginDone){e.next=18;break}return e.abrupt("return");case 18:a.ws_api.connect();case 19:case"end":return e.stop()}}),e)}))),1e3),a}return Object(Q.a)(n,[{key:"componentWillUnmount",value:function(){this.ws_api&&this.ws_api.close()}},{key:"render",value:function(){var e=null;return e=this.state.loginDone?Object(me.jsx)(st.a,{style:{width:200,height:200},children:Object(me.jsx)(dt,{children:"\u767b\u5f55\u5b8c\u6210"})}):this.state.code?Object(me.jsx)(lt,{value:JSON.stringify(this.state.code),size:200}):Object(me.jsx)(st.a,{style:{width:200,height:200},children:Object(me.jsx)(dt,{children:"\u6b63\u5728\u52a0\u8f7d\u4e8c\u7ef4\u7801..."})}),Object(me.jsx)(ke.a,{children:e})}}]),n}(s.a.Component),jt=n(126);function ht(e){var t=s.a.useState({username:"",password:"",captcha:"",actionType:"login"}),n=Object(d.a)(t,2),a=n[0],i=n[1],o=s.a.useRef(),l=s.a.useRef(),u=function(e){return i(re(a,e))},j="login"===a.actionType,h=function(){var e=Object(c.a)(r.a.mark((function e(){var t,n,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=16;break}return e.next=3,fe.request("session","POST",{username:a.username,password:a.password});case 3:if(t=e.sent,console.log(t),200===t.code){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,fe.request("user","GET");case 9:if(200===(n=e.sent).code){e.next=12;break}return e.abrupt("return");case 12:console.log("user",n.data.user),Oe.dispatch(le(n.data.user)),e.next=21;break;case 16:return e.next=18,fe.request("user","POST",{username:a.username,password:a.password});case 18:c=e.sent,console.log(c),200===c.code&&(Oe.dispatch(je("\u6ce8\u518c\u6210\u529f")),u({actionType:"login"}));case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(me.jsxs)(Te.a,{children:[Object(me.jsx)(y.a,{variant:"h4",children:j?"\u767b\u5f55":"\u6ce8\u518c"}),Object(me.jsx)("br",{}),Object(me.jsx)(k.a,{}),Object(me.jsx)("br",{}),Object(me.jsx)(De.a,{fullWidth:!0,ref:o,label:"\u7528\u6237\u540d",variant:"outlined",value:a.username,onChange:function(e){u({username:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&l.current.querySelector("input").focus()}}),Object(me.jsx)("br",{}),Object(me.jsx)("br",{}),Object(me.jsx)(De.a,{fullWidth:!0,ref:l,label:"\u5bc6\u7801",variant:"outlined",value:a.password,type:"password",onChange:function(e){u({password:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&h()}}),Object(me.jsx)(jt.a,{in:j,style:{display:j?"block":"none"},timeout:{exit:0,enter:200},children:Object(me.jsxs)(Te.a,{children:[Object(me.jsxs)(Te.a,{children:[Object(me.jsx)("br",{}),Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u767b\u5f55"})]}),Object(me.jsxs)(Te.a,{children:[Object(me.jsx)("br",{}),Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){return u({actionType:"sign_in"})},children:"\u6ce8\u518c"})]})]})}),Object(me.jsx)(jt.a,{in:!j,style:{display:j?"none":"block"},timeout:{exit:0,enter:200},children:Object(me.jsxs)(Te.a,{children:[Object(me.jsxs)(Te.a,{children:[Object(me.jsx)("br",{}),Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:h,children:"\u6ce8\u518c"})]}),Object(me.jsxs)(Te.a,{children:[Object(me.jsx)("br",{}),Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",onClick:function(){return u({actionType:"login"})},children:"\u8fd4\u56de\u767b\u5f55"})]})]})})]})}function ft(e){return Object(me.jsx)(ke.a,{maxWidth:"sm",children:Object(me.jsx)(ht,{})})}var bt=n(227);function gt(e){var t=e.task;return Object(me.jsx)("code",{children:JSON.stringify(t)})}function Ot(e){var t=Oe.getState().tasks,n=s.a.useState({dialogAddTaskOpen:!1,dialogAddTriggerOpen:!1,dialogAddActionOpen:!1,dialogUpdateTrigger:!1,triggers:[],actions:[],requesting:!1,taskName:Oe.getState().types.task_data?"\u672a\u547d\u540d\u4efb\u52a1".concat(Oe.getState().types.task_data.tid):"\u672a\u547d\u540d\u4efb\u52a1"}),a=Object(d.a)(n,2),i=a[0],o=a[1],l=Oe.getState().types.task_data,u=s.a.useReducer((function(e){return e+1}),0),j=Object(d.a)(u,2),h=(j[0],j[1]),f=function(e){return o(re(i,e))};i.requesting||l||(f({requesting:!0}),fe.request("task","PATCH").then((function(e){Oe.dispatch(he("task_data",e.data.task_data)),h()})));var b=function(){var e=Object(c.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("pass#2"),l){e.next=5;break}return ue("Task\u6570\u636e\u4e3a\u7a7a\u3002"),console.error("Task\u6570\u636e\u4e3a\u7a7a\u3002"),e.abrupt("return");case 5:return t=re(l,{triggers:i.triggers,actions:i.actions,task_name:i.taskName,tid:null}),console.log("task",t),e.next=9,fe.request("task","POST",{task:t});case 9:n=e.sent,console.log("resp",n);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),g=Object(me.jsxs)(Ee.a,{fullWidth:!0,open:i.dialogAddTaskOpen,onClose:function(){return f({dialogAddTaskOpen:!1})},children:[Object(me.jsx)(Ne.a,{children:"\u6dfb\u52a0\u65b0\u4efb\u52a1"}),Object(me.jsxs)(Ae.a,{children:[Object(me.jsxs)(v.a,{children:[Object(me.jsx)(et.a,{children:"\u8ba1\u5212\u540d\u79f0"}),Object(me.jsx)(pe.a,{children:Object(me.jsx)(De.a,{value:i.taskName,onChange:function(e){f({taskName:e.target.value})}})}),Object(me.jsx)(et.a,{children:"\u89e6\u53d1\u5668\u5217\u8868"}),i.triggers.map((function(e,t){return Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(Qe,{trigger:e,onSave:function(e){console.log("saveing",e);var n=ae(i.triggers);n[t]=e,console.log("newTriggers",n),f({triggers:n})}}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)(S.a,{onClick:function(){var e=ae(i.triggers);e.splice(t,1),console.log("newTriggers",e),f({triggers:e})},children:Object(me.jsx)(Je.a,{})})})]},t)})),Object(me.jsx)(et.a,{children:"Actions\u5217\u8868"}),i.actions.map((function(e,t){return Object(me.jsxs)(pe.a,{children:[Object(me.jsx)(He,{action:e,onSave:function(e){console.log("saveing",e);var n=ae(i.actions);n[t]=e,console.log("newActions",n),f({actions:n})}}),Object(me.jsx)(Ie.a,{children:Object(me.jsx)(S.a,{onClick:function(){var e=ae(i.actions);e.splice(t,1),console.log("newActions",e),f({actions:e})},children:Object(me.jsx)(Je.a,{})})})]},t)})),Object(me.jsx)(pe.a,{children:Object(me.jsxs)(bt.a,{container:!0,spacing:5,children:[Object(me.jsx)(bt.a,{item:!0,xs:12,lg:6,children:Object(me.jsx)(Ce.a,{fullWidth:!0,onClick:function(){f({dialogAddTriggerOpen:!0})},color:"primary",variant:"outlined",children:"\u6dfb\u52a0\u89e6\u53d1\u5668"})}),Object(me.jsx)(bt.a,{item:!0,xs:12,lg:6,children:Object(me.jsx)(Ce.a,{fullWidth:!0,onClick:function(){f({dialogAddActionOpen:!0})},color:"primary",variant:"outlined",children:"\u6dfb\u52a0Action"})})]})})]}),Object(me.jsxs)(Ee.a,{open:i.dialogAddTriggerOpen,onClose:function(){return f({dialogAddTriggerOpen:!1})},children:[Object(me.jsx)(Ne.a,{children:"\u9009\u62e9\u4e00\u4e2a\u89e6\u53d1\u5668"}),Object(me.jsx)(Ae.a,{children:Object(me.jsx)(Ze,{onClick:function(e){console.log("trigger",e);var t=ae(i.triggers);t.push(e),f({dialogAddTriggerOpen:!1,triggers:t})},selectMode:!0})})]}),Object(me.jsxs)(Ee.a,{open:i.dialogAddActionOpen,onClose:function(){return f({dialogAddActionOpen:!1})},children:[Object(me.jsx)(Ne.a,{children:"\u9009\u62e9\u4e00\u4e2aAction"}),Object(me.jsx)(Ae.a,{children:Object(me.jsx)(Ue,{onClick:function(e){console.log("action",e);var t=ae(i.actions);t.push(e),f({dialogAddActionOpen:!1,actions:t})},selectMode:!0})})]})]}),Object(me.jsxs)(qe.a,{children:[Object(me.jsx)(Ce.a,{color:"primary",disabled:0===i.triggers.length||0===i.actions.length,onClick:Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("pass#1"),e.next=3,b();case 3:f({dialogAddTaskOpen:!1,triggers:[],actions:[]});case 4:case"end":return e.stop()}}),e)}))),children:"\u786e\u5b9a"}),Object(me.jsx)(Ce.a,{onClick:function(){return f({dialogAddTaskOpen:!1})},children:"\u53d6\u6d88"})]})]});return Object(me.jsxs)(ke.a,{children:[Object(me.jsxs)(bt.a,{container:!0,spacing:3,children:[Object(me.jsxs)(bt.a,{item:!0,lg:8,sm:12,children:[Object(me.jsx)(y.a,{variant:"h4",children:"\u4efb\u52a1\u5217\u8868"}),Object(me.jsx)(v.a,{children:t.map((function(e,t){return Object(me.jsx)(pe.a,{children:Object(me.jsx)(gt,{task:e},t)})}))})]}),Object(me.jsx)(bt.a,{item:!0,lg:4,sm:12,children:Object(me.jsx)(ke.a,{maxWidth:"xs",children:Object(me.jsxs)(v.a,{children:[Object(me.jsx)(et.a,{children:"\u65b0\u4efb\u52a1"}),Object(me.jsx)(pe.a,{children:Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){f({dialogAddTaskOpen:!0})},children:"\u6dfb\u52a0\u65b0\u4efb\u52a1"})}),Object(me.jsx)(pe.a,{children:Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"contained",children:"\u8bbe\u7f6e\u9ed8\u8ba4\u4efb\u52a1"})}),Object(me.jsx)(et.a,{children:"\u5168\u90e8\u4efb\u52a1\u7ba1\u7406"}),Object(me.jsx)(pe.a,{children:Object(me.jsx)(Ce.a,{fullWidth:!0,variant:"outlined",children:"\u5220\u9664\u5168\u90e8\u4efb\u52a1"})})]})})})]}),g]})}var pt=240;U.a.locale("zh-cn");var xt=Object(f.a)((function(e){return{root:{display:"flex",width:"100%"},appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},title:{flexGrow:1},appBarShift:{marginLeft:pt,width:"calc(100% - ".concat(pt,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},hide:{display:"none"},drawer:{width:pt,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:pt,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(j.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)}),toolbar:Object(u.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3),width:"100%",overflowX:"auto"}}})),vt={},mt={config:null,user:null,daemon:null};Oe.subscribe(Object(c.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=Oe.getState()).config.data){e.next=10;break}if(JSON.stringify(t.config.data)===JSON.stringify(mt.config)){e.next=9;break}if(t.config.save(),!Oe.getState().user||!Oe.getState().config.data.settings_async){e.next=7;break}return e.next=7,fe.request("sync","POST",{config:t.config.data});case 7:e.next=9;break;case 9:mt.config=t.config.data;case 10:for(n in vt)vt[n](t);case 11:case"end":return e.stop()}}),e)}))));var yt=function(){return Oe.getState().daemon&&Oe.getState().daemon.shop_info&&Oe.getState().daemon.shop_info.shopName?"".concat(Oe.getState().daemon.shop_info.shopName," - ").concat(Oe.getState().daemon.shop_info.branchName):null};function kt(){var e,t,n=xt(),a=Object(b.a)(),i=s.a.useState(!1),o=Object(d.a)(i,2),l=o[0],u=o[1],f=s.a.useState(!1),_=Object(d.a)(f,2),C=(_[0],_[1]),E=s.a.useState(!1),A=Object(d.a)(E,2),W=A[0],I=A[1],R=s.a.useState(null),J=Object(d.a)(R,2),L=J[0],H=J[1],U=s.a.useState(!1),V=Object(d.a)(U,2),K=(V[0],V[1],"\u56e2\u8d2d\u6740\u624b - KTV\u4f53\u9a8c\u7248"),X=s.a.useState(yt()||K),Q=Object(d.a)(X,2),Z=Q[0],$=Q[1],ee=s.a.useReducer((function(e){return e+1}),0),te=Object(d.a)(ee,2),ae=(te[0],te[1]);vt.Error=function(e){e.errorInfo&&(console.log("Error Hook: ",e.errorInfo),I(e.errorInfo),Oe.dispatch(ue(null)))},vt.Message=function(e){e.message&&(console.log("message: ",e.message),H(e.message),Oe.dispatch(je(null)))},vt.User=function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.user&&(JSON.stringify(t.user)!=JSON.stringify(mt.user)&&(ae(),mt.user||console.log("trigger")),mt.user=t.user);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),vt.Daemon=function(){var e=Object(c.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.daemon&&(JSON.stringify(t.daemon)!=JSON.stringify(mt.daemon)&&ae(),mt.daemon=t.daemon,t.daemon.shop_info&&Z===K&&$(yt()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.a.useEffect((function(){var e=function(){var e=window.innerWidth;!l&&e>=800&&u(!0),l&&e<=600&&u(!1)};return window.addEventListener("load",e),window.addEventListener("resize",e),function(){window.removeEventListener("load",e),window.removeEventListener("resize",e)}}));var re=Object(me.jsx)(P.a,{children:Object(me.jsxs)(B.a,{utils:Y.a,locale:"zh-cn",children:[Object(me.jsx)(m.a,{}),Object(me.jsx)(p.a,{position:"fixed",className:Object(h.a)(n.appBar,Object(j.a)({},n.appBarShift,l)),children:Object(me.jsxs)(x.a,{children:[Object(me.jsx)(S.a,{color:"inherit","aria-label":"open drawer",onClick:function(){u(!0)},edge:"start",className:Object(h.a)(n.menuButton,Object(j.a)({},n.hide,l)),children:Object(me.jsx)(w.a,{})}),Object(me.jsx)(y.a,{variant:"h6",noWrap:!0,className:n.title,children:Z}),Object(me.jsx)(S.a,{color:"inherit","aria-label":"login",onClick:function(){C(!0)},children:Object(me.jsx)(D.a,{})})]})}),Object(me.jsxs)(O.a,{variant:"permanent",className:Object(h.a)(n.drawer,(e={},Object(j.a)(e,n.drawerOpen,l),Object(j.a)(e,n.drawerClose,!l),e)),classes:{paper:Object(h.a)((t={},Object(j.a)(t,n.drawerOpen,l),Object(j.a)(t,n.drawerClose,!l),t))},children:[Object(me.jsx)("div",{className:n.toolbar,children:Object(me.jsx)(S.a,{onClick:function(){u(!1)},children:"rtl"===a.direction?Object(me.jsx)(N.a,{}):Object(me.jsx)(T.a,{})})}),Object(me.jsx)(k.a,{}),Object(me.jsxs)(v.a,{onClick:function(){(window.innerWidth<600||"/"===window.location.pathname)&&u(!1)},children:[Object(me.jsx)(ye,{to:"/",primary:"\u542f\u52a8\u9875",icon:Object(me.jsx)(M.a,{})}),Object(me.jsx)(ye,{to:"/tasks",primary:"\u4efb\u52a1",icon:Object(me.jsx)(q.a,{})}),Object(me.jsx)(ye,{to:"/settings",primary:"\u8bbe\u7f6e",icon:Object(me.jsx)(F.a,{})})]})]}),Object(me.jsxs)("main",{className:n.content,children:[Object(me.jsx)("div",{className:n.toolbar}),Object(me.jsxs)(z.c,{children:[Object(me.jsx)(z.a,{path:"/",exact:!0,children:Object(me.jsx)($e,{})}),Object(me.jsx)(z.a,{path:"/tasks",exact:!0,children:Object(me.jsx)(Ot,{})}),Object(me.jsx)(z.a,{path:"/settings",exact:!1,children:Object(me.jsx)(at,{})})]})]})]})}),ce=Oe.getState().user,ie=!ce&&Oe.getState().config.data.api_token.access_token,se=ie?Object(me.jsx)(Te.a,{children:"\u6b63\u5728\u767b\u5f55..."}):ce?re:Object(me.jsx)(ft,{});return ie||!ce||Oe.getState().daemon||(se=Object(me.jsx)(ut,{})),Object(me.jsx)("div",{className:n.root,children:Object(me.jsxs)(g.a,{theme:Oe.getState().config.theme,children:[se,Object(me.jsxs)(Ee.a,{open:!!W,onClose:function(){I(null)},children:[Object(me.jsx)(Ne.a,{children:"\u9047\u5230\u9519\u8bef"}),Object(me.jsxs)(Ae.a,{children:[Object(me.jsx)(y.a,{variant:"body1",children:"\u9519\u8bef\u4fe1\u606f"}),Object(me.jsx)(Te.a,{component:"div",children:Object(me.jsx)(Te.a,{component:"div",children:function(){return ne(W)&&"string"!==typeof W?Object(me.jsx)(v.a,{children:W.map((function(e,t){return Object(me.jsx)(pe.a,{children:Object(me.jsx)("code",{children:"{}"===JSON.stringify(e)?e.toString():JSON.stringify(e)})},t)}))}):Object(me.jsx)("code",{children:"{}"===JSON.stringify(W)?W.toString():JSON.stringify(W)})}})})]}),Object(me.jsxs)(qe.a,{children:[Object(me.jsx)(Ce.a,{color:"primary",onClick:function(){window.location.reload()},children:"\u5237\u65b0"}),Object(me.jsx)(Ce.a,{color:"primary",onClick:function(){I(null)},children:"\u53d6\u6d88"})]})]}),Object(me.jsx)(rt.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:null!==L,autoHideDuration:6e3,message:L,action:Object(me.jsx)(s.a.Fragment,{children:Object(me.jsx)(S.a,{size:"small","aria-label":"close",color:"inherit",onClick:function(){return H(null)},children:Object(me.jsx)(G.a,{fontSize:"small"})})})})]})})}var St=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,249)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};function _t(){return(_t=Object(c.a)(r.a.mark((function e(){var t,n=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:1e3;case 1:return e.next=5,te(t);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wt(){return(wt=Object(c.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(c.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=Oe.getState().user,!(!t&&Oe.getState().config.data.api_token.access_token)){e.next=13;break}return fe.load_from_config(),e.next=6,fe.request("user","GET");case 6:if(200!==(n=e.sent).code){e.next=13;break}return Oe.dispatch(le(n.data.user)),e.next=11,fe.request("daemon","GET");case 11:200===(a=e.sent).code&&a.data.uid?Oe.dispatch(de(a.data)):Oe.dispatch(de(null));case 13:case"end":return e.stop()}}),e)}))),0);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}l.a.render(Object(me.jsx)(L.a,{store:Oe,children:Object(me.jsx)(kt,{})}),document.getElementById("root")),function(){return wt.apply(this,arguments)}().then((function(){!function(){_t.apply(this,arguments)}()})),St()}},[[170,1,2]]]);
//# sourceMappingURL=main.66a7104b.chunk.js.map