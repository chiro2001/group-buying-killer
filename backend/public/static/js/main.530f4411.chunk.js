(this["webpackJsonpgbk-frontend"]=this["webpackJsonpgbk-frontend"]||[]).push([[0],{131:function(e,t,n){},141:function(e,t,n){},149:function(e,t,n){"use strict";n.r(t);var a=n(15),r=n.n(a),i=n(21),s=n(0),c=n.n(s),o=n(11),u=n.n(o),l=(n(131),n(16)),d=n(63),h=n(33),j=(n(132),n(4)),f=n(210),b=n(23),p=n(215),g=n(220),O=n(213),x=n(214),v=n(197),m=n(212),k=n(57),_=n(209),y=n(206),w=n(98),S=n.n(w),C=n(101),E=n.n(C),T=n(100),N=n.n(T),D=n(99),I=n.n(D),J=n(102),R=n.n(J),q=n(103),G=n.n(q),M=n(104),W=n.n(M),A=n(67),L=n(14),z=n(76),F=n(211),B=n(92),P=n(37),U=n.n(P),H=(n(87),n(56)),K=n(93),X=n(38),V=n(39),Q=n(105),Y=n(189),Z=n(73);function $(e){return function(t){t({type:"SET_CONFIG",data:e})}}function ee(e){return function(t){t({type:"SET_USER",data:e})}}function te(e){return function(t){t({type:"SET_DAEMON",data:e})}}function ne(e){return function(t){t({type:"SET_ERROR_INFO",data:e})}}function ae(e){return function(t){t({type:"SET_MESSAGE",data:e})}}function re(e){return new Promise((function(t){setTimeout(t,e)}))}function ie(e){return null!=e&&"function"===typeof e[Symbol.iterator]}function se(e){if(ie(e)&&"string"!==typeof e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}if("object"===typeof e){var a={};for(var r in e)a[r]=se(e[r]);return a}return e}function ce(e,t){var n=se(e);for(var a in t)n[a]=t[a];return n}Date.prototype.setDay=function(e){var t=this.getDay();return t===e||this.setTime(this.getTime()+864e5*(e-t)),this},Date.prototype.toDateString=function(){return this.toISOString().slice(0,10)};var oe=new(function(){function e(){Object(X.a)(this,e),this.host=null,this.port=8080,this.api_version="v2",this.api_prefix="/api/".concat(this.api_version),this.protocol="http",this.url=this.host?"".concat(this.protocol,"://").concat(this.host,":").concat(this.port).concat(this.api_prefix):"".concat(this.api_prefix),this.access_token="",this.refresh_token=""}return Object(V.a)(e,[{key:"set_token",value:function(e,t){void 0!==e&&(this.access_token=e),void 0!==t&&(this.refresh_token=t)}},{key:"get_token",value:function(){return{access_token:""===this.access_token?void 0:this.access_token,refresh_token:""===this.refresh_token?void 0:this.refresh_token}}},{key:"request_key",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"GET",a=arguments.length>3?arguments[3]:void 0;return this.request("".concat(e,"/").concat(t),n,a)}},{key:"update_config",value:function(){var e=de.getState().config;e.data.api_token=this.get_token(),console.log("config.data.api_token",e.data.api_token),de.dispatch($(e))}},{key:"load_from_config",value:function(){var e=de.getState().config;this.set_token(e.data.api_token.access_token,e.data.api_token.refresh_token)}},{key:"get_headers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n={"Content-Type":"application/json"};return e&&(n.Refresh=this.refresh_token),t&&""!==this.access_token&&(n.Authorization=this.access_token),n}},{key:"request",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,s,c,o,u,l,d,h,j,f=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=f.length>1&&void 0!==f[1]?f[1]:"GET",a=f.length>2?f[2]:void 0,i={method:n,mode:"cors",body:a?JSON.stringify(a):void 0,headers:this.get_headers(Boolean("session"===t&&"DELETE"===n))},e.next=5,fetch("".concat(this.url,"/").concat(t),i);case 5:return s=e.sent,c=null,e.prev=7,e.next=10,s.json();case 10:c=e.sent,e.next=18;break;case 13:return e.prev=13,e.t0=e.catch(7),console.error(e.t0),de.dispatch(ne(e.t0)),e.abrupt("return",{code:s.status,error:s.statusText});case 18:if(console.log("raw js:",c),c||((c={}).message=s.statusText),void 0===c.code&&(c.code=s.status),422!==c.code){e.next=46;break}if(""!==this.refresh_token){e.next=24;break}return e.abrupt("return",null);case 24:return e.next=26,fetch("".concat(this.url,"/session"),{method:"GET",mode:"cors",headers:this.get_headers(!0)});case 26:return o=e.sent,e.prev=27,e.next=30,o.json();case 30:if(200!==(u=e.sent).code){e.next=38;break}this.set_token(u.data.access_token,u.data.refresh_token),this.update_config(),200===(l=this.request("user","GET")).code&&de.dispatch(ee(l.data.user)),e.next=40;break;case 38:return de.dispatch(ne("\u767b\u5f55\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55")),e.abrupt("return",null);case 40:e.next=45;break;case 42:return e.prev=42,e.t1=e.catch(27),e.abrupt("return",{code:o.status,error:o.statusText});case 45:return e.abrupt("return",this.request(t,n,a));case 46:return 200===c.code?"session"===t&&"POST"===n?(d=c.data,h=d.access_token,j=d.refresh_token,this.set_token(h,j),this.update_config()):"session"===t&&"DELETE"===n&&(this.set_token("",""),this.update_config()):de.dispatch(ne(c)),e.abrupt("return",c);case 48:case"end":return e.stop()}}),e,this,[[7,13],[27,42]])})));return function(t){return e.apply(this,arguments)}}()}]),e}()),ue={config:new(function(){function e(){Object(X.a)(this,e),this.ITEM_NAME="group_bying_config",this.load=this.load.bind(this),this.save=this.save.bind(this),this.theme_avaliable={"\u9ed8\u8ba4\u4e3b\u9898":Object(Q.a)({}),"\u9ed1\u6697\u6a21\u5f0f":Object(Q.a)({palette:{type:"dark",primary:{main:Y.a[500]},secondary:{main:Z.a[500]}}})},this.data_default={debug:!1,version_frontend:.1,theme_name:"\u9ed8\u8ba4\u4e3b\u9898",theme_avaliable:["\u9ed8\u8ba4\u4e3b\u9898","\u9ed1\u6697\u6a21\u5f0f"],settings_async:!0,remote_login:{server:"ws://127.0.0.1:8081"},api_token:{}},this.data=this.data_default,this.theme=this.theme_avaliable["\u9ed8\u8ba4\u4e3b\u9898"],this.load()}return Object(V.a)(e,[{key:"load",value:function(){console.log("Config: loading config..."),this.data.debug&&(console.log("Config: load default config."),this.save());try{if(this.data=JSON.parse(localStorage.getItem(this.ITEM_NAME)),!this.data)throw new Error("Null data");if(console.log("Got data:",this.data),!this.data.version_frontend||this.data.version_frontend<this.data_default.version_frontend){for(var e in console.log("Config: update ".concat(this.data.version_frontend," -> ").concat(this.data_default.version_frontend)),this.data.version_frontend=this.data_default.version_frontend,this.data_default)this.data[e]||(console.log("    Config: add value ".concat(e)),this.data[e]=this.data_default[e]);this.save()}}catch(t){console.warn("Can not find ".concat(this.ITEM_NAME," in localStorage, use default config.")),this.data=this.data_default,this.save()}this.theme=this.theme_avaliable[this.data.theme_name],this.theme||(this.theme=this.theme_avaliable.default),oe.set_token(this.data.api_token.access_token,this.data.api_token.refresh_token)}},{key:"save",value:function(){console.log("Config: saving config..."),this.data.api_token=oe.get_token();var e=JSON.stringify(this.data);return localStorage.setItem(this.ITEM_NAME,e),e}}]),e}()),tasks:[],user:null,daemon:null,errorInfo:null,message:null};var le=Object(H.b)({config:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.config,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_CONFIG":return t.data;default:return e}},errorInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.errorInfo,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_ERROR_INFO":return t.data;default:return e}},message:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.message,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.data;default:return e}},daemon:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.daemon,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_DAEMON":return t.data;default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.user,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_USER":return t.data;default:return e}},tasks:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue.tasks,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_TASKS":return t.data;default:return e}}}),de=Object(H.c)(le,Object(H.a)(K.a)),he=n(152),je=n(192),fe=n(193),be=n(2);var pe=function(e){var t=e.icon,n=e.primary,a=e.to,r=c.a.useMemo((function(){return c.a.forwardRef((function(e,t){return Object(be.jsx)(A.b,Object(d.a)({to:a,ref:t},e))}))}),[a]);return Object(be.jsx)("li",{children:Object(be.jsxs)(he.a,{button:!0,component:r,children:[t?Object(be.jsx)(je.a,{children:t}):null,Object(be.jsx)(fe.a,{primary:n})]})})},ge=n(199),Oe=n(200),xe=n(198),ve=n(201),me=n(217),ke=n(205),_e=n(222),ye=n(194),we=n(195),Se=n(196),Ce=n(207),Ee=n(208);function Te(e){var t=e.data,n=e.open,a=e.onClose,r=e.title,i=e.keyNames,s=c.a.useState(!1),o=Object(l.a)(s,2),u=o[0],d=o[1],h=c.a.useState(null),j=Object(l.a)(h,2),f=j[0],b=j[1],p=c.a.useState(null),g=Object(l.a)(p,2),O=g[0],x=g[1];return Object(be.jsxs)(ye.a,{fullWidth:!0,open:n,onClose:a,children:[Object(be.jsx)(we.a,{children:r}),Object(be.jsxs)(Se.a,{children:[Object(be.jsx)(v.a,{style:{width:"100%"},children:Object.keys(t).map((function(e,n){var a=i&&i[e]||e;if(t[e]){if("object"===typeof t[e])return Object(be.jsx)(he.a,{button:!0,onClick:function(){b(t[e]),x(a),d(!0)},children:a},n);var r="".concat(t[e]);return Object(be.jsxs)(he.a,{children:[Object(be.jsx)(fe.a,{children:a}),Object(be.jsx)(xe.a,{children:Object(be.jsx)(k.a,{variant:"body1",children:r.slice(0,20)+(r.length>20?"...":"")})})]},n)}}))}),f&&O?Object(be.jsx)(Te,{data:f,open:u,onClose:function(){d(!1)},title:O}):void 0]})]})}var Ne=function(e){var t=c.a.useState(de.getState().config.data.theme_name),n=Object(l.a)(t,2),a=n[0],r=n[1],i=c.a.useRef(),s=c.a.useState(!1),o=Object(l.a)(s,2),u=o[0],d=o[1],h=c.a.useState(!1),j=Object(l.a)(h,2),f=j[0],b=j[1],p=c.a.useState(!1),g=Object(l.a)(p,2),O=g[0],x=g[1],m=c.a.useState(!1),_=Object(l.a)(m,2),y=_[0],w=_[1],S=function(){var e=de.getState().config;e.data=e.data_default,e.save(),e.load(),de.dispatch($(e))},C=de.getState().user;return Object(be.jsxs)(ge.a,{maxWidth:"md",children:[Object(be.jsxs)(v.a,{children:[Object(be.jsx)(Oe.a,{children:"\u7528\u6237\u8d26\u53f7"}),Object(be.jsxs)(he.a,{children:[Object(be.jsx)(fe.a,{primary:"\u7528\u6237\u540d"}),Object(be.jsx)(xe.a,{children:C.username})]}),Object(be.jsx)(he.a,{button:!0,onClick:function(){w(!0)},children:Object(be.jsx)(fe.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(be.jsx)(he.a,{button:!0,children:Object(be.jsx)(fe.a,{primary:"\u4fee\u6539\u4fe1\u606f"})}),Object(be.jsx)(Oe.a,{children:"\u7528\u6237\u95e8\u5e97"}),Object(be.jsx)(he.a,{button:!0,onClick:function(){x(!0)},children:Object(be.jsx)(fe.a,{primary:"\u8be6\u7ec6\u4fe1\u606f"})}),Object(be.jsx)(Oe.a,{children:"\u5916\u89c2"}),Object(be.jsxs)(he.a,{children:[Object(be.jsx)(fe.a,{primary:"\u4e3b\u9898\u8bbe\u7f6e"}),Object(be.jsx)(xe.a,{children:Object(be.jsx)(ve.a,{children:Object(be.jsx)(me.a,{value:a,onChange:function(e){r(e.target.value);var t=de.getState().config;t.data.theme_name=e.target.value,t.theme=t.theme_avaliable[t.data.theme_name],t.save(),de.dispatch($(t)),setTimeout((function(){window.location.reload()}),200)},children:de.getState().config.data.theme_avaliable.map((function(e,t){return Object(be.jsx)(ke.a,{value:e,children:e},t)}))})})})]}),Object(be.jsx)(Oe.a,{children:"\u6570\u636e\u7ba1\u7406"}),Object(be.jsx)(he.a,{button:!0,onClick:function(){!function(e,t){var n=document.createElement("a");n.download=t,n.style.display="none";var a=new Blob([e]);n.href=URL.createObjectURL(a),document.body.appendChild(n),n.click(),document.body.removeChild(n)}(de.getState().config.save(),"\u56e2\u8d2d\u6740\u624b\u914d\u7f6e\u6570\u636e(".concat((new Date).toLocaleString(),").json"))},children:Object(be.jsx)(fe.a,{primary:"\u6570\u636e\u5bfc\u51fa"})}),Object(be.jsxs)(he.a,{button:!0,onClick:function(){i.current.click()},children:[Object(be.jsx)(fe.a,{primary:"\u6570\u636e\u5bfc\u5165"}),Object(be.jsx)(xe.a,{children:Object(be.jsx)("input",{type:"file",accept:".json",hidden:!0,name:"file-gbk-data",ref:i,onChange:function(e){var t=e.target.files;if(0!==t.length)try{var n=t[0],a=new FileReader;a.readAsText(n,"UTF-8"),a.onload=function(t){var n=t.target.result;try{var a=JSON.parse(n);if(!a.version_frontend)return void de.dispatch(ae("\u6587\u4ef6\u7c7b\u578b\u9519\u8bef\u6216\u8005\u6587\u4ef6\u5df2\u7ecf\u635f\u574f"));if(a.version_frontend>de.getState().config.data.version_frontend)return void de.dispatch(ae("\u5b58\u6863\u6587\u4ef6\u7248\u672c(".concat(a.version_frontend,"\u9ad8\u4e8e\u5f53\u524d\u7248\u672c").concat(de.getState().config.data.version_frontend,")\uff0c\u8bf7\u66f4\u65b0\u5230\u6700\u65b0\u7248")));var r=de.getState().config;r.data=a,de.dispatch($(r)),de.dispatch(ae("\u6570\u636e\u5bfc\u5165\u5b8c\u6210"))}catch(e){de.dispatch(ne(e))}}}catch(e){de.dispatch(ne(e))}else de.dispatch(ae("\u672a\u9009\u62e9\u6587\u4ef6"))}})})]}),Object(be.jsxs)(he.a,{children:[Object(be.jsx)(fe.a,{primary:"\u8bbe\u7f6e\u6570\u636e\u540c\u6b65"}),Object(be.jsx)(xe.a,{children:Object(be.jsx)(_e.a,{defaultChecked:de.getState().config.data.settings_async,onChange:function(e){var t=de.getState().config;t.data.settings_async=e.target.checked,t.save(),de.dispatch($(t))}})})]}),Object(be.jsx)(he.a,{button:!0,onClick:function(){return d(!0)},children:Object(be.jsx)(fe.a,{primary:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"})}),Object(be.jsx)(he.a,{button:!0,onClick:function(){return b(!0)},children:Object(be.jsx)(fe.a,{primary:"\u5220\u9664\u6240\u6709\u6570\u636e"})})]}),Object(be.jsx)(Te,{data:de.getState().user,open:y,keyNames:{username:"\u7528\u6237\u540d",nick:"\u6635\u79f0",phone:"\u7528\u6237\u624b\u673a\u53f7",profile:"\u8be6\u7ec6\u4fe1\u606f",state:"\u7528\u6237\u72b6\u6001",created_at:"\u521b\u5efa\u4e8e",updated_at:"\u66f4\u65b0\u4e8e"},title:"\u7528\u6237\u4fe1\u606f",onClose:function(){w(!1)}}),Object(be.jsx)(Te,{data:de.getState().daemon,open:O,keyNames:{cookies:"\u8fdc\u7a0b\u767b\u5f55\u51ed\u636e",shop_info:"\u95e8\u5e97\u8be6\u7ec6\u4fe1\u606f",solution_id:"\u89e3\u51b3\u65b9\u6848\u7f16\u53f7"},title:"\u95e8\u5e97\u4fe1\u606f",onClose:function(){x(!1)}}),Object(be.jsxs)(ye.a,{open:u,onClose:function(){return d(!1)},children:[Object(be.jsx)(we.a,{children:"\u56de\u5230\u9ed8\u8ba4\u8bbe\u7f6e"}),Object(be.jsx)(Se.a,{children:Object(be.jsx)(k.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u6240\u6709\u8bbe\u7f6e\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(be.jsxs)(Ce.a,{children:[Object(be.jsx)(Ee.a,{onClick:function(){return d(!1)},children:"\u53d6\u6d88"}),Object(be.jsx)(Ee.a,{onClick:function(){S(),window.location.reload()},children:"\u786e\u5b9a"})]})]}),Object(be.jsxs)(ye.a,{open:f,onClose:function(){return b(!1)},children:[Object(be.jsx)(we.a,{children:"\u5220\u9664\u6240\u6709\u6570\u636e"}),Object(be.jsx)(Se.a,{children:Object(be.jsx)(k.a,{variant:"body1",children:"\u6b64\u64cd\u4f5c\u5c06\u4f1a\u6e05\u9664\u8f6f\u4ef6\u6570\u636e\uff0c\u786e\u8ba4\u64cd\u4f5c\uff1f"})}),Object(be.jsxs)(Ce.a,{children:[Object(be.jsx)(Ee.a,{onClick:function(){return b(!1)},children:"\u53d6\u6d88"}),Object(be.jsx)(Ee.a,{onClick:function(){S(),window.location.reload()},children:"\u786e\u5b9a"})]})]})]})},De=(n(141),n(216)),Ie=n(219),Je=n(107),Re=n(106),qe=n(110),Ge=function(){function e(t){var n=this;Object(X.a)(this,e),this.connect=this.connect.bind(this),this.url=t||de.getState().config.data.remote_login.server||"ws://127.0.0.1:8081",this.ws=null,this.onopen=function(){console.log("Connection started")},this.ondata=function(e){"code"===e.cmd?n.oncode(e.data):"cookies"===e.cmd&&n.oncookies(e.data)},this.onmessage=function(e){n.ondata(JSON.parse(e.data))},this.onerror=function(e){console.error(e)},this.onclose=function(){console.log("Connection closed")},this.oncode=function(e){console.log("code",e)},this.oncookies=function(e){console.log("cookies",e)}}return Object(V.a)(e,[{key:"connect",value:function(){this.ws=this.ws||new WebSocket(this.url),this.ws.onopen=this.onopen,this.ws.onclose=this.onclose,this.ws.onerror=this.onerror,this.ws.onmessage=this.onmessage}},{key:"close",value:function(){this.ws&&this.ws.close()}}]),e}(),Me=n(142);function We(e){var t=e.children;return Object(be.jsx)(De.a,{style:{width:"100%",height:"100%",display:"flex",justifyContent:"center",flexDirection:"column"},children:Object(be.jsx)(De.a,{style:{width:"100%",textAlign:"center"},children:t})})}var Ae=function(e){Object(Je.a)(n,e);var t=Object(Re.a)(n);function n(e){var a;return Object(X.a)(this,n),(a=t.call(this,e)).state={code:null,loginDone:!1},a.ws_api=null,setTimeout(Object(i.a)(r.a.mark((function e(){var t,n,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!de.getState().daemon&&!a.state.loginDone){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,oe.request("remote_login","PATCH");case 4:if(t=e.sent,!de.getState().daemon&&!a.state.loginDone){e.next=7;break}return e.abrupt("return");case 7:if(n=t.data.server,(s=de.getState().config).data.remote_login.server=n,de.dispatch($(s)),!de.getState().daemon&&!a.state.loginDone){e.next=13;break}return e.abrupt("return");case 13:if(a.ws_api=new Ge(n),a.ws_api.oncode=function(e){de.getState().daemon||a.state.loginDone||a.setState({code:e})},a.ws_api.oncookies=function(){var e=Object(i.a)(r.a.mark((function e(t){var n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,oe.request("remote_login","POST",{cookies:t});case 2:if(n=e.sent,console.log("done",n),!de.getState().daemon&&!a.state.loginDone){e.next=6;break}return e.abrupt("return");case 6:return a.setState({loginDone:!0}),e.next=9,oe.request("remote_login","GET");case 9:200===(i=e.sent).code&&i.data.uid&&de.dispatch(te(i.data));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),!de.getState().daemon&&!a.state.loginDone){e.next=18;break}return e.abrupt("return");case 18:a.ws_api.connect();case 19:case"end":return e.stop()}}),e)}))),1e3),a}return Object(V.a)(n,[{key:"componentWillUnmount",value:function(){this.ws_api&&this.ws_api.close()}},{key:"render",value:function(){var e=null;return e=this.state.loginDone?Object(be.jsx)(qe.a,{style:{width:200,height:200},children:Object(be.jsx)(We,{children:"\u767b\u5f55\u5b8c\u6210"})}):this.state.code?Object(be.jsx)(Me,{value:JSON.stringify(this.state.code),size:200}):Object(be.jsx)(qe.a,{style:{width:200,height:200},children:Object(be.jsx)(We,{children:"\u6b63\u5728\u52a0\u8f7d\u4e8c\u7ef4\u7801..."})}),Object(be.jsx)(ge.a,{children:e})}}]),n}(c.a.Component),Le=n(218),ze=n(111);function Fe(e){var t=c.a.useState({username:"",password:"",captcha:"",actionType:"login"}),n=Object(l.a)(t,2),a=n[0],s=n[1],o=c.a.useRef(),u=c.a.useRef(),d=function(e){return s(ce(a,e))},h="login"===a.actionType,j=function(){var e=Object(i.a)(r.a.mark((function e(){var t,n,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!h){e.next=16;break}return e.next=3,oe.request("session","POST",{username:a.username,password:a.password});case 3:if(t=e.sent,console.log(t),200===t.code){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,oe.request("user","GET");case 9:if(200===(n=e.sent).code){e.next=12;break}return e.abrupt("return");case 12:console.log("user",n.data.user),de.dispatch(ee(n.data.user)),e.next=20;break;case 16:return e.next=18,oe.request("user","POST",{username:a.username,password:a.password});case 18:i=e.sent,console.log(i);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(be.jsxs)(De.a,{children:[Object(be.jsx)(k.a,{variant:"h4",children:h?"\u767b\u5f55":"\u6ce8\u518c"}),Object(be.jsx)("br",{}),Object(be.jsx)(_.a,{}),Object(be.jsx)("br",{}),Object(be.jsx)(Le.a,{fullWidth:!0,ref:o,label:"\u7528\u6237\u540d",variant:"outlined",value:a.username,onChange:function(e){d({username:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&u.current.querySelector("input").focus()}}),Object(be.jsx)("br",{}),Object(be.jsx)("br",{}),Object(be.jsx)(Le.a,{fullWidth:!0,ref:u,label:"\u5bc6\u7801",variant:"outlined",value:a.password,type:"password",onChange:function(e){d({password:e.target.value})},onKeyDown:function(e){"Enter"===e.code&&j()}}),Object(be.jsx)(ze.a,{in:h,style:{display:h?"block":"none"},timeout:{exit:0,enter:200},children:Object(be.jsxs)(De.a,{children:[Object(be.jsxs)(De.a,{children:[Object(be.jsx)("br",{}),Object(be.jsx)(Ee.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:j,children:"\u767b\u5f55"})]}),Object(be.jsxs)(De.a,{children:[Object(be.jsx)("br",{}),Object(be.jsx)(Ee.a,{fullWidth:!0,variant:"contained",color:"secondary",onClick:function(){return d({actionType:"sign_in"})},children:"\u6ce8\u518c"})]})]})}),Object(be.jsx)(ze.a,{in:!h,style:{display:h?"none":"block"},timeout:{exit:0,enter:200},children:Object(be.jsxs)(De.a,{children:[Object(be.jsxs)(De.a,{children:[Object(be.jsx)("br",{}),Object(be.jsx)(Ee.a,{fullWidth:!0,variant:"contained",color:"primary",onClick:j,children:"\u6ce8\u518c"})]}),Object(be.jsxs)(De.a,{children:[Object(be.jsx)("br",{}),Object(be.jsx)(Ee.a,{fullWidth:!0,variant:"contained",onClick:function(){return d({actionType:"login"})},children:"\u8fd4\u56de\u767b\u5f55"})]})]})})]})}function Be(e){return Object(be.jsx)(ge.a,{maxWidth:"sm",children:Object(be.jsx)(Fe,{})})}var Pe=240;U.a.locale("zh-cn");var Ue=Object(f.a)((function(e){return{root:{display:"flex",width:"100%"},appBar:{zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},title:{flexGrow:1},appBarShift:{marginLeft:Pe,width:"calc(100% - ".concat(Pe,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},menuButton:{marginRight:36},hide:{display:"none"},drawer:{width:Pe,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:Pe,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(h.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)}),toolbar:Object(d.a)({display:"flex",alignItems:"center",justifyContent:"flex-end",padding:e.spacing(0,1)},e.mixins.toolbar),content:{flexGrow:1,padding:e.spacing(3),width:"100%",overflowX:"auto"}}})),He={},Ke={config:null,user:null,daemon:null};de.subscribe(Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=de.getState()).config.data){e.next=10;break}if(JSON.stringify(t.config.data)==JSON.stringify(Ke.config)){e.next=9;break}if(t.config.save(),!de.getState().user||!de.getState().config.data.settings_async){e.next=7;break}return e.next=7,oe.request("sync","POST",{config:t.config.data});case 7:e.next=9;break;case 9:Ke.config=t.config.data;case 10:for(n in He)He[n](t);case 11:case"end":return e.stop()}}),e)}))));function Xe(){var e,t,n=Ue(),a=Object(b.a)(),r=c.a.useState(!1),i=Object(l.a)(r,2),s=i[0],o=i[1],u=c.a.useState(!1),d=Object(l.a)(u,2),f=(d[0],d[1]),w=c.a.useState(!1),C=Object(l.a)(w,2),T=C[0],D=C[1],J=c.a.useState(null),q=Object(l.a)(J,2),M=q[0],z=q[1],P=c.a.useState(!1),U=Object(l.a)(P,2),H=(U[0],U[1],"\u56e2\u8d2d\u6740\u624b - KTV\u4f53\u9a8c\u7248"),K=c.a.useState(H),X=Object(l.a)(K,2),V=X[0],Q=X[1],Y=c.a.useReducer((function(e){return e+1}),0),Z=Object(l.a)(Y,2),$=(Z[0],Z[1]);He.Error=function(e){e.errorInfo&&(console.log("Error Hook: ",e.errorInfo),D(e.errorInfo),de.dispatch(ne(null)))},He.Message=function(e){e.message&&(console.log("message: ",e.message),z(e.message),de.dispatch(ae(null)))},He.ShopInfo=function(e){e.shopInfo&&V===H&&Q(null)},He.User=function(e){e.user&&(JSON.stringify(e.user)!=JSON.stringify(Ke.user)&&$(),Ke.user=e.user)},He.Daemon=function(e){e.daemon&&(JSON.stringify(e.daemon)!=JSON.stringify(Ke.daemon)&&$(),Ke.daemon=e.daemon)},c.a.useEffect((function(){var e=function(){var e=window.innerWidth;!s&&e>=800&&o(!0),s&&e<=600&&o(!1)};return window.addEventListener("load",e),window.addEventListener("resize",e),function(){window.removeEventListener("load",e),window.removeEventListener("resize",e)}}));var ee=Object(be.jsx)(A.a,{children:Object(be.jsxs)(F.a,{utils:B.a,locale:"zh-cn",children:[Object(be.jsx)(m.a,{}),Object(be.jsx)(O.a,{position:"fixed",className:Object(j.a)(n.appBar,Object(h.a)({},n.appBarShift,s)),children:Object(be.jsxs)(x.a,{children:[Object(be.jsx)(y.a,{color:"inherit","aria-label":"open drawer",onClick:function(){o(!0)},edge:"start",className:Object(j.a)(n.menuButton,Object(h.a)({},n.hide,s)),children:Object(be.jsx)(S.a,{})}),Object(be.jsx)(k.a,{variant:"h6",noWrap:!0,className:n.title,children:V}),Object(be.jsx)(y.a,{color:"inherit","aria-label":"login",onClick:function(){f(!0)},children:Object(be.jsx)(I.a,{})})]})}),Object(be.jsxs)(g.a,{variant:"permanent",className:Object(j.a)(n.drawer,(e={},Object(h.a)(e,n.drawerOpen,s),Object(h.a)(e,n.drawerClose,!s),e)),classes:{paper:Object(j.a)((t={},Object(h.a)(t,n.drawerOpen,s),Object(h.a)(t,n.drawerClose,!s),t))},children:[Object(be.jsx)("div",{className:n.toolbar,children:Object(be.jsx)(y.a,{onClick:function(){o(!1)},children:"rtl"===a.direction?Object(be.jsx)(N.a,{}):Object(be.jsx)(E.a,{})})}),Object(be.jsx)(_.a,{}),Object(be.jsxs)(v.a,{onClick:function(){(window.innerWidth<600||"/"===window.location.pathname)&&o(!1)},children:[Object(be.jsx)(pe,{to:"/",primary:"\u542f\u52a8\u9875",icon:Object(be.jsx)(R.a,{})}),Object(be.jsx)(pe,{to:"/settings",primary:"\u8bbe\u7f6e",icon:Object(be.jsx)(G.a,{})})]})]}),Object(be.jsxs)("main",{className:n.content,children:[Object(be.jsx)("div",{className:n.toolbar}),Object(be.jsxs)(L.c,{children:[Object(be.jsx)(L.a,{path:"/",exact:!0,children:Object(be.jsx)("div",{children:"Launch Here"})}),Object(be.jsx)(L.a,{path:"/settings",exact:!1,children:Object(be.jsx)(Ne,{})})]})]})]})}),te=de.getState().user,re=!te&&de.getState().config.data.api_token.access_token,se=re?Object(be.jsx)(De.a,{children:"\u6b63\u5728\u767b\u5f55..."}):te?ee:Object(be.jsx)(Be,{});return re||!te||de.getState().daemon||(se=Object(be.jsx)(Ae,{})),Object(be.jsx)("div",{className:n.root,children:Object(be.jsxs)(p.a,{theme:de.getState().config.theme,children:[se,Object(be.jsxs)(ye.a,{open:!!T,onClose:function(){D(null)},children:[Object(be.jsx)(we.a,{children:"\u9047\u5230\u9519\u8bef"}),Object(be.jsxs)(Se.a,{children:[Object(be.jsx)(k.a,{variant:"body1",children:"\u9519\u8bef\u4fe1\u606f"}),Object(be.jsx)(De.a,{component:"div",children:Object(be.jsx)(De.a,{component:"div",children:function(){return ie(T)&&"string"!==typeof T?Object(be.jsx)(v.a,{children:T.map((function(e,t){return Object(be.jsx)(he.a,{children:Object(be.jsx)("code",{children:"{}"===JSON.stringify(e)?e.toString():JSON.stringify(e)})},t)}))}):Object(be.jsx)("code",{children:"{}"===JSON.stringify(T)?T.toString():JSON.stringify(T)})}})})]}),Object(be.jsxs)(Ce.a,{children:[Object(be.jsx)(Ee.a,{color:"primary",onClick:function(){window.location.reload()},children:"\u5237\u65b0"}),Object(be.jsx)(Ee.a,{color:"primary",onClick:function(){D(null)},children:"\u53d6\u6d88"})]})]}),Object(be.jsx)(Ie.a,{anchorOrigin:{vertical:"bottom",horizontal:"right"},open:null!==M,autoHideDuration:6e3,message:M,action:Object(be.jsx)(c.a.Fragment,{children:Object(be.jsx)(y.a,{size:"small","aria-label":"close",color:"inherit",onClick:function(){return z(null)},children:Object(be.jsx)(W.a,{fontSize:"small"})})})})]})})}var Ve=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,224)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),a(e),r(e),i(e),s(e)}))};function Qe(){return(Qe=Object(i.a)(r.a.mark((function e(){var t,n=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.length>0&&void 0!==n[0]?n[0]:1e3;case 1:return e.next=5,re(t);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ye(){return(Ye=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout(Object(i.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=de.getState().user,!(!t&&de.getState().config.data.api_token.access_token)){e.next=8;break}return oe.load_from_config(),e.next=6,oe.request("user","GET");case 6:200===(n=e.sent).code&&de.dispatch(ee(n.data.user));case 8:return e.next=10,oe.request("remote_login","GET");case 10:200===(a=e.sent).code&&a.data.uid?de.dispatch(te(a.data)):de.dispatch(te(null));case 12:case"end":return e.stop()}}),e)}))),0);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}u.a.render(Object(be.jsx)(z.a,{store:de,children:Object(be.jsx)(Xe,{})}),document.getElementById("root")),function(){return Ye.apply(this,arguments)}().then((function(){!function(){Qe.apply(this,arguments)}()})),Ve()}},[[149,1,2]]]);
//# sourceMappingURL=main.530f4411.chunk.js.map